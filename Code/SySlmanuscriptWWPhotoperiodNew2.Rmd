---
title: "Import OLIS spectral data data"
author: "Sylwia Sliwinska-Wilczewska"
date: "`r format(Sys.Date())`"
output:
  html_document:
    df_print: paged
---

# Import spectral files generated by OLIS spectrophotometer

```{r setup, include = FALSE}
# knitr::opts_chunk$set(echo = TRUE, message = FALSE)
# knitr::opts_chunk$set(fig.path='Figs/')
```

```{r set project variables}
Project <- "PICO"
DataOut <- file.path("..", "ImportedData", "SySlmanuscriptWWPhotoperiod")
DataIn <- file.path("..", "OLISSpectraCorr", "WWPhotoperiodSingle", fsep = .Platform$file.sep)
FileID <- "Smooth"
FileEncode <- "UTF-8" 
Delimiter <- ""
HeaderRows <- 0
```


```{r load libraries} 
# libraries; Note check actual dependencies
library(tidyverse)
library(lubridate)
library(stringr)
library(broom)
library(knitr)
library(OneR)
library(zoo)
library(strucchange)

library(dplyr)
library(magrittr)
library(googledrive)
library(googlesheets4)
library(readxl)

library(ggspectra)
library(ggpubr)
library(caret)

library(photobiologyWavebands)
library(reshape2)
library(photobiology)

library(gcookbook)
library(RColorBrewer)
library(viridis)
library(scales)

library(reshape)
library(patchwork)
```

```{r set colours}
Wavelengths_nm = c(445, 470, 505, 535, 590)
Colours_nm = c("darkblue", "dodgerblue", "darkgreen", "yellowgreen",  "darkorange")

names(Colours_nm) <- Wavelengths_nm
Colours_nm

```


```{r list available OLIS Files}
OlisFiles <- list.files(path = DataIn, pattern = FileID, full.names = TRUE)
OlisFiles
unique(duplicated(OlisFiles))
```


# set up read_delim_plus
```{r}

read.delim_plus <- function(flnm, filencode, delimiter, headerrows){read.delim(flnm, fileEncoding = filencode, sep = delimiter,  skip = headerrows, header = TRUE, row.names = NULL) %>%
     mutate(Filename = flnm, Cdatetime = ymd_hms(file.info(flnm)$ctime))
}

#read.delim_long meant for map over a vector of filepaths to read, convert to long format and tidy the imported data
read.delim_long <- function(flnm, filencode, delimiter, headerrows){read.delim(flnm, fileEncoding = filencode, sep = delimiter,  skip = headerrows, header = TRUE, row.names = NULL) %>%
    mutate(Filename = flnm, Cdatetime = ymd_hms(file.info(flnm)$ctime)) %>%
 rename(nm = OLIS.3D.ASCII) %>%
  mutate(FirstLastSpec = str_extract(Filename, "_[A-Z][a-z][A-Z][a-z][:digit:][:digit:][:digit:][:digit:]_[A-Z][a-z][A-Z][a-z][:digit:][:digit:][:digit:][:digit:]_")) %>%
  mutate(SampleNumbers = str_extract_all(FirstLastSpec, "[:digit:][:digit:][:digit:][:digit:]")) %>%
  mutate(FirstSampleNumber = as.numeric(map(SampleNumbers, ~.[[1]]))) %>%
  mutate(LastSampleNumber = as.numeric(map(SampleNumbers, ~.[[2]]))) %>%
  mutate(OperatorID = str_extract(Filename,"[A-Z][a-z][A-Z][a-z]")) %>%
  pivot_longer(cols = starts_with("X"), names_to = "SpectraID", values_to = "Abs") %>%
  mutate(SampleCode = as.numeric(str_remove(SpectraID, "X"))) %>%
  mutate(SampleNumber = SampleCode - min(SampleCode, na.rm = TRUE) + FirstSampleNumber) %>%
  relocate(OperatorID, SampleNumber) %>%
  unite(col = SampleID, OperatorID:SampleNumber, sep = "", remove = FALSE) %>%
  arrange(SampleID, nm) %>%
  relocate(SampleID, nm, Abs) %>%
  mutate(SpectraDate = str_extract(Filename, "/[:digit:][:digit:][:digit:][:digit:][:digit:][:digit:][:digit:][:digit:]_"),
         SpectraDate = str_remove_all(SpectraDate, "_"),
         SpectraDate = str_remove_all(SpectraDate, "/"),
         SpectraDate = ymd(SpectraDate)
  )
}
```


# Import OLISSpectra corrected files
```{r import from specific OLIS corrected file containing multiple spectra}

TargetFile <-  OlisFiles
TargetSpectra <- TargetFile %>% map_df(~read.delim_plus(flnm = ., filencode = FileEncode, delimiter = Delimiter, headerrows = HeaderRows)) %>% 
  pivot_longer(., -c(`OLIS.3D.ASCII`, Filename, Cdatetime), values_to = "Absorbance", names_to = "SampleID") %>%
  filter(!is.na(Absorbance)) %>%
  mutate(nm = `OLIS.3D.ASCII`) %>% 
  select(-c(`OLIS.3D.ASCII`))   
  #separate(col = SampleID, into = c("SampleID", "Replicate"), sep = "_")
TargetSpectraLong <- TargetSpectra %>%
  # rename(nm = OLIS.3D.ASCII) %>%
  separate(col = Filename, into = c("fp1", "fp2", "fp3", "SpectraDate", "Project", "Source", "Range", "Type", "Correction", "Smooth"), sep = "([\\/\\_\\:])", remove = FALSE) 

TargetSpectraLong <- TargetSpectraLong %>%
  select(-c(fp1, fp2, fp3, Type, Correction, Smooth, SampleID)) %>% 
  mutate(CultureID = Source) %>% 
  select(-c(Source)) %>% 
  mutate(SpectraDate = ymd(`SpectraDate`)) 

#rm(TargetSpectraLong2)
```

Load Multiculti catalog
```{r load local multiculticatalog, message = FALSE, warning = FALSE, echo=FALSE}
gs4_deauth()

MetaData <- read_sheet("https://docs.google.com/spreadsheets/d/1ZXpwR7Gfto-uRzVdXzMpQF4frbrvMLH_IyLqonFZRSw/edit#gid=0") %>%
  drop_na(WL) %>%
  mutate(WL = unlist(WL))

as.data.frame(MetaData)
MetaData <- MetaData %>%
   mutate(ExpDate = ymd(ExpDate),
          ExpEndDate = ymd_hms(`ExpEndDate`))
```
Filter multiculti catalog for SySl WWPhotoperiod paper
```{r}
# colnames(MetaData)
MetaData <- MetaData %>%
summarize(Run, ID, Strain, MC, InnocDate, ExpDate, Par_ue, Photoperiod, Tube, O2, WL, LightShape) %>% 
  filter(Strain == "BA127R" | Strain == "BA77G" | Strain == "BA48R" | Strain == "BA56G") %>%
  filter(WL == "WW") %>%
  filter(Run!= 61) %>% 
  #filter(Par_ue != 600) %>% 
  filter(Run == "39" | Run == "40" | Run == "43" | Run == "44" |Run == "45" | Run == "46" | Run == "50" | Run == "60" | Run == "62" | Run == "65" | Run == "71" | Run == "74" | Run == "77" | Run == "121") %>%
  filter(MC!= "MCMIX004") %>% 
  filter(MC!= "MCMIX006")
  
  MetaData1 <- MetaData %>%
  filter(Photoperiod != "24") %>% 
  mutate(PARPhotonDose =(Par_ue/2)*Photoperiod*3600)
  
  MetaData2 <- MetaData %>%
  filter(Photoperiod == "24") %>% 
  mutate(PARPhotonDose = Par_ue*Photoperiod*3600) 
  
  MetaData <-rbind(MetaData1, MetaData2)
  rm(MetaData1,MetaData2)

```


# Merge OLISSpectra with MetaData
```{r OLISDateSpectra with MetaData}

OLISSpectraMeta <- MetaData %>%
  left_join(., TargetSpectraLong, by = c("ID" = "CultureID")) 

# OLISSpectraMeta <- OLISSpectraMeta %>%
#   rename("FilenameOlis" = "Filename") %>% 
#   select(-c(PrimaryOperator, doi, ProjectID, Inoc_mL, Media_mL, InnocDate, Tube, Plate, Well, Salinity,  N2, Ar, CO2, Media, MediaDate, SourceSalinity, OptodeCh, InocpH, FinalpH, Par_ueAdjusted, DateOfAdjustment, ElaspedHoursAtAdjustment, ...44, ...45, Description, Motivation, MC, EndDate,  ExpCul, ExpStartTime, Source, Optode, Range, Cdatetime, Project))
          
OLISSpectraMeta <- OLISSpectraMeta %>%
group_by(ID) %>%
  arrange(SpectraDate) %>%
  mutate(E_days = as.numeric((SpectraDate - ExpDate[1]))) %>%
  mutate(SumAb = sum(Absorbance)) %>% 
ungroup()

OLISSpectraMeta <- OLISSpectraMeta %>%
  filter(nm >= 400 & nm <= 700)

```

Normalization at 440 
```{r}

Absorbance440 <- OLISSpectraMeta %>% 
  filter(nm == 440) %>%
  mutate(Abs440 = Absorbance) %>%
  select(ID, Strain, Abs440, Par_ue, Photoperiod, E_days)
  
OLISSpectraMeta440 <- OLISSpectraMeta %>%
  left_join(., Absorbance440) %>%
  mutate(AbsNorm440 = Absorbance / Abs440) 
  
OLISSpectraMeta440 <- OLISSpectraMeta440 %>%
group_by(ID, E_days, Par_ue, Photoperiod) %>%
  mutate(SumAbNorm = sum(AbsNorm440)) %>% 
ungroup()

```

#Combine OLISspectra with Jaz spectra
Jaz file
```{r}
Project <- "PicoBaltic"
DataIn <- file.path("..", "ImportedData", "Jaz", fsep = .Platform$file.sep)

FileEncode <- "UTF-8"
Delimiter <- ","

HeaderRows <- 0
```

Jaz file
Exported from PICO_SySlJazSpec_MultiCulti.Rmd only first time in session
```{r}
list.files(path = DataIn, pattern = Project, full.names = TRUE)
```

Jaz file
```{r read ProcessFile}
JazFile <- "../ImportedData/Jaz/PicoBaltic_MultiCultiSpectraSySlWWPhotoperiodAll.Rds"

JazFileName <- str_split(string = JazFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")

JazData <- readRDS(JazFile)  %>%
  ungroup()

colnames(JazData)
```

```{r}
JazData <- JazData %>%
   mutate(WavelengthRound = round(Wavelength))
colnames(JazData)

JazDataRound <- JazData %>%
group_by(Filename, WavelengthRound) %>%
  summarize(Counts, Filename, Instrument, Date, Strain, Par, WL, CDateTime, WavelengthRound, CountsMean = mean(Counts)) %>%
ungroup()

JazDataRound <- JazDataRound %>%
  summarize(Filename, Strain, Par, WL, WavelengthRound, CountsMean) %>%
  unique()

JazDataRound <- JazDataRound %>%
  filter(WavelengthRound >= 400 & WavelengthRound <= 700)

```

Normalization at 439
```{r}

EmissionJazWW <- JazDataRound %>%
  group_by(WL, Strain, Par) %>%
  filter(WavelengthRound == 439) %>%
  mutate(EmJaz439 = CountsMean) %>%
  select(Strain, EmJaz439, Par) %>%
  ungroup()

JazDataRoundMeta <- JazDataRound %>%
  left_join(., EmissionJazWW) %>%
  mutate(EmNormJaz439 = CountsMean / EmJaz439)
  
```

Raw spectra
```{r}

OLISSpectraMetaAll <- OLISSpectraMeta440 %>%
  left_join(., JazDataRoundMeta, by = c("Par_ue" = "Par", "nm" = "WavelengthRound", "Strain" = "Strain", "WL" = "WL")) %>%
  unique()

```

Mireille idea
```{r}

OLISSpectraMetaAllPUR <- OLISSpectraMetaAll %>%

  mutate(PURNorm = (AbsNorm440*EmNormJaz439)) %>% # green line

  group_by(WL, Strain, Par_ue, Photoperiod, E_days) %>%
  mutate(PURNormSum = sum(PURNorm)) %>% #sum of the green line
  mutate(SumEmNormJaz439 = sum(EmNormJaz439)) %>% #sum of the blue line
  ungroup() %>%

  mutate(PUR = Par_ue*(PURNormSum/SumEmNormJaz439)) 



OLISSpectraMetaAllPUR1 <- OLISSpectraMetaAllPUR %>%
  filter(Photoperiod != "24") %>% 
  mutate(PURPhotonDose =(PUR/2)*Photoperiod*3600)
  
OLISSpectraMetaAllPUR2 <- OLISSpectraMetaAllPUR %>%
  filter(Photoperiod == "24") %>% 
  mutate(PURPhotonDose = PUR*Photoperiod*3600) 
  
  OLISSpectraMetaAllPUR <-rbind(OLISSpectraMetaAllPUR1, OLISSpectraMetaAllPUR2)
  rm(OLISSpectraMetaAllPUR1,OLISSpectraMetaAllPUR2)


```

Only for nice spectra plot
```{r}
#colnames(OLISSpectraMetaAllPUR)

OLISSpectraMetaAllPURShortBA127R<- OLISSpectraMetaAllPUR %>%
  filter(Photoperiod == "12") %>% 
  filter(Strain == "BA127R") %>% 
  filter(Par_ue == 300) %>% 
  filter(E_days == "4" | E_days == "8") %>% 
  mutate(E_days=case_when(E_days==4~3,
         E_days==8~7)) %>% 
  mutate(PURNormBA127R = PURNorm) %>% 
  select(-c(PURNorm)) %>% 
  select(-c(Filename.x, Filename.y, Cdatetime))

OLISSpectraMetaAllPURShortBA77G<- OLISSpectraMetaAllPUR %>%
  filter(Photoperiod == "12") %>% 
  filter(Strain == "BA77G") %>% 
  filter(Par_ue == 300) %>% 
  filter(E_days == "3" | E_days == "7") %>% 
  mutate(PURNormBA77G = PURNorm) %>% 
  select(-c(PURNorm)) %>% 
  select(-c(Filename.x, Filename.y, Cdatetime))

OLISSpectraMetaAllPURShort <- OLISSpectraMetaAllPURShortBA127R %>%
  full_join(., OLISSpectraMetaAllPURShortBA77G, by = c("ID" = "ID", "Run" = "Run", "Strain" = "Strain", "InnocDate" = "InnocDate", "ExpDate" = "ExpDate", "Par_ue" = "Par_ue", "Photoperiod" = "Photoperiod", "Tube" = "Tube", "O2" = "O2", "WL" = "WL", "LightShape" = "LightShape", "PARPhotonDose" = "PARPhotonDose", "nm" = "nm", "SpectraDate" = "SpectraDate", "Project" = "Project", "Range" = "Range", "Absorbance" = "Absorbance", "SumAb" = "SumAb", "Abs440" = "Abs440", "AbsNorm440" = "AbsNorm440", "SumAbNorm" = "SumAbNorm", "E_days" = "E_days", "CountsMean" = "CountsMean", "EmJaz439" = "EmJaz439", "EmNormJaz439" = "EmNormJaz439", "PURNormSum" = "PURNormSum", "SumEmNormJaz439" = "SumEmNormJaz439", "PUR" = "PUR", "PURPhotonDose" = "PURPhotonDose")) 

```



```{r fig.height = 6, fig.width = 8}

Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "Phase of growth", "900 µE")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")

Photoperiod.labs <- c("8 h", "Photoperiod: 12 h", "16 h", "24 h")
names(Photoperiod.labs) <- c("8", "12", "16", "24")

E_days.labs <- c("Exponential", "Pre-stationary")
names(E_days.labs) <- c("3", "7")

Strain.labs <- c("PE-rich_127", "PC-rich_077")
names(Strain.labs) <- c("BA127R", "BA77G")

data_textPUR0 <- data.frame(Par_ue = c(300, 300), E_days = c(3, 7), Strain  = c("BA127R", "BA127R"), Photoperiod = c(12), label = c('PAR = 300 µE', 'PAR = 300 µE'))

data_textPUR1 <- data.frame(Par_ue = c(300, 300), E_days = c(3, 7), Strain  = c("BA127R", "BA127R"), Photoperiod = c(12), label = c('PUR (PE-rich) = 176 µE', 'PUR (PE-rich) = 129 µE'))

data_textPUR2 <- data.frame(Par_ue = c(300, 300), E_days = c(3, 7), Strain  = c("BA127R", "BA127R"), Photoperiod = c(12), label = c('PUR (PC-rich) = 139 µE', 'PUR (PC-rich) = 128 µE'))


data_textpigment1 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('Chl a 440 nm'))
data_textpigment2 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('PEB-rich PE 570 nm'))
data_textpigment3 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('Chl a 680 nm'))
data_textpigment4 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('PCB-rich PC 620 nm'))
data_textpigment5 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('Car 480 nm'))
data_textpigment6 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('PUB-rich PE or PC 500 nm'))



arrowdf1 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)
arrowdf2 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)
arrowdf3 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)
arrowdf4 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)
arrowdf5 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)
arrowdf6 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)




OLISSpectraMetaAllPURPlot <- OLISSpectraMetaAllPURShort %>%
  filter(Photoperiod == "12") %>%
  filter(Strain == "BA127R" | Strain == "BA77G") %>%
  filter(Par_ue == 300) %>%
  filter(E_days == "3" | E_days == "7") %>%
  ggplot() +
  geom_area(aes(x = nm, y = EmNormJaz439, fill = "gray84"), alpha = 0.6, show.legend = F) +
  geom_area(aes(x = nm, y = PURNormBA127R, fill = "brown4"), alpha = 0.5, show.legend = F) +
  geom_area(aes(x = nm, y = PURNormBA77G, fill = "palegreen3"), alpha = 0.5, show.legend = F) +
  geom_line(aes(x = nm, y = AbsNorm440, colour = as.factor(Strain), linetype = as.factor(Strain)), show.legend = F, size = 0.7) +

  geom_text(data=data_textPUR0, aes(x=435, y=1.26, label=label), size=3.5) +
  geom_text(data=data_textPUR1, aes(x=462, y=1.21, label=label), size=3.5) +
  geom_text(data=data_textPUR2, aes(x=462, y=1.16, label=label), size=3.5) +

  geom_text(data=data_textpigment1, aes(x=450, y=1.07, label=label), size=4, colour = "darkgreen") + #chla440
  geom_text(data=data_textpigment5, aes(x=430, y=0.36, label=label), size=4, colour = "coral3") + #Car
  geom_text(data=data_textpigment2, aes(x=520, y=0.92, label=label), size=4, colour = "darkmagenta") + #PE
  geom_text(data=data_textpigment3, aes(x=660, y=1.08, label=label), size=4, colour = "darkgreen") +#chla680
  geom_text(data=data_textpigment4, aes(x=605, y=1.0, label=label), size=4, colour = "deepskyblue4") + #PC
  geom_text(data=data_textpigment6, aes(x=485, y=0.08, label=label), size=4, colour = "sienna4") + #PUB

  geom_segment(data = arrowdf1,
               aes(x = 470, xend = 440, y = 1.04, yend = 1.02),
               colour = "darkgreen", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #chla440
    geom_segment(data = arrowdf5,
               aes(x = 450, xend = 470, y = 0.4, yend = 0.48),
               colour = "coral3", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #Car
  geom_segment(data = arrowdf2,
               aes(x = 538, xend = 568, y = 0.88, yend = 0.86),
               colour = "darkmagenta", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #PE
  geom_segment(data = arrowdf3,
               aes(x = 697, xend = 680, y = 1.05, yend = 0.92),
               colour = "darkgreen", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #chla680
  geom_segment(data = arrowdf4,
               aes(x = 632, xend = 630, y = 0.95, yend = 0.82),
               colour = "deepskyblue4", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #PC
  geom_segment(data = arrowdf4,
               aes(x = 465, xend = 500, y = 0.12, yend = 0.52),
               colour = "sienna4", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #PUB
  
  # scale_color_manual(values = c("BA127R" ="black", "BA48R" ="brown1", "BA56G" ="palegreen4", "BA77G" ="black")) +
  scale_color_manual(values = c("BA127R" ="brown4", "BA77G" ="palegreen3")) +
  scale_linetype_manual(values = c("BA127R" ="longdash", "BA77G" ="solid")) +
  stat_wl_strip(aes(x = nm), ymin = -Inf, ymax = -0.025, alpha = 0.5) + 
  scale_fill_identity() +
  
  labs(y = "Normalized absorbance", x = "Wavelength (nm)") +
  scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  coord_cartesian(ylim = c (-0.01, 1.25)) +

  
  ggh4x::facet_nested(cols = vars(Par_ue, E_days), labeller = labeller(Ex_WL = label_both, WL = label_both, E_days = E_days.labs, Photoperiod = Photoperiod.labs, Par_ue = Par_ue.labs, Strain = Strain.labs)) +
  
  theme_bw() +
      theme(panel.grid.minor = element_blank(),
          panel.grid.major = element_blank(),
          panel.spacing.x = unit(0.4, 'cm'),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.title = element_blank(),
        legend.direction="horizontal",
        legend.position = c(0.08,0.97),
        legend.spacing.x = unit(0.01, 'cm'),
        legend.text.align = 0,
        #legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.3, 'cm'),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.text = element_text(size=10))
OLISSpectraMetaAllPURPlot


```


```{r fig.height = 10, fig.width = 8}
Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "Phase of growth", "900 µE")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")

Photoperiod.labs <- c("8 h", "Photoperiod: 12 h", "16 h", "24 h")
names(Photoperiod.labs) <- c("8", "12", "16", "24")

E_days.labs <- c("Exponential", "Pre-stationary")
names(E_days.labs) <- c("3", "7")

Strain.labs <- c("PE-rich_127", "PC-rich_077")
names(Strain.labs) <- c("BA127R", "BA77G")

data_textPUR0 <- data.frame(Par_ue = c(300, 300), E_days = c(3, 7), Strain  = c("BA127R", "BA127R"), Photoperiod = c(12), label = c('PAR = 300 µE', 'PAR = 300 µE'))

data_textPUR00 <- data.frame(Par_ue = c(300, 300), E_days = c(3, 7), Strain  = c("BA77G", "BA77G"), Photoperiod = c(12), label = c('PAR = 300 µE', 'PAR = 300 µE'))

data_textPUR1 <- data.frame(Par_ue = c(300, 300), E_days = c(3, 7), Strain  = c("BA127R", "BA127R"), Photoperiod = c(12), label = c('PUR = 176 µE', 'PUR = 129 µE'))

data_textPUR2 <- data.frame(Par_ue = c(300, 300), E_days = c(3, 7), Strain  = c("BA77G", "BA77G"), Photoperiod = c(12), label = c('PUR = 139 µE', 'PUR = 128 µE'))


data_textpigment1 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('Chl a 440 nm'))
data_textpigment2 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('PEB-rich PE 570 nm'))
data_textpigment3 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('Chl a 680 nm'))
data_textpigment4 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('PCB-rich PC 620 nm'))
data_textpigment5 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('Car 480 nm'))
data_textpigment6 <- data.frame(Par_ue = c(300), E_days = c(3), Strain  = c("BA127R"), Photoperiod = c(12), label = c('PUB-rich PE or PC 500 nm'))

arrowdf1 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)
arrowdf2 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)
arrowdf3 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)
arrowdf4 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)
arrowdf5 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)
arrowdf6 <- tibble(Strain = "BA127R", E_days = 3, Par_ue = 300)


OLISSpectraMetaAllPURPlot <- OLISSpectraMetaAllPURShort %>%
  filter(Photoperiod == "12") %>% 
  filter(Strain == "BA127R" | Strain == "BA77G") %>% 
  filter(Par_ue == 300) %>% 
  filter(E_days == "3" | E_days == "7") %>% 
  ggplot() +

  geom_area(aes(x = nm, y = EmNormJaz439, fill = "gray84"), alpha = 0.6, show.legend = F) +
  geom_area(aes(x = nm, y = PURNormBA127R, fill = "brown4"), alpha = 0.5, show.legend = F) +
  geom_area(aes(x = nm, y = PURNormBA77G, fill = "palegreen3"), alpha = 0.5, show.legend = F) +
  geom_line(aes(x = nm, y = AbsNorm440, colour = as.factor(Strain), linetype = as.factor(Strain)), show.legend = F, size = 0.7) +
  
  geom_text(data=data_textPUR0, aes(x=446, y=1.26, label=label), size=3.7) +
  geom_text(data=data_textPUR00, aes(x=446, y=1.26, label=label), size=3.7) +
  geom_text(data=data_textPUR1, aes(x=446, y=1.21, label=label), size=3.7) +
  geom_text(data=data_textPUR2, aes(x=446, y=1.21, label=label), size=3.7) +
  
  geom_text(data=data_textpigment1, aes(x=500, y=1.1, label=label), size=4, colour = "darkgreen") + #chla440
  geom_text(data=data_textpigment5, aes(x=500, y=0.8, label=label), size=4, colour = "orange") + #Car
  geom_text(data=data_textpigment2, aes(x=580, y=1.0, label=label), size=4, colour = "darkmagenta") + #PE
  geom_text(data=data_textpigment3, aes(x=650, y=1.2, label=label), size=4, colour = "darkgreen") +#chla680
  geom_text(data=data_textpigment4, aes(x=600, y=0.17, label=label), size=4, colour = "deepskyblue4") + #PC
  geom_text(data=data_textpigment6, aes(x=485, y=0.35, label=label), size=4, colour = "sienna4") + #PUB
  
  geom_segment(data = arrowdf1, 
               aes(x = 480, xend = 445, y = 1.05, yend = 1), 
               colour = "darkgreen", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #chla440
  geom_segment(data = arrowdf5, 
               aes(x = 480, xend = 475, y = 0.75, yend = 0.55), 
               colour = "orange", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #Car
  geom_segment(data = arrowdf2, 
               aes(x = 590, xend = 575, y = 0.95, yend = 0.85), 
               colour = "darkmagenta", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #PE
  geom_segment(data = arrowdf3, 
               aes(x = 660, xend = 680, y = 1.14, yend = 0.85), 
               colour = "darkgreen", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #chla680
  geom_segment(data = arrowdf4, 
               aes(x = 610, xend = 630, y = 0.2, yend = 0.3), 
               colour = "deepskyblue4", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #PC
  geom_segment(data = arrowdf4, 
               aes(x = 490, xend = 500, y = 0.40, yend = 0.52), 
               colour = "sienna4", size = 1, alpha=0.9, arrow = arrow(length=unit(0.2, 'cm'))) + #PUB
  
  scale_color_manual(values = c("BA127R" ="brown4", "BA77G" ="palegreen3")) +
  scale_linetype_manual(values = c("BA127R" ="longdash", "BA77G" ="solid")) +
  
  stat_wl_strip(aes(x = nm), ymin = -Inf, ymax = -0.025, alpha = 0.5) + 
  scale_fill_identity() +
  
  labs(y = "Normalized absorbance", x = "Wavelength (nm)") +
  scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  coord_cartesian(ylim = c (-0.01, 1.25)) +
  ggh4x::facet_nested(cols = vars(Par_ue, E_days), rows = vars(Strain),labeller = labeller(Ex_WL = label_both, WL = label_both, E_days = E_days.labs, Photoperiod = Photoperiod.labs, Par_ue = Par_ue.labs, Strain = Strain.labs)) +
  theme_bw() +
      theme(panel.grid.minor = element_blank(),
          panel.grid.major = element_blank(),
          panel.spacing.x = unit(0.4, 'cm'),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.title = element_blank(),
        legend.direction="horizontal",
        legend.position = c(0.08,0.97),
        legend.spacing.x = unit(0.01, 'cm'),
        legend.text.align = 0,
        #legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.3, 'cm'),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.text = element_text(size=10))
OLISSpectraMetaAllPURPlot


```


# Save data set
```{r save}

# saveRDS(OLISSpectraMetaAllPURShort, file.path(DataOut, paste(Project, "OLISSpectraMetaAllPURShort.Rds", sep = "_"), fsep = .Platform$file.sep))

```


PUR/PAR ratio
```{r}
#colnames(OLISSpectraMetaAllPURPARRatioClean)

OLISSpectraMetaAllPURPARRatio <- OLISSpectraMetaAllPUR %>%
  mutate(PURPARRatio = (PUR/Par_ue))

OLISSpectraMetaAllPURPARRatioClean <- OLISSpectraMetaAllPURPARRatio %>%
  select(-c(nm, Absorbance, AbsNorm440, CountsMean, EmNormJaz439, PURNorm, Project, Range, "Filename.y", SumAb, Abs440, SumAbNorm, EmJaz439, PURNormSum, SumEmNormJaz439, Cdatetime)) %>% 
  unique()


OLISSpectraMetaAllPURPARRatioClean <- OLISSpectraMetaAllPURPARRatioClean %>%
 mutate(Time_h = E_days*24)
```


# Save data set
```{r save}

# saveRDS(OLISSpectraMetaAllPURPARRatioClean, file.path(DataOut, paste(Project, "OLISSpectraMetaAllPURPARRatioClean.Rds", sep = "_"), fsep = .Platform$file.sep))

```

Only for nice PUR/PAR ratio plot - photoperiod and Par_ue - delete multiple data for 16h and 900uE
```{r}
OLISSpectraMetaAllPURPARRatioClean2 <- OLISSpectraMetaAllPURPARRatioClean %>% 
      mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 
  

OLISSpectraMetaAllPURPARRatioClean3 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 900) %>% 
  filter(Photoperiod == "16") %>% 
  filter(E_days == 4)

OLISSpectraMetaAllPURPARRatioClean4 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 900) %>% 
  filter(Photoperiod != "16")

OLISSpectraMetaAllPURPARRatioClean5 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue != 900) 

OLISSpectraMetaAllPURPARRatioClean2 <- rbind(OLISSpectraMetaAllPURPARRatioClean3, OLISSpectraMetaAllPURPARRatioClean4, OLISSpectraMetaAllPURPARRatioClean5)


rm(OLISSpectraMetaAllPURPARRatioClean3, OLISSpectraMetaAllPURPARRatioClean4, OLISSpectraMetaAllPURPARRatioClean5)
```




Only PUR exponential (one PUR value before max Absolute Growth Rate)
```{r}

OLISSpectraMetaAllPURPARRatioClean900 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 900)
  
OLISSpectraMetaAllPURPARRatioClean24 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 30 | Par_ue == 300 | Par_ue == 90 | Par_ue == 180) %>% 
  filter(Photoperiod == 24) %>% 
  filter(E_days < 4)

OLISSpectraMetaAllPURPARRatioClean16 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 180 | Par_ue == 300) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 4)

OLISSpectraMetaAllPURPARRatioClean16_2 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 6)

OLISSpectraMetaAllPURPARRatioClean16_3 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 30) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 12)

OLISSpectraMetaAllPURPARRatioClean30 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 30) %>% 
  filter(Photoperiod == 8 | Photoperiod == 12) %>% 
  filter(E_days == 12| E_days == 13)
  
OLISSpectraMetaAllPURPARRatioClean90 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 8) %>% 
  filter(E_days == 12 | E_days ==13)

OLISSpectraMetaAllPURPARRatioClean90_2 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 8 | E_days ==9)

OLISSpectraMetaAllPURPARRatioClean90_3 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(E_days == 11)

OLISSpectraMetaAllPURPARRatioClean180 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 8) %>% 
  filter(E_days == 8 | E_days == 9)

OLISSpectraMetaAllPURPARRatioClean180_2 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 12) %>% 
  filter(E_days == 6 | E_days == 7)

OLISSpectraMetaAllPURPARRatioClean300 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 6 | E_days ==7)

OLISSpectraMetaAllPURPARRatioClean300_2 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(E_days == 9)

OLISSpectraMetaAllPURPARRatioClean300_3 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 4 | E_days ==5)

OLISSpectraMetaAllPURPARRatioClean300_4 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(E_days == 7)


OLISSpectraMetaAllPURPARRatioCleanExpPUR<- rbind(OLISSpectraMetaAllPURPARRatioClean900,OLISSpectraMetaAllPURPARRatioClean24,OLISSpectraMetaAllPURPARRatioClean16,OLISSpectraMetaAllPURPARRatioClean16_2,OLISSpectraMetaAllPURPARRatioClean16_3,OLISSpectraMetaAllPURPARRatioClean30,OLISSpectraMetaAllPURPARRatioClean90,OLISSpectraMetaAllPURPARRatioClean90_2,OLISSpectraMetaAllPURPARRatioClean90_3,OLISSpectraMetaAllPURPARRatioClean180,OLISSpectraMetaAllPURPARRatioClean180_2,OLISSpectraMetaAllPURPARRatioClean300,OLISSpectraMetaAllPURPARRatioClean300_2,OLISSpectraMetaAllPURPARRatioClean300_3,OLISSpectraMetaAllPURPARRatioClean300_4)

rm(OLISSpectraMetaAllPURPARRatioClean900,OLISSpectraMetaAllPURPARRatioClean24,OLISSpectraMetaAllPURPARRatioClean16,OLISSpectraMetaAllPURPARRatioClean16_2,OLISSpectraMetaAllPURPARRatioClean16_3,OLISSpectraMetaAllPURPARRatioClean30,OLISSpectraMetaAllPURPARRatioClean90,OLISSpectraMetaAllPURPARRatioClean90_2,OLISSpectraMetaAllPURPARRatioClean90_3,OLISSpectraMetaAllPURPARRatioClean180,OLISSpectraMetaAllPURPARRatioClean180_2,OLISSpectraMetaAllPURPARRatioClean300,OLISSpectraMetaAllPURPARRatioClean300_2,OLISSpectraMetaAllPURPARRatioClean300_3,OLISSpectraMetaAllPURPARRatioClean300_4)

```


Only PUR pre-stationary (one PUR value before max Absolute Growth Rate)
```{r}

OLISSpectraMetaAllPURPARRatioClean900 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 900)
  
OLISSpectraMetaAllPURPARRatioClean24 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 30 | Par_ue == 300 | Par_ue == 90 | Par_ue == 180) %>% 
  filter(Photoperiod == 24) %>% 
  filter(E_days > 4)

OLISSpectraMetaAllPURPARRatioClean16 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 180 | Par_ue == 300) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 8)

OLISSpectraMetaAllPURPARRatioClean16_2 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 10)

# OLISSpectraMetaAllPURPARRatioClean16_3 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
#   filter(Par_ue == 30) %>% 
#   filter(Photoperiod == 16) %>% 
#   filter(E_days > 12)

OLISSpectraMetaAllPURPARRatioClean30 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 30) %>% 
  filter(Photoperiod == 8 | Photoperiod == 12 | Photoperiod == 16) %>% 
  filter(E_days == 14)
  
OLISSpectraMetaAllPURPARRatioClean90 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 8) %>% 
  filter(E_days == 14)

OLISSpectraMetaAllPURPARRatioClean90_2 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 12 | E_days ==13)

OLISSpectraMetaAllPURPARRatioClean90_3 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(E_days == 14)

OLISSpectraMetaAllPURPARRatioClean180 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 8) %>% 
  filter(E_days == 12 | E_days == 13)

OLISSpectraMetaAllPURPARRatioClean180_2 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 12) %>% 
  filter(E_days == 10 | E_days == 11)

OLISSpectraMetaAllPURPARRatioClean300 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 10 | E_days ==11)

OLISSpectraMetaAllPURPARRatioClean300_2 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(E_days == 13)

OLISSpectraMetaAllPURPARRatioClean300_3 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 8 | E_days ==9)

OLISSpectraMetaAllPURPARRatioClean300_4 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(E_days == 11)


OLISSpectraMetaAllPURPARRatioCleanStatPUR<- rbind(OLISSpectraMetaAllPURPARRatioClean900,OLISSpectraMetaAllPURPARRatioClean24,OLISSpectraMetaAllPURPARRatioClean16,OLISSpectraMetaAllPURPARRatioClean16_2,OLISSpectraMetaAllPURPARRatioClean30,OLISSpectraMetaAllPURPARRatioClean90,OLISSpectraMetaAllPURPARRatioClean90_2,OLISSpectraMetaAllPURPARRatioClean90_3,OLISSpectraMetaAllPURPARRatioClean180,OLISSpectraMetaAllPURPARRatioClean180_2,OLISSpectraMetaAllPURPARRatioClean300,OLISSpectraMetaAllPURPARRatioClean300_2,OLISSpectraMetaAllPURPARRatioClean300_3,OLISSpectraMetaAllPURPARRatioClean300_4)

rm(OLISSpectraMetaAllPURPARRatioClean900,OLISSpectraMetaAllPURPARRatioClean24,OLISSpectraMetaAllPURPARRatioClean16,OLISSpectraMetaAllPURPARRatioClean16_2,OLISSpectraMetaAllPURPARRatioClean30,OLISSpectraMetaAllPURPARRatioClean90,OLISSpectraMetaAllPURPARRatioClean90_2,OLISSpectraMetaAllPURPARRatioClean90_3,OLISSpectraMetaAllPURPARRatioClean180,OLISSpectraMetaAllPURPARRatioClean180_2,OLISSpectraMetaAllPURPARRatioClean300,OLISSpectraMetaAllPURPARRatioClean300_2,OLISSpectraMetaAllPURPARRatioClean300_3,OLISSpectraMetaAllPURPARRatioClean300_4)

```


# Save data set
```{r save}

# saveRDS(OLISSpectraMetaAllPURPARRatioCleanExpPUR, file.path(DataOut, paste(Project, "OLISSpectraMetaAllPURPARRatioCleanExpPUR.Rds", sep = "_"), fsep = .Platform$file.sep))
# 
# saveRDS(OLISSpectraMetaAllPURPARRatioCleanStatPUR, file.path(DataOut, paste(Project, "OLISSpectraMetaAllPURPARRatioCleanStatPUR.Rds", sep = "_"), fsep = .Platform$file.sep))

```



PUR/PAR ratio - photoperiod and PAR
```{r fig.height = 8, fig.width = 8}

#OLISSpectraMetaAllPURPARRatioCleanExpPUR <- OLISSpectraMetaAllPURPARRatioClean2 %>%


lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
Par_ue.labs <- c("30", "90", "180", "300", "900")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
Photoperiod.labs <- c("8", "12", "16", "24")
names(Photoperiod.labs) <- c("8", "12", "16", "24")
WL.labs <- c("Photoperiod (h)")
names(WL.labs) <- c("WW")
O2.labs <- c("Light level (µE)")
names(O2.labs) <- c(21)

data_vline1 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(347))
data_vline2 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(346))
data_vline3 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(345))
data_vline4 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(344))

data_vline5 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(321.02))
data_vline6 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(319.92))
data_vline7 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(347))
data_vline8 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(345))

data_vline9 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(240.90))
data_vline10 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(240.81))
data_vline11 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(266.84))
data_vline12 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(266.93))

data_vline13 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(187.92))
data_vline14 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(214.41))
data_vline15 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(240.72))
data_vline16 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(215.42))

data_vline17 <- data.frame(Par_ue= c(900),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(110))
data_vline18 <- data.frame(Par_ue= c(900),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(109.5))
data_vline19 <- data.frame(Par_ue= c(900),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(109))
data_vline20 <- data.frame(Par_ue= c(900),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(108.5))

data_vline21 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(347))
data_vline22 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(346))
data_vline23 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(345))
data_vline24 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(344))

data_vline25 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(245.39))
data_vline26 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(216.33))
data_vline27 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(296.45))
data_vline28 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(244.38))

data_vline29 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(189.48))
data_vline30 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(163.44))
data_vline31 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(217.80))
data_vline32 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(190.39))

data_vline33 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(162.62))
data_vline34 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(136.03))
data_vline35 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(191.03))
data_vline36 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(163.62))

data_vline37 <- data.frame(Par_ue= c(900),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(110))
data_vline38 <- data.frame(Par_ue= c(900),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(109.5))
data_vline39 <- data.frame(Par_ue= c(900),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(109))
data_vline40 <- data.frame(Par_ue= c(900),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(108.5))

data_vline41 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(347))
data_vline42 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(299.38))
data_vline43 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(345))
data_vline44 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(299.57))

data_vline45 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(168.39))
data_vline46 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(166.28))
data_vline47 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(191.49))
data_vline48 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(168.85))

data_vline49 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(113.76))
data_vline50 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(137.32))
data_vline51 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(114.95))
data_vline52 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(137.50))

data_vline53 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(111.56))
data_vline54 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(111.28))
data_vline55 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(112.75))
data_vline56 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(112.29))

data_vline57 <- data.frame(Par_ue= c(900),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(110))
data_vline58 <- data.frame(Par_ue= c(900),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(109.45))
data_vline59 <- data.frame(Par_ue= c(900),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(108))
data_vline60 <- data.frame(Par_ue= c(900),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(107))

data_vline61 <- data.frame(Par_ue= c(30),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(154.64))
data_vline62 <- data.frame(Par_ue= c(30),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(119.35))
data_vline63 <- data.frame(Par_ue= c(30),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(157.85))
data_vline64 <- data.frame(Par_ue= c(30),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(138.78))

data_vline65 <- data.frame(Par_ue= c(90),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(114.68))
data_vline66 <- data.frame(Par_ue= c(90),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(103.77))
data_vline67 <- data.frame(Par_ue= c(90),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(120.27))
data_vline68 <- data.frame(Par_ue= c(90),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(120.18))

data_vline69 <- data.frame(Par_ue= c(180),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(93.32))
data_vline70 <- data.frame(Par_ue= c(180),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(100.38))
data_vline71 <- data.frame(Par_ue= c(180),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(110.28))
data_vline72 <- data.frame(Par_ue= c(180),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(108.08))

data_vline73 <- data.frame(Par_ue= c(300),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(93.78))
data_vline74 <- data.frame(Par_ue= c(300),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(79.20))
data_vline75 <- data.frame(Par_ue= c(300),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(95.79))
data_vline76 <- data.frame(Par_ue= c(300),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(98.36))

data_vline77 <- data.frame(Par_ue= c(900),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(110))
data_vline78 <- data.frame(Par_ue= c(900),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(94.23))
data_vline79 <- data.frame(Par_ue= c(900),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(79.66))
data_vline80 <- data.frame(Par_ue= c(900),Photoperiod= c(24),O2= c(21),WL= c("WW"),value = c(107))


OLISSpectraMetaAllPURPARRatioPlot <- OLISSpectraMetaAllPURPARRatioCleanExpPUR %>%
  ggplot() +
  # geom_smooth(aes(x = Time_h, y = PURPARRatio, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
  geom_point(aes(x = Time_h, y = PURPARRatio, colour = as.factor(Strain)), alpha = 0.9, size = 3, show.legend = T) +
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline17, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline18, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline19, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline20, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline37, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline38, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline39, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline40, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  
  geom_vline(data = data_vline57, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline58, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline59, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline60, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline61, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline62, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline63, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline64, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline65, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline66, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline67, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline68, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline69, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline70, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline71, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline72, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
   
  geom_vline(data = data_vline73, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline74, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline75, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline76, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  labs(y = "PUR/PAR ratio", x = "Elapsed time (h)") +
  # geom_errorbar(aes(x = Photoperiod, ymin = OD720_Lmu_corr - OD720_Lmu_se, ymax = OD720_Lmu_corr + OD720_Lmu_se), size = 0.3, width=3, color = '#3C3B53', data = . %>% filter(GrowthAmpOD720Flag_14days  == 1)) +
  scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  coord_cartesian(ylim = c(0, 1.7)) +
  ggh4x::facet_nested(cols = vars(WL, Photoperiod), rows = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.92,0.97),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.text = element_text(size=10))
OLISSpectraMetaAllPURPARRatioPlot



OLISSpectraMetaAllPURPARRatioPlotst <- OLISSpectraMetaAllPURPARRatioCleanStatPUR %>%
  ggplot() +
  # geom_smooth(aes(x = Time_h, y = PURPARRatio, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
  geom_point(aes(x = Time_h, y = PURPARRatio, colour = as.factor(Strain)), alpha = 0.9, size = 3, show.legend = T) +
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline17, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline18, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline19, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline20, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline37, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline38, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline39, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline40, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  
  geom_vline(data = data_vline57, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline58, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline59, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline60, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline61, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline62, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline63, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline64, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline65, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline66, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline67, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline68, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline69, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline70, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline71, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline72, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
   
  geom_vline(data = data_vline73, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline74, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline75, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline76, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  labs(y = "PUR/PAR ratio", x = "Elapsed time (h)") +
  # geom_errorbar(aes(x = Photoperiod, ymin = OD720_Lmu_corr - OD720_Lmu_se, ymax = OD720_Lmu_corr + OD720_Lmu_se), size = 0.3, width=3, color = '#3C3B53', data = . %>% filter(GrowthAmpOD720Flag_14days  == 1)) +
  scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  coord_cartesian(ylim = c(0, 1.7)) +
  ggh4x::facet_nested(cols = vars(WL, Photoperiod), rows = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.92,0.97),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.text = element_text(size=10))
OLISSpectraMetaAllPURPARRatioPlotst





lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
Par_ue.labs <- c("30", "90", "180", "300", "900")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
Photoperiod.labs <- c("8", "12", "16", "24")
names(Photoperiod.labs) <- c("8", "12", "16", "24")
WL.labs <- c("Photoperiod (h)")
names(WL.labs) <- c("WW")
O2.labs <- c("Light level (µE)")
names(O2.labs) <- c(21)



OLISSpectraMetaAllPURPARRatioPlot2 <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  ggplot() +
  # geom_smooth(aes(x = Time_h, y = PURPARRatio, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
  geom_point(aes(x = Time_h, y = PURPARRatio, colour = as.factor(Strain)), alpha = 0.9, size = 3, show.legend = T) +
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline17, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline18, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline19, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline20, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline37, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline38, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline39, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline40, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  
  geom_vline(data = data_vline57, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline58, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline59, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline60, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline61, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline62, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline63, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline64, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline65, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline66, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline67, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline68, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline69, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline70, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline71, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline72, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
   
  geom_vline(data = data_vline73, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline74, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline75, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline76, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  labs(y = "PUR/PAR ratio", x = "Elapsed time (h)") +
  # geom_errorbar(aes(x = Photoperiod, ymin = OD720_Lmu_corr - OD720_Lmu_se, ymax = OD720_Lmu_corr + OD720_Lmu_se), size = 0.3, width=3, color = '#3C3B53', data = . %>% filter(GrowthAmpOD720Flag_14days  == 1)) +
  scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  coord_cartesian(ylim = c(0, 1.7)) +
  ggh4x::facet_nested(cols = vars(WL, Photoperiod), rows = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.92,0.97),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.text = element_text(size=10))
OLISSpectraMetaAllPURPARRatioPlot2








```

PAR vs PUR exp
```{r fig.height = 5, fig.width = 8}

scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))

PARvsPURPlot <- OLISSpectraMetaAllPURPARRatioCleanExpPUR %>%
  ggplot() +
  geom_point(aes(x = PUR, y = Par_ue, colour = as.factor(Strain), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3, show.legend = T) +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
    scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
   scale_x_continuous(label=scientific_10) +
   scale_y_continuous(label=scientific_10) +
  labs(y = "PAR photon dose ( µmol photons "~m^-2~""~d^-1~")", x = "PUR photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  # scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  # coord_cartesian(ylim = c(0, 1.7)) +
  # ggh4x::facet_nested(cols = vars(WL, Photoperiod), rows = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.09,0.80),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PARvsPURPlot


```


PUR/PAR ratio vs PARphotondose
```{r fig.height = 5, fig.width = 8}

OLISSpectraMetaAllPURPARRatioClean2$facets = factor(OLISSpectraMetaAllPURPARRatioClean2$WL, labels = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"))

lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# WL.labs <- c("Photon dose")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)

data_vline1 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline2 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(346))
data_vline3 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline4 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(344))

# data_vline5 <- data.frame(PhotonDose= c(54000),WL= c("WW"),value = c(321.02))
# data_vline6 <- data.frame(PhotonDose= c(54000),WL= c("WW"),value = c(319.92))
# data_vline7 <- data.frame(PhotonDose= c(54000),WL= c("WW"),value = c(347))
# data_vline8 <- data.frame(PhotonDose= c(54000),WL= c("WW"),value = c(345))

# data_vline9 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(240.90))
# data_vline10 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(240.81))
# data_vline11 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(266.84))
# data_vline12 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(266.93))

# data_vline13 <- data.frame(PhotonDose= c(180000),WL= c("WW"),value = c(187.92))
# data_vline14 <- data.frame(PhotonDose= c(180000),WL= c("WW"),value = c(214.41))
# data_vline15 <- data.frame(PhotonDose= c(180000),WL= c("WW"),value = c(240.72))
# data_vline16 <- data.frame(PhotonDose= c(180000),WL= c("WW"),value = c(215.42))

# data_vline17 <- data.frame(PhotonDose= c(540000),WL= c("WW"),value = c(110))
# data_vline18 <- data.frame(PhotonDose= c(540000),WL= c("WW"),value = c(109.5))
# data_vline19 <- data.frame(PhotonDose= c(540000),WL= c("WW"),value = c(109))
# data_vline20 <- data.frame(PhotonDose= c(540000),WL= c("WW"),value = c(108.5))

# data_vline21 <- data.frame(PhotonDose= c(27000),WL= c("WW"),value = c(347))
# data_vline22 <- data.frame(PhotonDose= c(27000),WL= c("WW"),value = c(346))
# data_vline23 <- data.frame(PhotonDose= c(27000),WL= c("WW"),value = c(345))
# data_vline24 <- data.frame(PhotonDose= c(27000),WL= c("WW"),value = c(344))

data_vline25 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(245.39))
data_vline26 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(216.33))
data_vline27 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(296.45))
data_vline28 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(244.38))

data_vline29 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(189.48))
data_vline30 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.44))
data_vline31 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(217.80))
data_vline32 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(190.39))

data_vline33 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(162.62))
data_vline34 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(136.03))
data_vline35 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(191.03))
data_vline36 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.62))

# data_vline37 <- data.frame(PhotonDose= c(810000),WL= c("WW"),value = c(110))
# data_vline38 <- data.frame(PhotonDose= c(810000),WL= c("WW"),value = c(109.5))
# data_vline39 <- data.frame(PhotonDose= c(810000),WL= c("WW"),value = c(109))
# data_vline40 <- data.frame(PhotonDose= c(810000),WL= c("WW"),value = c(108.5))

data_vline41 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline42 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.38))
data_vline43 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline44 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.57))

# data_vline45 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(168.39))
# data_vline46 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(166.28))
# data_vline47 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(191.49))
# data_vline48 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(168.85))

# data_vline49 <- data.frame(PhotonDose= c(216000),WL= c("WW"),value = c(113.76))
# data_vline50 <- data.frame(PhotonDose= c(216000),WL= c("WW"),value = c(137.32))
# data_vline51 <- data.frame(PhotonDose= c(216000),WL= c("WW"),value = c(114.95))
# data_vline52 <- data.frame(PhotonDose= c(216000),WL= c("WW"),value = c(137.50))

data_vline53 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.56))
data_vline54 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.28))
data_vline55 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.75))
data_vline56 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.29))

# data_vline57 <- data.frame(PhotonDose= c(1080000),WL= c("WW"),value = c(110))
# data_vline58 <- data.frame(PhotonDose= c(1080000),WL= c("WW"),value = c(109.45))
# data_vline59 <- data.frame(PhotonDose= c(1080000),WL= c("WW"),value = c(108))
# data_vline60 <- data.frame(PhotonDose= c(1080000),WL= c("WW"),value = c(107))

# data_vline61 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(154.64))
# data_vline62 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(119.35))
# data_vline63 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(157.85))
# data_vline64 <- data.frame(PhotonDose= c(108000),WL= c("WW"),value = c(138.78))

# data_vline65 <- data.frame(PhotonDose= c(324000),WL= c("WW"),value = c(114.68))
# data_vline66 <- data.frame(PhotonDose= c(324000),WL= c("WW"),value = c(103.77))
# data_vline67 <- data.frame(PhotonDose= c(324000),WL= c("WW"),value = c(120.27))
# data_vline68 <- data.frame(PhotonDose= c(324000),WL= c("WW"),value = c(120.18))

# data_vline69 <- data.frame(PhotonDose= c(648000),facets= c("Photon~dose~(µmol~photons~m^{-2}~h^{-1})"),value = c(93.32))
# data_vline70 <- data.frame(PhotonDose= c(648000),facets= c("Photon~dose~(µmol~photons~m^{-2}~h^{-1})"),value = c(100.38))
# data_vline71 <- data.frame(PhotonDose= c(648000),facets= c("Photon~dose~(µmol~photons~m^{-2}~h^{-1})"),value = c(110.28))
# data_vline72 <- data.frame(PhotonDose= c(648000),facets= c("Photon~dose~(µmol~photons~m^{-2}~h^{-1})"),value = c(108.08))

# data_vline73 <- data.frame(PhotonDose= c(1080000),WL= c("WW"),value = c(93.78))
# data_vline74 <- data.frame(PhotonDose= c(1080000),WL= c("WW"),value = c(79.20))
# data_vline75 <- data.frame(PhotonDose= c(1080000),WL= c("WW"),value = c(95.79))
# data_vline76 <- data.frame(PhotonDose= c(1080000),WL= c("WW"),value = c(98.36))

data_vline77 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(110))
data_vline78 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(94.23))
data_vline79 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(79.66))
data_vline80 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(107))

data_text <- data.frame(
  facets   = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),
  PARPhotonDose = c(77760000),
  label = c('B'))

PURPARPlot <- OLISSpectraMetaAllPURPARRatioClean2 %>%
  #filter(Strain == "BA77G") %>%
  #filter(Photoperiod != "24") %>%
  #filter(Par_ue != 900) %>%
  filter(PURPARRatio<=1) %>% 
  # filter(PhotonDose!= 540000) %>% 
  # filter(PhotonDose!= 648000) %>% 
  # filter(PhotonDose!= 810000) %>%
  # filter(PhotonDose!= 324000) %>%
  # filter(PhotonDose!= 54000) %>%
  # filter(PhotonDose!= 1080000) %>%
  # filter(PhotonDose!= 27000) %>%
  # filter(PhotonDose!= 180000) %>%
  # filter(PhotonDose!= 108000) %>%
  # filter(PhotonDose!= 216000) %>%
  # 
  
  filter(PARPhotonDose == 432000|
  PARPhotonDose == 864000|
  PARPhotonDose == 1944000|
  PARPhotonDose == 3888000|
  PARPhotonDose == 6480000|
  PARPhotonDose == 8640000|
  PARPhotonDose == 77760000) %>%

  #filter(E_days != "1") %>%
  ggplot() +
  # geom_smooth(aes(x = Time_h, y = PURPARRatio, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
  geom_point(aes(x = Time_h, y = PURPARRatio, colour = as.factor(Strain)), alpha = 0.9, size = 3, show.legend = T) +
  
  #geom_text(data=data_text, aes(x=300, y=1.45, label=label), size=5) +
  
  # geom_hline(yintercept = 0.32, linetype="dotted", colour = "palegreen3") +
  # geom_hline(yintercept = 0.4, linetype="dotted", colour = "brown1") +
  # 
  # geom_hline(yintercept = 0.31, linetype="dotted", colour = "palegreen4") +
  # geom_hline(yintercept = 0.39, linetype="dotted", colour = "brown4") +
  
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  labs(y = "PUR/PAR ratio", x = "Elapsed time (h)") +
  # geom_errorbar(aes(x = Photoperiod, ymin = OD720_Lmu_corr - OD720_Lmu_se, ymax = OD720_Lmu_corr + OD720_Lmu_se), size = 0.3, width=3, color = '#3C3B53', data = . %>% filter(GrowthAmpOD720Flag_14days  == 1)) +
  scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  coord_cartesian(ylim = c(0, 1.5)) +
  
  #facet_grid(~facets, labeller = label_parsed) +
  
    ggh4x::facet_nested(cols = vars(facets, PARPhotonDose), labeller = label_parsed) +
  
  # ggh4x::facet_nested(cols = vars(facets, PhotonDose), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = label_parsed, O2 = O2.labs)) +
  
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=11.5),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.065,0.91),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PURPARPlot


```



665 - chl
480 - car
565	- PE
620	- PC
650 - APC

pigments corelation - to get raw spectra (without dilution factor from olis, I multipied Absorbance *7; 1ml culture and 7 ml of f2 media from olis)
```{r}

OLISSpectraMeta440 <- OLISSpectraMeta440 %>% 
  mutate(Absorbance = Absorbance*7)

Absorbance665 <- OLISSpectraMeta440 %>% 
  filter(nm == 665) %>%
  mutate(Abs665 = Absorbance) %>%
  select(ID, Strain, Abs665, Par_ue, Photoperiod, E_days)
OLISSpectraMeta665 <- OLISSpectraMeta440 %>%
  left_join(., Absorbance665) 

Absorbance480 <- OLISSpectraMeta665 %>% 
  filter(nm == 480) %>%
  mutate(Abs480 = Absorbance) %>%
  select(ID, Strain, Abs480, Par_ue, Photoperiod, E_days)
OLISSpectraMeta480 <- OLISSpectraMeta665 %>%
  left_join(., Absorbance480) 

Absorbance565 <- OLISSpectraMeta480 %>% 
  filter(nm == 565) %>%
  mutate(Abs565 = Absorbance) %>%
  select(ID, Strain, Abs565, Par_ue, Photoperiod, E_days)
OLISSpectraMeta565 <- OLISSpectraMeta480 %>%
  left_join(., Absorbance565) 

Absorbance620 <- OLISSpectraMeta565 %>% 
  filter(nm == 620) %>%
  mutate(Abs620 = Absorbance) %>%
  select(ID, Strain, Abs620, Par_ue, Photoperiod, E_days)
OLISSpectraMeta620 <- OLISSpectraMeta565 %>%
  left_join(., Absorbance620) 

Absorbance650 <- OLISSpectraMeta620 %>% 
  filter(nm == 650) %>%
  mutate(Abs650 = Absorbance) %>%
  select(ID, Strain, Abs650, Par_ue, Photoperiod, E_days)
OLISSpectraMeta650 <- OLISSpectraMeta620 %>%
  left_join(., Absorbance650) 

```

```{r}

OLISSpectraMeta650Clean <- OLISSpectraMeta650 %>%
  select(-c(SumAb, SumAbNorm, AbsNorm440)) 

```


Pigments clario - filters 
```{r}
Project <- "PicoBaltic"
DataIn <- file.path("..","ImportedData", "ClarioSTAR", fsep = .Platform$file.sep)
FileEncode <- "UTF-8" 
Delimiter <- ","
HeaderRows <- 0
```


Pigments clario - filters
Exported only first time in session
```{r}
list.files(path = DataIn, pattern = Project, full.names = TRUE)
```
Pigments clario - filters
```{r read ProcessFile}
ClarioPigmentFile <- "../ImportedData/ClarioSTAR/PicoBaltic_ClarioPigmentsFilter.Rds"

ClarioPigmentFileName <- str_split(string = ClarioPigmentFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 

ClarioPigmentFileData <- readRDS(ClarioPigmentFile)  %>%
  ungroup()

ClarioPigmentFileData <- ClarioPigmentFileData %>% 
  mutate("PhotonDose" ="Calculated_µmolPhotons_m-2d-1") %>% 
  select(-c("Calculated_µmolPhotons_m-2d-1"))
colnames(ClarioPigmentFileData)
```

```{r}

ClarioPigmentFileDataClean <- ClarioPigmentFileData %>%
  summarise(CultureID, Run, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, Tube, O2, WL, LightShape, Chla_ugmL, Car_ugmL, PC_ugmL, APC_ugmL, PE_ugmL, Date, E_days) %>% 

unique()
```

```{r}

# colnames(OLISSpectraMeta650)

ClarioPigmentFileDataAll <- ClarioPigmentFileDataClean %>%
  full_join(., OLISSpectraMeta650Clean, by = c("CultureID"="ID", "Strain"="Strain", "InnocDate"="InnocDate", "Run"="Run", "ExpDate"="ExpDate", "Par_ue"="Par_ue", "Photoperiod"="Photoperiod", "Tube"="Tube", "O2"="O2", "WL"="WL", "LightShape"="LightShape", "E_days", "Date" = "SpectraDate")) 

ClarioPigmentFileDataAll2 <- ClarioPigmentFileDataAll %>%
  filter(WL == "WW")

```
# Save data set
```{r save}

# saveRDS(ClarioPigmentFileDataAll2, file.path(DataOut, paste(Project, "ClarioPigmentFileDataAll2.Rds", sep = "_"), fsep = .Platform$file.sep))

```


Pearson Correlation Coefficient and Linear Regression and coefficient of determination or R²  - filter
https://www.datacamp.com/tutorial/linear-regression-R
```{r}

ClarioPigmentFileDataAll2Chla <- ClarioPigmentFileDataAll2 %>% 
    filter(Strain != "BA127R") 
my_dataChla <- ClarioPigmentFileDataAll2Chla
ggscatter(my_dataChla, x = "Abs665", y = "Chla_ugmL", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson")
my_dataChla
lmChla = lm(Chla_ugmL~Abs665, data = my_dataChla)
summary(lmChla)
# ChlaugmL = (Abs665*13.411029)+0.154793
# Adjusted R-squared: 0.8654
# R=0.93


ClarioPigmentFileDataAll2Car <- ClarioPigmentFileDataAll2 %>% 
    filter(Strain != "BA127R") 
my_dataCar <- ClarioPigmentFileDataAll2Car
ggscatter(my_dataCar, x = "Abs480", y = "Car_ugmL", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson")
my_dataCar
lmCar = lm(Car_ugmL~Abs480, data = my_dataCar)
summary(lmCar)
# CarugmL = (Abs480*5.469880)+0.089971
# Adjusted R-squared: 0.7913
# R=0.89



ClarioPigmentFileDataAll2PE <- ClarioPigmentFileDataAll2 %>% 
    filter(PE_ugmL < 10) %>% 
    filter(Strain != "BA56G")
my_dataPE <- ClarioPigmentFileDataAll2PE
ggscatter(my_dataPE, x = "Abs565", y = "PE_ugmL", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson")
my_dataPE
lmPE = lm(PE_ugmL~Abs565, data = my_dataPE)
summary(lmPE)
# PEugmL = (Abs565*26.760737)-0.143872
# Adjusted R-squared:  0.6979
# R=0.84


ClarioPigmentFileDataAll2PC <- ClarioPigmentFileDataAll2 %>% 
    filter(Strain != "BA56G")
my_dataPC <- ClarioPigmentFileDataAll2PC
ggscatter(my_dataPC, x = "Abs620", y = "PC_ugmL", 
          # color = "Strain",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson")
my_dataPC
lmPC = lm(PC_ugmL~Abs620, data = my_dataPC)
summary(lmPC)
# PCugmL = (Abs620*29.979866)-0.182611
# Adjusted R-squared:  0.8073
# R=0.9


ClarioPigmentFileDataAll2APC <- ClarioPigmentFileDataAll2 
my_dataAPC <- ClarioPigmentFileDataAll2APC
ggscatter(my_dataAPC, x = "Abs650", y = "APC_ugmL", 
          # color = "Strain",
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson")
my_dataAPC
lmPC = lm(APC_ugmL~Abs650, data = my_dataAPC)
summary(lmPC)
# APCugmL = (Abs620*3.873803)+0.021964
# Adjusted R-squared:  0.08721
# R=0.19



```

Calculated pigment content based on Olis calibration
```{r}

# colnames(ClarioPigmentFileDataAll2)

ClarioPigmentFileDataAll2Olis <- ClarioPigmentFileDataAll2 %>% 

  mutate(ChlaugmL = (Abs665*13.411029)+0.154793) %>% 
  mutate(CarugmL = (Abs480*5.469880)+0.089971) %>% 
  mutate(PEugmL = (Abs565*26.760737)-0.143872) %>% 
  mutate(PCugmL = (Abs620*29.979866)-0.182611) %>% 
  mutate(APCugmL = (Abs650*3.873803)+0.021964) 


```

PIGMENTS PER ML
```{r fig.height = 6, fig.width = 8, warning = FALSE}

# lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# ClarioPigmentFileDataAll2OlisPlot <- ClarioPigmentFileDataAll2Olis %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(E_days != "1") %>%
#   ggplot() +
#   geom_point(aes(x = E_days, y = ChlaugmL, colour = as.factor(Strain)),  alpha = 0.9, size = 3, show.legend = T) +
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   # scale_x_continuous(breaks=seq(0, 15, by = 3)) +
#   # coord_cartesian(xlim = c(0, 15)) +
#   labs(y = "ChlaugmL", x = "Time (d)") +
#  ggh4x::facet_nested(rows = vars(Photoperiod), cols = vars(Par_ue), labeller = labeller(WL = label_both, Strain = label_value, Par_ue = Par_ue.labs, Photoperiod = Photoperiod.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=14),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.08,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         legend.text = element_text(size=10))
# ClarioPigmentFileDataAll2OlisPlot
# 
# 
# 
# lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# ClarioPigmentFileDataAll2OlisPlot <- ClarioPigmentFileDataAll2Olis %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(E_days != "1") %>%
#   ggplot() +
#   geom_point(aes(x = E_days, y = CarugmL, colour = as.factor(Strain)),  alpha = 0.9, size = 3, show.legend = T) +
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   # scale_x_continuous(breaks=seq(0, 15, by = 3)) +
#   # coord_cartesian(xlim = c(0, 15)) +
#   labs(y = "CarugmL", x = "Time (d)") +
#  ggh4x::facet_nested(rows = vars(Photoperiod), cols = vars(Par_ue), labeller = labeller(WL = label_both, Strain = label_value, Par_ue = Par_ue.labs, Photoperiod = Photoperiod.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=14),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.08,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         legend.text = element_text(size=10))
# ClarioPigmentFileDataAll2OlisPlot
# 
# 
# lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# ClarioPigmentFileDataAll2OlisPlot <- ClarioPigmentFileDataAll2Olis %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(E_days != "1") %>%
#   ggplot() +
#   geom_point(aes(x = E_days, y = PEugmL, colour = as.factor(Strain)),  alpha = 0.9, size = 3, show.legend = T) +
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   # scale_x_continuous(breaks=seq(0, 15, by = 3)) +
#   # coord_cartesian(xlim = c(0, 15)) +
#   labs(y = "PEugmL", x = "Time (d)") +
#  ggh4x::facet_nested(rows = vars(Photoperiod), cols = vars(Par_ue), labeller = labeller(WL = label_both, Strain = label_value, Par_ue = Par_ue.labs, Photoperiod = Photoperiod.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=14),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.08,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         legend.text = element_text(size=10))
# ClarioPigmentFileDataAll2OlisPlot
# 
# 
# 
# lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# ClarioPigmentFileDataAll2OlisPlot <- ClarioPigmentFileDataAll2Olis %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(E_days != "1") %>%
#   ggplot() +
#   geom_point(aes(x = E_days, y = PCugmL, colour = as.factor(Strain)),  alpha = 0.9, size = 3, show.legend = T) +
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   # scale_x_continuous(breaks=seq(0, 15, by = 3)) +
#   # coord_cartesian(xlim = c(0, 15)) +
#   labs(y = "PCugmL", x = "Time (d)") +
#  ggh4x::facet_nested(rows = vars(Photoperiod), cols = vars(Par_ue), labeller = labeller(WL = label_both, Strain = label_value, Par_ue = Par_ue.labs, Photoperiod = Photoperiod.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=14),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.08,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         legend.text = element_text(size=10))
# ClarioPigmentFileDataAll2OlisPlot
# 
# 
# 
# lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# ClarioPigmentFileDataAll2OlisPlot <- ClarioPigmentFileDataAll2Olis %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(E_days != "1") %>%
#   ggplot() +
#   geom_point(aes(x = E_days, y = APCugmL, colour = as.factor(Strain)),  alpha = 0.9, size = 3, show.legend = T) +
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   # scale_x_continuous(breaks=seq(0, 15, by = 3)) +
#   # coord_cartesian(xlim = c(0, 15)) +
#   labs(y = "APCugmL", x = "Time (d)") +
#  ggh4x::facet_nested(rows = vars(Photoperiod), cols = vars(Par_ue), labeller = labeller(WL = label_both, Strain = label_value, Par_ue = Par_ue.labs, Photoperiod = Photoperiod.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=14),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.08,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         legend.text = element_text(size=10))
# ClarioPigmentFileDataAll2OlisPlot

```



Smaller df to combine with Turner/MDPico - to get pigments per cell
```{r}
# colnames(ClarioPigmentFileDataAll2OlisPDAll)

ClarioOlisPigmentSmall <- ClarioPigmentFileDataAll2Olis %>%
  select(-c(Chla_ugmL, Car_ugmL, PC_ugmL, APC_ugmL, PE_ugmL, nm, Project, Range, Cdatetime, Absorbance)) %>%
unique()
```



Turner file
```{r}
Project <- "PicoBaltic"
DataIn <- file.path("..", "ImportedData", "CombinedData", fsep = .Platform$file.sep)

FileEncode <- "UTF-8"
Delimiter <- ","

HeaderRows <- 0
```

Turner file
Exported from ChlTurnerPICO.Rmd only first time in session
```{r}
list.files(path = DataIn, pattern = Project, full.names = TRUE)
```

Turner file
```{r read ProcessFile}
TurnerFile <- "../ImportedData/CombinedData/PicoBaltic_ChlTurnerMDPico.Rds"

TurnerFileName <- str_split(string = TurnerFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")

TurnerData <- readRDS(TurnerFile)  %>%
  ungroup()

TurnerDataClean <- TurnerData %>% 
  select(-c("Calculated_µmolPhotons_m-2d-1", "Chl_ugL", "Chla_ugN", "meanChla_ugN", "sdChla_ugN", "Chl_ugmL", "meanChl_ugmL", "sdChl_ugmL"))


TurnerDataClean <- TurnerDataClean %>% 
  filter(WL == "WW") %>% 
  filter(Strain == "BA127R" | Strain == "BA48R" | Strain == "BA56G" | Strain == "BA77G") %>% 
  mutate(DateTurner = DATE) %>% 
  select(-c(DATE))

colnames(TurnerDataClean)
```

```{r}
colnames(ClarioOlisPigmentSmall)

ClarioOlisPigmentTurnerData <- TurnerDataClean %>%
  left_join(., ClarioOlisPigmentSmall, by = c("CultureID" = "CultureID", "Run" = "Run", "Strain" = "Strain", "InnocDate" = "InnocDate", "ExpDate" = "ExpDate", "Par_ue" = "Par_ue", "Photoperiod" = "Photoperiod", "Tube" = "Tube", "O2" = "O2", "WL" = "WL", "LightShape" = "LightShape", "E_days" = "E_days", "DateTurner" = "Date")) 
```
Pigments Olis per cell - fg/cell - per Turner
```{r}

ClarioOlisPigmentTurnerDataAll <- ClarioOlisPigmentTurnerData %>%
  mutate(Chlafgcell = (ChlaugmL/cellsml)*1000000000) %>% 
  mutate(Carfgcell = (CarugmL/cellsml)*1000000000) %>% 
  mutate(PEfgcell = (PEugmL/cellsml)*1000000000) %>% 
  mutate(PCfgcell = (PCugmL/cellsml)*1000000000) %>% 
  mutate(APCfgcell = (APCugmL/cellsml)*1000000000) %>% 
  
  mutate(Phycofgcell = PEfgcell+PCfgcell+APCfgcell) %>% 
  mutate(ChlaCarRatio = Chlafgcell/Carfgcell) %>% 
  mutate(ChlaPhycoRatio = Chlafgcell/Phycofgcell) %>% 
  mutate(PEPCRatio = PEfgcell/PCfgcell) 
  
```

# Save data set
```{r save}

# saveRDS(ClarioOlisPigmentTurnerData, file.path(DataOut, paste(Project, "ClarioOlisPigmentTurnerData.Rds", sep = "_"), fsep = .Platform$file.sep))

```


#Growth rate

MultiCulti Assesment
```{r}
Project <- "PicoBaltic"
DataIn <- file.path("..","GrowthAssessData", fsep = .Platform$file.sep)
FileEncode <- "UTF-8" 
Delimiter <- ","
HeaderRows <- 0
```


MultiCulti Assesment
Exported only first time in session
```{r}
list.files(path = DataIn, pattern = Project, full.names = TRUE)
```
Genius Sylwia - GrowthAssessData/PICO_MultiAssesment_CCA contain WWPhotoperiod data!!! Genius - fix this!

MultiCulti Assesment
```{r read ProcessFile}
MultiCultiFile <- "../GrowthAssessData/PicoBaltic_MultiAssesment_CCA.Rds"

MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 

MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()


MultiCulti121File <- "../GrowthAssessData/PicoBaltic_MultiAssesment_RUN121trunc.Rds"

MultiCulti121FileName <- str_split(string = MultiCulti121File, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 

MultiCultiData121 <- readRDS(MultiCulti121File)  %>%
  ungroup()

#colnames(MultiCultiData)
```

```{r}
MultiCultiDataClean <- MultiCultiData %>%
  summarize(Filename, Run, ID, Strain, MC, Par_ue, Photoperiod, O2, WL, OD720_Lmu_corr, deltaOD_Lmu_corr,         OD720_LseGrowthFlag, deltaOD_LseGrowthFlag, GrowthAmpOD720Flag_14days, GrowthAmpdeltaODFlag_14days, OD720_Lmu_se, deltaOD_Lmu_se)

MultiCultiDataClean <- MultiCultiDataClean %>%
  filter(WL == "WW") %>% 
  #filter(Par_ue != 600) %>% 
  filter(O2 == 21) %>% 
  filter(Strain == "BA127R" | Strain == "BA48R" | Strain == "BA56G" | Strain == "BA77G") %>% 
  filter(Run != "61") %>% 
  filter(MC!= "MCMIX004" | MC!= "MCMIX006")
#OD720_Lmu_se, deltaOD_Lmu_se


MultiCultiDataClean121 <- MultiCultiData121 %>%
  summarize(Filename, Run, ID, Strain, MC, Par_ue, Photoperiod, O2, WL, OD720_Lmu_corr, deltaOD_Lmu_corr,         OD720_LseGrowthFlag, deltaOD_LseGrowthFlag, GrowthAmpOD720Flag_14days, GrowthAmpdeltaODFlag_14days, OD720_Lmu_se, deltaOD_Lmu_se)

MultiCultiDataCleanAll<-rbind(MultiCultiDataClean,MultiCultiDataClean121)

```

Combine growth rate with multiculti catalog
```{r}

# colnames(MetaData)

MultiCultiDataCleanGrowth <- MetaData %>%
  left_join(., MultiCultiDataCleanAll, by = c("Strain" = "Strain", "Par_ue" = "Par_ue", "WL" = "WL", "Run" = "Run", "ID" = "ID", "Photoperiod" = "Photoperiod", "O2" = "O2")) 

```

Combine growth rate and all PUR
```{r}
#colnames(OLISSpectraMetaAllPURPARRatioCleanExpPUR)

MultiCultiDataCleanGrowth2 <- OLISSpectraMetaAllPURPARRatioClean %>% 
  full_join(., MultiCultiDataCleanGrowth, by = c("Run" = "Run", "ID" = "ID","Strain" = "Strain", "Par_ue" = "Par_ue", "Photoperiod" = "Photoperiod",  "O2" = "O2", "WL" = "WL",  "InnocDate" =  "InnocDate", "Tube" = "Tube", "ExpDate" = "ExpDate", "LightShape" = "LightShape", "PARPhotonDose" = "PARPhotonDose")) 

```


# Save data set
```{r save}

# saveRDS(MultiCultiDataCleanGrowth2, file.path(DataOut, paste(Project, "MultiCultiDataCleanGrowth2.Rds", sep = "_"), fsep = .Platform$file.sep))

```

Combine growth rate and exp PUR
```{r}


O1 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 30 | Par_ue == 300 | Par_ue == 90 | Par_ue == 180) %>% 
  filter(Photoperiod == 24) %>% 
  filter(E_days < 4)

O2 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 180 | Par_ue == 300) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 4)

O3 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 6)

O4 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 30) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 12)

O5 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 900) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 4)

O6 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 30) %>% 
  filter(Photoperiod == 8 | Photoperiod == 12) %>% 
  filter(E_days == 12| E_days == 13)
  
O7 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 8) %>% 
  filter(E_days == 12 | E_days ==13)

O8 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "BA127R" | Strain == "BA48R" | Strain == "BA77G") %>% 
  filter(E_days == 8 | E_days ==9)

O9 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "BA56G") %>% 
  filter(E_days == 11)

O10 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 8) %>% 
  filter(E_days == 8 | E_days == 9)

O11 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 12) %>% 
  filter(E_days == 6 | E_days == 7)

O12 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "BA127R" | Strain == "BA48R" | Strain == "BA77G") %>% 
  filter(E_days == 6 | E_days ==7)

O13 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "BA56G") %>% 
  filter(E_days == 9)

O14 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "BA127R" | Strain == "BA48R" | Strain == "BA77G") %>% 
  filter(E_days == 4 | E_days ==5)

O15 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "BA56G") %>%  
  filter(E_days == 7)

O16 <- MultiCultiDataCleanGrowth2 %>%
  filter(Par_ue == 900) %>% 
  filter(Photoperiod == 8 | Photoperiod == 12 | Photoperiod == 24) 

MultiCultiDataCleanGrowth3 <-rbind(O1, O2, O3, O4, O5, O6, O7, O8, O9, O10, O11, O12, O13, O14, O15, O16)

rm(O1, O2, O3, O4, O5, O6, O7, O8, O9, O10, O11, O12, O13, O14, O15, O16)

```


# Save data set
```{r save}

# saveRDS(MultiCultiDataCleanGrowth3, file.path(DataOut, paste(Project, "MultiCultiDataCleanGrowth3.Rds", sep = "_"), fsep = .Platform$file.sep))

```



Manuscript plot - growth -> x-PAR photon dose
Manuscript plot - growth -> x-PUR photon dose
```{r fig.height = 5.5, fig.width = 8, warning = FALSE}
MultiCultiDataCleanGrowth4 <- MultiCultiDataCleanGrowth3 %>%
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))

data_textA <- data.frame(
  O2 = c(21),
  Strain  = c("PE-rich_127"),
  label = c("A"))

# lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
#Delta_2
# Strain.labs <- c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127")
# names(Strain.labs) <- c("BA56G", "BA77G", "BA48R", "BA127R")
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# WL.labs <- c("Strain")
# names(WL.labs) <- c("WW")
O2.labs <- c("Strain")
names(O2.labs) <- c(21)
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
GrowthratePAR <- MultiCultiDataCleanGrowth4 %>%
  filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
  # filter(OD720_Lmu_corr == 0 | OD720_Lmu_corr != 0 & OD720_LseGrowthFlag == 1) %>%
  ggplot() +
  geom_point(aes(x = PARPhotonDose, y = deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.9, show.legend = T) +
labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "PAR photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  # labs(shape="Photoperiod (h)", colour="Strain") +
   geom_errorbar(aes(x = PARPhotonDose, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5, width=6000000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +
  geom_text(data=data_textA, aes(x=78000000, y=0.25, label=label), size=5) +
  # scale_x_continuous(breaks=seq(8, 24, by = 4)) +
  # coord_cartesian(xlim = c(6, 26)) +
  # scale_y_continuous(breaks=seq(0, 0.3, by = 0.1)) +
  # coord_cartesian(ylim = c(0, 0.3)) +
  scale_x_continuous(breaks=seq(0, 80000000, by = 20000000)) +
  coord_cartesian(xlim = c(-100, 83000000)) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1", "yellow"), name="", labels = lab2) +
  ggh4x::facet_nested(cols = vars(O2, Strain), labeller = labeller(O2 = O2.labs)) +
    # ggh4x::facet_nested(cols = vars(Strain), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs, Strain = Strain.labs)) +
  # scale_y_continuous(trans = log10_trans(),
  #                    breaks = trans_breaks("log10", function(x) 10^x),
  #                    labels = trans_format("log10", math_format(10^.x))) +
  # annotation_logticks(sides = "l", colour = "gray60") +
  #scale_x_continuous(labels = comma) + 
  scale_x_continuous(label=scientific_10) +
  guides(color = guide_legend(order = 1), shape = guide_legend(order = 2)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=12, angle = 45, vjust = 1, hjust = 1),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.06,0.80),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))
GrowthratePAR



lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))
data_textB <- data.frame(
  O2 = c(21),
  Strain  = c("PE-rich_127"),
  label = c("B"))
# lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
#Delta_2
# Strain.labs <- c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127")
# names(Strain.labs) <- c("BA56G", "BA77G", "BA48R", "BA127R")
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# WL.labs <- c("Strain")
# names(WL.labs) <- c("WW")
O2.labs <- c("Strain")
names(O2.labs) <- c(21)
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
GrowthratePUR <- MultiCultiDataCleanGrowth4 %>%
  filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
  # filter(OD720_Lmu_corr == 0 | OD720_Lmu_corr != 0 & OD720_LseGrowthFlag == 1) %>%
  ggplot() +
  # geom_smooth(aes(x = Photoperiod, y = deltaOD_Lmu_corr, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = F) +
  geom_point(aes(x = PURPhotonDose, y = deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.9, show.legend = T) + 
    geom_text(data=data_textB, aes(x=32000000, y=0.25, label=label), size=5) +

  # labs(shape="Photoperiod (h)", colour="Strain") +
   geom_errorbar(aes(x = PURPhotonDose, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5, width=2000000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +

  # scale_x_continuous(breaks=seq(0, 20000000, by = 10000000)) +
  # coord_cartesian(xlim = c(-500, 37000000)) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "PUR photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2) +
  ggh4x::facet_nested(cols = vars(O2, Strain), labeller = labeller(O2 = O2.labs)) +
  # scale_y_continuous(trans = log10_trans(),
  #                    breaks = trans_breaks("log10", function(x) 10^x),
  #                    labels = trans_format("log10", math_format(10^.x))) +
  #annotation_logticks(sides = "l", colour = "gray60") +
  #scale_x_continuous(labels = comma) + 
  scale_x_continuous(label=scientific_10) +
  guides(color = guide_legend(order = 1), shape = guide_legend(order = 2)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=12, angle = 45, vjust = 1, hjust = 1),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.06,0.80),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))
GrowthratePUR

```
Plot arrange
```{r fig.height = 11, fig.width = 8, warning = FALSE}
# 
# library(ggpubr)
# ggarrange(GrowthratePAR,GrowthratePUR,
#           ncol = 1, nrow = 2)
```


Load MaxGrowth catalog
```{r load local multiculticatalog, message = FALSE, warning = FALSE, echo=FALSE}
gs4_deauth()

MaxGrowthMetaData <- read_sheet("https://docs.google.com/spreadsheets/d/10KUt0r2I6eOPPkBGIDMhh3-KyVVRW8FFIPXtK-PZqi8/edit#gid=0") 

as.data.frame(MaxGrowthMetaData)
MaxGrowthMetaData <- MaxGrowthMetaData 

```



```{r}
#colnames(ClarioOlisPigmentSmall)

MaxGrowthMetaData<-MaxGrowthMetaData %>% 
  mutate(Par_ue = as.numeric(Par_ue)) %>% 
  mutate(Photoperiod = as.double(Photoperiod)) %>% 
  mutate(MaxGrowthH = as.numeric(MaxGrowthH))

MaxGrowth <- MultiCultiDataCleanGrowth %>%
  left_join(., MaxGrowthMetaData, by = c("Strain" = "Strain", "Par_ue" = "Par_ue", "Photoperiod" = "Photoperiod")) 


MaxGrowth2 <- MultiCultiDataCleanGrowth3 %>%
  left_join(., MaxGrowthMetaData, by = c("Strain" = "Strain", "Par_ue" = "Par_ue", "Photoperiod" = "Photoperiod")) 

```


Manuscript plot - growth -> x-photoperiod y - time absolute growth
```{r fig.height = 6, fig.width = 8, warning = FALSE}
# MaxGrowthNew <- MaxGrowth2 %>%
#     mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
#          Strain=="BA48R"~"PE-rich_048",
#         Strain=="BA56G"~"PC-rich_056",
#          Strain=="BA77G"~"PC-rich_077")) 
# lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
# # lab1=c(expression("PE-rich_127"), expression("PE-rich_048"), expression("PC-rich_056"), expression("PC-rich_077"))
# 
# # Strain.labs <- c("PE-rich_127", "PE-rich_048", "PC-rich_056", "PC-rich_077")
# # names(Strain.labs) <- c("BA127R", "BA48R", "BA56G", "BA77G")
# 
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# WL.labs <- c("Strain")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)
# 
# scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
# 
# MaxGrowthNewPlot <- MaxGrowthNew %>%
#   filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
#   # filter(OD720_Lmu_corr == 0 | OD720_Lmu_corr != 0 & OD720_LseGrowthFlag == 1) %>%
#   ggplot() +
#   geom_point(aes(x = PARPhotonDose, y = MaxGrowthH, colour = as.factor(Strain), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = T) +
# labs(y = "Maximum absolute growth rate (h)", x = "PAR photon dose ( µmol photons "~m^-2~""~d^-1~")") +
#    # geom_errorbar(aes(x = PhotonDose, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5, width=70000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +
# 
#   scale_x_continuous(breaks=seq(0, 80000000, by = 20000000)) +
#   coord_cartesian(xlim = c(-100, 83000000)) +
#   scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
#   scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
#   # ggh4x::facet_nested(rows = vars(WL, Strain), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs, Strain = Strain.labs)) +
#   
#   scale_y_continuous(trans = log10_trans(),
#                      breaks = trans_breaks("log10", function(x) 10^x),
#                      labels = trans_format("log10", math_format(10^.x))) +
#   annotation_logticks(sides = "l", colour = "gray60") +
#   #scale_x_continuous(labels = comma) + 
#   scale_x_continuous(label=scientific_10) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=16),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         #plot.background = element_rect(colour = "dodgerblue4", size = 3),
#         legend.position = c(0.90,0.82),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.spacing.x = unit(0.01, 'cm'),
#         legend.title = element_blank(),
#         legend.text = element_text(size=10))
# MaxGrowthNewPlot
# 
# 
# 
# lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# WL.labs <- c("Strain")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)
# 
# scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
# 
# MaxGrowthNewPlot <- MaxGrowthNew %>%
#   filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
#   # filter(OD720_Lmu_corr == 0 | OD720_Lmu_corr != 0 & OD720_LseGrowthFlag == 1) %>%
#   ggplot() +
#   geom_point(aes(x = PURPhotonDose, y = MaxGrowthH, colour = as.factor(Strain), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = T) +
# labs(y = "Maximum absolute growth rate (h)", x = "PUR photon dose ( µmol photons "~m^-2~""~d^-1~")") +
#    # geom_errorbar(aes(x = PhotonDose, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5, width=70000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +
# 
#   scale_x_continuous(breaks=seq(0, 30000000, by = 10000000)) +
#   coord_cartesian(xlim = c(-100, 37000000)) +
#   scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
#   scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
#   # ggh4x::facet_nested(rows = vars(WL, Strain), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs, Strain = Strain.labs)) +
#   
#   scale_y_continuous(trans = log10_trans(),
#                      breaks = trans_breaks("log10", function(x) 10^x),
#                      labels = trans_format("log10", math_format(10^.x))) +
#   annotation_logticks(sides = "l", colour = "gray60") +
#   #scale_x_continuous(labels = comma) + 
#   scale_x_continuous(label=scientific_10) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=16),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         #plot.background = element_rect(colour = "dodgerblue4", size = 3),
#         legend.position = c(0.90,0.82),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.spacing.x = unit(0.01, 'cm'),
#         legend.title = element_blank(),
#         legend.text = element_text(size=10))
# MaxGrowthNewPlot

```

Growth Rate vs maxAGR
```{r fig.height = 6, fig.width = 8, warning = FALSE}
MaxGrowthNew <- MaxGrowth2 %>%
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 
lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))


Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
WL.labs <- c("Strain")
names(WL.labs) <- c("WW")
O2.labs <- c("Light level")
names(O2.labs) <- c(21)

scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

MaxGrowthNewPlot <- MaxGrowthNew %>%
  filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
  # filter(OD720_Lmu_corr == 0 | OD720_Lmu_corr != 0 & OD720_LseGrowthFlag == 1) %>%
  ggplot() +
  geom_point(aes(y = deltaOD_Lmu_corr, x = 1/MaxGrowthH, colour = as.factor(Strain), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = T) +
labs(x = "Maximum absolute growth rate (h)", y = "Logistic growth rate " ~ "("~h^-1~")") +
# 
#    geom_errorbar(aes(x = MaxGrowthH, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5, width=600000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +
  
  # scale_x_continuous(breaks=seq(0, 80000000, by = 20000000)) +
  # coord_cartesian(xlim = c(-100, 83000000)) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  # ggh4x::facet_nested(rows = vars(WL, Strain), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs, Strain = Strain.labs)) +
  
  # scale_y_continuous(trans = log10_trans(),
  #                    breaks = trans_breaks("log10", function(x) 10^x),
  #                    labels = trans_format("log10", math_format(10^.x))) +
  # annotation_logticks(sides = "l", colour = "gray60") +
  #scale_x_continuous(labels = comma) + 
  scale_x_continuous(label=scientific_10) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.position = c(0.90,0.82),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.x = unit(0.01, 'cm'),
        legend.title = element_blank(),
        legend.text = element_text(size=10))
MaxGrowthNewPlot

```




STATISTICS

```{r}
# library("writexl")
# write_xlsx(MultiCultiDataCleanGrowth,"C:/Users/Lenovo/Desktop/JassbyPlatt//growthrateWWPhotoperiod.xlsx")

```

Two factor ANOVA without replication
```{r}
# result <- aov(response ~ factor.A + factor.B + factor.A:factor.B, data = fever)
# summary(result)

GrowthBA127R <- MultiCultiDataCleanGrowth %>% 
filter(Strain == "BA127R")
GrowthBA127R <- aov(OD720_Lmu_corr ~ Par_ue*Photoperiod, GrowthBA127R)
anova(GrowthBA127R)

GrowthBA127R <- MultiCultiDataCleanGrowth %>% 
filter(Strain == "BA127R")
GrowthBA127R <- aov(deltaOD_Lmu_corr ~ Par_ue*Photoperiod, GrowthBA127R)
anova(GrowthBA127R)


GrowthBA48R <- MultiCultiDataCleanGrowth %>% 
filter(Strain == "BA48R")
GrowthBA48R <- aov(OD720_Lmu_corr ~ Par_ue*Photoperiod, GrowthBA48R)
anova(GrowthBA48R)

GrowthBA48R <- MultiCultiDataCleanGrowth %>% 
filter(Strain == "BA48R")
GrowthBA48R <- aov(deltaOD_Lmu_corr ~ Par_ue*Photoperiod, GrowthBA48R)
anova(GrowthBA48R)


GrowthBA56G <- MultiCultiDataCleanGrowth %>% 
filter(Strain == "BA56G")
GrowthBA56G <- aov(OD720_Lmu_corr ~ Par_ue*Photoperiod, GrowthBA56G)
anova(GrowthBA56G)

GrowthBA56G <- MultiCultiDataCleanGrowth %>% 
filter(Strain == "BA56G")
GrowthBA56G <- aov(deltaOD_Lmu_corr ~ Par_ue*Photoperiod, GrowthBA56G)
anova(GrowthBA56G)


GrowthBA77G <- MultiCultiDataCleanGrowth %>% 
filter(Strain == "BA77G")
GrowthBA77G <- aov(OD720_Lmu_corr ~ Par_ue*Photoperiod, GrowthBA77G)
anova(GrowthBA77G)

GrowthBA77G <- MultiCultiDataCleanGrowth %>% 
filter(Strain == "BA77G")
GrowthBA77G <- aov(deltaOD_Lmu_corr ~ Par_ue*Photoperiod, GrowthBA77G)
anova(GrowthBA77G)

```
Tukey test
```{r}

# data.aov = aov(yield ~ temp, data = my_data)
# summary(data.aov)
# TukeyHSD(data.aov)
# data.aov.factor = aov(yield ~ factor(temp), data = my_data)
# summary(data.aov.factor)


GrowthBA77G <- MultiCultiDataCleanGrowth %>% 
filter(Strain == "BA77G")
# data.aov <- aov(deltaOD_Lmu_corr ~ Par_ue, GrowthBA77G)
# summary(data.aov)
# TukeyHSD(data.aov)
data.aov.factor = aov(deltaOD_Lmu_corr ~ factor(Par_ue) + factor(Photoperiod), data = GrowthBA77G)
# data.aov.factor = aov(deltaOD_Lmu_corr ~ factor(Par_ue) + factor(Photoperiod) + factor(Par_ue):factor(Photoperiod), data = GrowthBA77G)
TukeyHSD(data.aov.factor)


# letters
#https://stackoverflow.com/questions/69309101/automatically-adding-letters-of-significance-to-a-ggplot-barplot-using-output-fr


## Source: Rosane Rech
## https://statdoe.com/cld-customisation/#adding-the-letters-indicating-significant-differences
## https://www.youtube.com/watch?v=Uyof3S1gx3M

# library(tidyverse)
# library(ggthemes)
# library(multcompView)
# 


```



# Comparison Multiculti Import data

# Add MultiCulti Data
MultiCulti Import
```{r}
Project <- "PICO"
DataIn <- file.path("..", "ImportedData", "MultiCultiImportSySl", fsep = .Platform$file.sep)
FileEncode <- "UTF-8" 
Delimiter <- ","
HeaderRows <- 0
```

MultiCulti Import
Exported only first time in session
```{r}
list.files(path = DataIn, pattern = Project, full.names = TRUE)
```

MultiCulti Import run39
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20211214_PICO_MC247_RUN39_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData39 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean39 <- MultiCultiData39 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall39 <- MultiCultiDataMean39 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA127R, BA48R
MultiCultiDataMeanSmall39BA127R <- MultiCultiDataMeanSmall39 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall39BA48R <- MultiCultiDataMeanSmall39 %>%
  filter(Strain == "BA48R") 

```

MultiCulti Import run40
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20211223_PICO_MC257_RUN40_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData40 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean40 <- MultiCultiData40 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall40 <- MultiCultiDataMean40 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA127R, BA48R
MultiCultiDataMeanSmall40BA127R <- MultiCultiDataMeanSmall40 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall40BA48R <- MultiCultiDataMeanSmall40 %>%
  filter(Strain == "BA48R") 

```

MultiCulti Import run43
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20211229_PICO_MC247_RUN43_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData43 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean43 <- MultiCultiData43 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall43 <- MultiCultiDataMean43 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA127R, BA48R
MultiCultiDataMeanSmall43BA127R <- MultiCultiDataMeanSmall43 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall43BA48R <- MultiCultiDataMeanSmall43 %>%
  filter(Strain == "BA48R") 

```

MultiCulti Import run44
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220107_PICO_MC257_RUN44_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData44 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean44 <- MultiCultiData44 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall44 <- MultiCultiDataMean44 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA56G, BA77G
MultiCultiDataMeanSmall44BA56G <- MultiCultiDataMeanSmall44 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall44BA77G <- MultiCultiDataMeanSmall44 %>%
  filter(Strain == "BA77G")

```

MultiCulti Import run45
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220113_PICO_MC247_RUN45_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData45 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean45 <- MultiCultiData45 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall45 <- MultiCultiDataMean45 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA56G, BA77G
MultiCultiDataMeanSmall45BA56G <- MultiCultiDataMeanSmall45 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall45BA77G <- MultiCultiDataMeanSmall45 %>%
  filter(Strain == "BA77G")

```

MultiCulti Import run46
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220122_PICO_MC257_RUN46_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData46 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean46 <- MultiCultiData46 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall46 <- MultiCultiDataMean46 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA56G, BA77G
MultiCultiDataMeanSmall46BA56G <- MultiCultiDataMeanSmall46 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall46BA77G <- MultiCultiDataMeanSmall46 %>%
  filter(Strain == "BA77G")

```


MultiCulti Import run60
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220405_PICO_MC247_RUN60_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData60 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean60 <- MultiCultiData60 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall60 <- MultiCultiDataMean60 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#900uE, 8strains
MultiCultiDataMeanSmall60BA127R <- MultiCultiDataMeanSmall60 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall60BA48R <- MultiCultiDataMeanSmall60 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall60BA56G <- MultiCultiDataMeanSmall60 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall60BA77G <- MultiCultiDataMeanSmall60 %>%
  filter(Strain == "BA77G")

```

MultiCulti Import run62
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220410_PICO_MC257_RUN62_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData62 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean62 <- MultiCultiData62 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall62 <- MultiCultiDataMean62 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#900uE, 8strains
MultiCultiDataMeanSmall62BA127R <- MultiCultiDataMeanSmall62 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall62BA48R <- MultiCultiDataMeanSmall62 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall62BA56G <- MultiCultiDataMeanSmall62 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall62BA77G <- MultiCultiDataMeanSmall62 %>%
  filter(Strain == "BA77G") 

```

MultiCulti Import run65
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220420_PICO_MC257_RUN65_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData65 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean65 <- MultiCultiData65 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall65 <- MultiCultiDataMean65 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#900uE, 8strains
MultiCultiDataMeanSmall65BA127R <- MultiCultiDataMeanSmall65 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall65BA48R <- MultiCultiDataMeanSmall65 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall65BA56G <- MultiCultiDataMeanSmall65 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall65BA77G <- MultiCultiDataMeanSmall65 %>%
  filter(Strain == "BA77G") 

```


MultiCulti Import run71
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220507_PICO_MC257_RUN71_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData71 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean71 <- MultiCultiData71 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall71 <- MultiCultiDataMean71 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#30UE, 300uE, 4 strains
MultiCultiDataMeanSmall71BA127R <- MultiCultiDataMeanSmall71 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall71BA48R <- MultiCultiDataMeanSmall71 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall71BA56G <- MultiCultiDataMeanSmall71 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall71BA77G <- MultiCultiDataMeanSmall71 %>%
  filter(Strain == "BA77G") 

```

MultiCulti Import run74
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220607_PICO_MC257_RUN74_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData74 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean74 <- MultiCultiData74 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall74 <- MultiCultiDataMean74 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#90UE, 180uE, 4 strains
MultiCultiDataMeanSmall74BA127R <- MultiCultiDataMeanSmall74 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall74BA48R <- MultiCultiDataMeanSmall74 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall74BA56G <- MultiCultiDataMeanSmall74 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall74BA77G <- MultiCultiDataMeanSmall74 %>%
  filter(Strain == "BA77G") 

```

MultiCulti Import run77
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220615_PICO_MC257_RUN77_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData77 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean77 <- MultiCultiData77 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall77 <- MultiCultiDataMean77 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#600UE, 900uE, 4 strains
MultiCultiDataMeanSmall77BA127R <- MultiCultiDataMeanSmall77 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall77BA48R <- MultiCultiDataMeanSmall77 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall77BA56G <- MultiCultiDataMeanSmall77 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall77BA77G <- MultiCultiDataMeanSmall77 %>%
  filter(Strain == "BA77G") 

```
MultiCulti Import run50
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220206_PICO_MC257_RUN50_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData50 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean50 <- MultiCultiData50 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall50 <- MultiCultiDataMean50 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#600uE, 4strains
MultiCultiDataMeanSmall50BA127R <- MultiCultiDataMeanSmall50 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall50BA48R <- MultiCultiDataMeanSmall50 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall50BA56G <- MultiCultiDataMeanSmall50 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall50BA77G <- MultiCultiDataMeanSmall50 %>%
  filter(Strain == "BA77G")

```


MultiCulti Import run121
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20230816_PICO_MC257_RUN121_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData121 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean121 <- MultiCultiData121 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall121 <- MultiCultiDataMean121 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

# 600 and 900uE, 8strains
MultiCultiDataMeanSmall121BA127R <- MultiCultiDataMeanSmall121 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall121BA48R <- MultiCultiDataMeanSmall121 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall121BA56G <- MultiCultiDataMeanSmall121 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall121BA77G <- MultiCultiDataMeanSmall121 %>%
  filter(Strain == "BA77G")

```








```{r}

MultiCultiDataAllBA127R <- rbind(MultiCultiDataMeanSmall39BA127R, MultiCultiDataMeanSmall40BA127R, MultiCultiDataMeanSmall43BA127R, MultiCultiDataMeanSmall60BA127R, MultiCultiDataMeanSmall62BA127R, MultiCultiDataMeanSmall65BA127R, MultiCultiDataMeanSmall71BA127R, MultiCultiDataMeanSmall74BA127R, MultiCultiDataMeanSmall77BA127R, MultiCultiDataMeanSmall50BA127R, MultiCultiDataMeanSmall121BA127R)


MultiCultiDataAllBA48R <- rbind(MultiCultiDataMeanSmall39BA48R, MultiCultiDataMeanSmall40BA48R, MultiCultiDataMeanSmall43BA48R, MultiCultiDataMeanSmall60BA48R, MultiCultiDataMeanSmall62BA48R, MultiCultiDataMeanSmall65BA48R, MultiCultiDataMeanSmall71BA48R, MultiCultiDataMeanSmall74BA48R, MultiCultiDataMeanSmall77BA48R, MultiCultiDataMeanSmall50BA48R, MultiCultiDataMeanSmall121BA48R)


MultiCultiDataAllBA56G <- rbind(MultiCultiDataMeanSmall44BA56G, MultiCultiDataMeanSmall45BA56G, MultiCultiDataMeanSmall46BA56G, MultiCultiDataMeanSmall60BA56G, MultiCultiDataMeanSmall62BA56G, MultiCultiDataMeanSmall65BA56G, MultiCultiDataMeanSmall71BA56G, MultiCultiDataMeanSmall74BA56G, MultiCultiDataMeanSmall77BA56G, MultiCultiDataMeanSmall50BA56G, MultiCultiDataMeanSmall121BA56G)


MultiCultiDataAllBA77G <- rbind(MultiCultiDataMeanSmall44BA77G, MultiCultiDataMeanSmall45BA77G, MultiCultiDataMeanSmall46BA77G, MultiCultiDataMeanSmall60BA77G, MultiCultiDataMeanSmall62BA77G, MultiCultiDataMeanSmall65BA77G, MultiCultiDataMeanSmall71BA77G, MultiCultiDataMeanSmall74BA77G, MultiCultiDataMeanSmall77BA77G, MultiCultiDataMeanSmall50BA77G, MultiCultiDataMeanSmall121BA77G)



rm(MultiCultiDataMeanSmall39BA127R, MultiCultiDataMeanSmall40BA127R, MultiCultiDataMeanSmall43BA127R, MultiCultiDataMeanSmall60BA127R, MultiCultiDataMeanSmall62BA127R, MultiCultiDataMeanSmall65BA127R, MultiCultiDataMeanSmall71BA127R, MultiCultiDataMeanSmall74BA127R, MultiCultiDataMeanSmall77BA127R, MultiCultiDataMeanSmall39BA48R, MultiCultiDataMeanSmall40BA48R, MultiCultiDataMeanSmall43BA48R, MultiCultiDataMeanSmall60BA48R, MultiCultiDataMeanSmall62BA48R, MultiCultiDataMeanSmall65BA48R, MultiCultiDataMeanSmall71BA48R, MultiCultiDataMeanSmall74BA48R, MultiCultiDataMeanSmall77BA48R, MultiCultiDataMeanSmall44BA56G, MultiCultiDataMeanSmall45BA56G, MultiCultiDataMeanSmall46BA56G, MultiCultiDataMeanSmall60BA56G, MultiCultiDataMeanSmall62BA56G, MultiCultiDataMeanSmall65BA56G, MultiCultiDataMeanSmall71BA56G, MultiCultiDataMeanSmall74BA56G, MultiCultiDataMeanSmall77BA56G, MultiCultiDataMeanSmall44BA77G, MultiCultiDataMeanSmall45BA77G, MultiCultiDataMeanSmall46BA77G, MultiCultiDataMeanSmall60BA77G, MultiCultiDataMeanSmall62BA77G, MultiCultiDataMeanSmall65BA77G, MultiCultiDataMeanSmall71BA77G, MultiCultiDataMeanSmall74BA77G, MultiCultiDataMeanSmall77BA77G)

rm(MultiCultiDataMeanSmall39, MultiCultiDataMeanSmall40, MultiCultiDataMeanSmall43, MultiCultiDataMeanSmall44, MultiCultiDataMeanSmall45, MultiCultiDataMeanSmall46, MultiCultiDataMeanSmall60, MultiCultiDataMeanSmall62, MultiCultiDataMeanSmall65, MultiCultiDataMeanSmall71, MultiCultiDataMeanSmall74, MultiCultiDataMeanSmall77) 

```



```{r}

MultiCultiDataAllStrains <- rbind(MultiCultiDataAllBA127R, MultiCultiDataAllBA48R, MultiCultiDataAllBA56G, MultiCultiDataAllBA77G)

MultiCultiDataAllStrains81216 <- MultiCultiDataAllStrains %>% 
filter(Photoperiod !="24")

MultiCultiDataAllStrains24 <- MultiCultiDataAllStrains %>% 
filter(Photoperiod =="24")


```



```{r}

MultiCultiDataAllStrainsCut <- MultiCultiDataAllStrains %>% 
filter(Par_ue == 900) 
#filter(timeRound <= 110)

MultiCultiDataAllStrainsRest <- MultiCultiDataAllStrains %>% 
filter(Par_ue != 900) 

MultiCultiDataAllStrainsok <- rbind(MultiCultiDataAllStrainsCut, MultiCultiDataAllStrainsRest)
```

# Save data set
```{r save}

# saveRDS(MultiCultiDataAllStrainsok, file.path(DataOut, paste(Project, "MultiCultiDataAllStrainsok.Rds", sep = "_"), fsep = .Platform$file.sep))

```


Growth curve - per strain combine with max growth
```{r fig.height = 8, fig.width = 8, warning = FALSE}
MultiCultiDataAllStrainsok2 <- MultiCultiDataAllStrainsok %>% 
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 

MultiCultiDataAllStrainsok2$facets = factor(MultiCultiDataAllStrainsok2$O2, labels = c("PAR~(µmol~photons~m^{-2}~s^{-1})"))

MultiCultiDataAllStrainsok2$facets2 = factor(MultiCultiDataAllStrainsok2$WL, labels = c("Photoperiod~(h)"))

# lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))

# Par_ue.labs <- c("30", "90", "180", "300", "900")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# 
# Photoperiod.labs <- c("8", "12", "16", "24")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")

# WL.labs <- c("Photoperiod (h)")
# names(WL.labs) <- c("WW")

# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)

# data_vline1 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(347))
# data_vline2 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(345))
# data_vline3 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(188.47))
# data_vline4 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(133.10))

data_vline1 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline2 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(346))
data_vline3 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))
data_vline4 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(344))

data_vline5 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(321.02))
data_vline6 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(319.92))
data_vline7 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline8 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))

data_vline9 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(240.90))
data_vline10 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(240.81))
data_vline11 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(266.84))
data_vline12 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(266.93))

data_vline13 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(187.92))
data_vline14 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(214.41))
data_vline15 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(240.72))
data_vline16 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(215.42))

data_vline17 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110))
data_vline18 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109.5))
data_vline19 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109))
data_vline20 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(108.5))

data_vline21 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline22 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(346))
data_vline23 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))
data_vline24 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(344))

data_vline25 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(245.39))
data_vline26 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(216.33))
data_vline27 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(296.45))
data_vline28 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(244.38))

data_vline29 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(189.48))
data_vline30 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(163.44))
data_vline31 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(217.80))
data_vline32 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(190.39))

data_vline33 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(162.62))
data_vline34 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(136.03))
data_vline35 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(191.03))
data_vline36 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(163.62))

data_vline37 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110))
data_vline38 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109.5))
data_vline39 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109))
data_vline40 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(108.5))

data_vline41 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline42 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(299.38))
data_vline43 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))
data_vline44 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(299.57))

data_vline45 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(168.39))
data_vline46 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(166.28))
data_vline47 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(191.49))
data_vline48 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(168.85))

data_vline49 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(113.76))
data_vline50 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(137.32))
data_vline51 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(114.95))
data_vline52 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(137.50))

data_vline53 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(111.56))
data_vline54 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(111.28))
data_vline55 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(112.75))
data_vline56 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(112.29))

data_vline57 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110))
data_vline58 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109.45))
data_vline59 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(108))
data_vline60 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(107))

data_vline61 <- data.frame(Par_ue= c(30),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(154.64))
data_vline62 <- data.frame(Par_ue= c(30),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(119.35))
data_vline63 <- data.frame(Par_ue= c(30),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(157.85))
data_vline64 <- data.frame(Par_ue= c(30),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(138.78))

data_vline65 <- data.frame(Par_ue= c(90),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(114.68))
data_vline66 <- data.frame(Par_ue= c(90),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(103.77))
data_vline67 <- data.frame(Par_ue= c(90),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(120.27))
data_vline68 <- data.frame(Par_ue= c(90),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(120.18))

data_vline69 <- data.frame(Par_ue= c(180),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(93.32))
data_vline70 <- data.frame(Par_ue= c(180),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(100.38))
data_vline71 <- data.frame(Par_ue= c(180),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110.28))
data_vline72 <- data.frame(Par_ue= c(180),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(108.08))

data_vline73 <- data.frame(Par_ue= c(300),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(93.78))
data_vline74 <- data.frame(Par_ue= c(300),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(79.20))
data_vline75 <- data.frame(Par_ue= c(300),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(95.79))
data_vline76 <- data.frame(Par_ue= c(300),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(98.36))

data_vline77 <- data.frame(Par_ue= c(900),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110))
data_vline78 <- data.frame(Par_ue= c(900),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(94.23))
data_vline79 <- data.frame(Par_ue= c(900),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(79.66))
data_vline80 <- data.frame(Par_ue= c(900),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(107))



MultiCultiDataPlot <- MultiCultiDataAllStrainsok2 %>%
  #filter(timeRound <= 110) %>%
  ggplot() +
  geom_area(aes(x = timeRound, y = meanActinic_par), size = 0.1, fill = "tan1", alpha = 0.6) +
  geom_line(aes(x = timeRound, y = meanOD680, colour = as.factor(Strain)), size = 0.7, show.legend = T) +

  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline17, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline18, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline19, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline20, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline37, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline38, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline39, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline40, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +


  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline57, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline58, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline59, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline60, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline61, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline62, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline63, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline64, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline65, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline66, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline67, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline68, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline69, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline70, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline71, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline72, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline73, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline74, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline75, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline76, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="") +
  labs(y = "Optical density ("~OD[680]~")", x = "Elapsed time (h)") +
  # ggh4x::facet_nested(rows = vars(WL, Photoperiod), cols = vars(facets, Par_ue), labeller = label_parsed, scale="free_x") +

  
    # ggh4x::facet_nested(rows = vars(WL, Photoperiod), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs), scale="free_x") +
  
  ggh4x::facet_nested(cols = vars(facets2, Photoperiod), rows = vars(facets, Par_ue), labeller = label_parsed, scale="free_x") +

  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.085,0.96),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.x = unit(0.01, 'cm'),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.text = element_text(size=10))

MultiCultiDataPlot
```



```{r}
MultiCultiDataAllStrainsok2 <- MultiCultiDataAllStrainsok %>% 
  group_by(ID, timeRound) %>% 
  mutate(DeltaOD = meanOD680-meanOD720) %>% 
ungroup()

```



od720 from Multiculti - mean from day
```{r}
# colnames(MultiCultiDataAllStrainsok)
#group_by(ID, Strain, Par_ue, Day, Run, ExpDate, Photoperiod, Tube) %>% 
MultiCultiOD750 <- MultiCultiDataAllStrainsok %>% 

group_by(ID, Day, ExpDate) %>% 
summarize(ID, timeRound, Filename, Tube, Day, ExpDate, Run,  Strain, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par, meanOD680, meanOD720, meanActinic_parDay = mean(meanActinic_par), meanOD680Day = mean(meanOD680),  meanOD720Day = mean(meanOD720)) %>%
ungroup()

MultiCultiOD750Small <- MultiCultiOD750 %>%
  select(-c(timeRound, meanActinic_par, meanOD680, meanOD720)) %>% 
  unique()
```

Calculated Number of cells/ml based on flow cytometer calibration from Poland and pamas
```{r}
# based on flow cytometer calibration from Poland
# MultiCultiOD750SmallBA127R <- MultiCultiOD750Small %>% 
# filter(Strain == "BA127R") %>% 
# mutate(cellml = 124271003.22*meanOD720Day-1691760.02)
# 
# MultiCultiOD750SmallBA48R <- MultiCultiOD750Small %>% 
# filter(Strain == "BA48R") %>% 
# mutate(cellml = 110516351.55*meanOD720Day-568505.87)
# 
# MultiCultiOD750SmallBA56G <- MultiCultiOD750Small %>% 
# filter(Strain == "BA56G") %>% 
# mutate(cellml = 815627.77*meanOD720Day-6499.89)
# 
# MultiCultiOD750SmallBA77G <- MultiCultiOD750Small %>% 
# filter(Strain == "BA77G") %>% 
# mutate(cellml = 5766620.03*meanOD720Day+5146.44)
# 
# 
# MultiCultiOD750Smallcellml <- rbind(MultiCultiOD750SmallBA127R, MultiCultiOD750SmallBA48R, MultiCultiOD750SmallBA56G, MultiCultiOD750SmallBA77G)
# 
# MultiCultiOD750Smallcellml <- MultiCultiOD750Smallcellml %>% 
#   rename(FilenameMultiCulti = Filename)
# 
# colnames(MultiCultiOD750Smallcellml)




# based on PAMAS calibration
MultiCultiOD750SmallBA127R <- MultiCultiOD750Small %>% 
filter(Strain == "BA127R") %>% 
mutate(cellml = 803505*meanOD720Day+2786)

MultiCultiOD750SmallBA48R <- MultiCultiOD750Small %>% 
filter(Strain == "BA48R") %>% 
mutate(cellml = 600583*meanOD720Day+34902)

MultiCultiOD750SmallBA56G <- MultiCultiOD750Small %>% 
filter(Strain == "BA56G") %>% 
mutate(cellml = 218497*meanOD720Day+34902)

MultiCultiOD750SmallBA77G <- MultiCultiOD750Small %>% 
filter(Strain == "BA77G") %>% 
mutate(cellml = 264482*meanOD720Day+38766)


MultiCultiOD750Smallcellml <- rbind(MultiCultiOD750SmallBA127R, MultiCultiOD750SmallBA48R, MultiCultiOD750SmallBA56G, MultiCultiOD750SmallBA77G)

MultiCultiOD750Smallcellml <- MultiCultiOD750Smallcellml %>% 
  mutate(FilenameMultiCulti = Filename) %>% 
  select(-c(Filename))
colnames(MultiCultiOD750Smallcellml)


```

```{r}
# ClarioOlisPigmentSmall2<-ClarioOlisPigmentSmall %>% 
#   select(-c(E_days))
```


```{r}
colnames(ClarioOlisPigmentSmall)

MultiCultiOD750SmallcellmlPigment <- MultiCultiOD750Smallcellml %>%
  left_join(., ClarioOlisPigmentSmall, by = c("ID"="CultureID", "Run" = "Run", "Strain" = "Strain", "ExpDate" = "ExpDate", "Par_ue" = "Par_ue", "Photoperiod" = "Photoperiod", "Tube" = "Tube", "O2" = "O2", "WL" = "WL", "LightShape" = "LightShape", "Day" = "E_days")) 
```

Pigments Olis per cell - based on calibration form Pamas
```{r}

MultiCultiOD750SmallcellmlPigmentAll <- MultiCultiOD750SmallcellmlPigment %>%
  mutate(Chlapgcell = (ChlaugmL/cellml)*1000000) %>% 
  mutate(Carpgcell = (CarugmL/cellml)*1000000) %>% 
  mutate(PEpgcell = (PEugmL/cellml)*1000000) %>% 
  mutate(PCpgcell = (PCugmL/cellml)*1000000) %>% 
  mutate(APCpgcell = (APCugmL/cellml)*1000000) %>% 
  
  mutate(Phycopgcell = PEpgcell+PCpgcell+APCpgcell) %>% 
  mutate(CarChlaRatio = Carpgcell/Chlapgcell) %>% 
  mutate(PhycoChlaRatio = Phycopgcell/Chlapgcell) %>% 
  mutate(PEPCRatio = PEpgcell/PCpgcell) 
  
```


```{r}
MultiCultiPigmentMax <- MultiCultiOD750SmallcellmlPigmentAll %>%
  mutate(E_days = Day) %>% 
  mutate(Time_h = E_days*24) %>% 
  select(-c(Day))
  
```

test plot
```{r}
lab1=c(expression("PE-rich_127"), expression("PE-rich_048"), expression("PC-rich_056"), expression("PC-rich_077"))
#lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
names(Photoperiod.labs) <- c("8", "12", "16", "24")
WL.labs <- c("Photoperiod")
names(WL.labs) <- c("WW")
O2.labs <- c("Light level")
names(O2.labs) <- c(21)

MultiCultiOD750SmallcellmlPigmentAllPlot <- MultiCultiPigmentMax %>%
  # filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
  # filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
  # filter(Photoperiod != "24") %>%
  #filter(E_days != "1") %>%
  ggplot() +
  # geom_smooth(aes(x = Time_h, y = Chlapgcell, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
  geom_point(aes(x = E_days, y = Chlapgcell, colour = as.factor(Strain)),  alpha = 0.9, size = 3, show.legend = T) +
#   

  scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
  scale_y_continuous(breaks=seq(0, 15, by = 3)) +
  coord_cartesian(ylim = c(-0.5, 15.5)) +
  labs(y = "Chl" ~italic(a)~ "content ( fg " ~ cell^-1~")", x = "Elapsed time (h)") +
  ggh4x::facet_nested(cols = vars(WL, Photoperiod), rows = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.07,0.95),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.text = element_text(size=10))
MultiCultiOD750SmallcellmlPigmentAllPlot


```


Pigments per cell (pg/cell) - photondose and Par_ue
```{r fig.height = 6, fig.width = 8, warning = FALSE}

# data_vline1 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(347))
# data_vline2 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(346))
# data_vline3 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(345))
# data_vline4 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(344))
# 
# data_vline5 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(321.02))
# data_vline6 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(319.92))
# data_vline7 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(347))
# data_vline8 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(345))
# 
# data_vline9 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(240.90))
# data_vline10 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(240.81))
# data_vline11 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(266.84))
# data_vline12 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(266.93))
# 
# data_vline13 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(187.92))
# data_vline14 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(214.41))
# data_vline15 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(240.72))
# data_vline16 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(215.42))
# 
# data_vline21 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(347))
# data_vline22 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(346))
# data_vline23 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(345))
# data_vline24 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(344))
# 
# data_vline25 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(245.39))
# data_vline26 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(216.33))
# data_vline27 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(296.45))
# data_vline28 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(244.38))
# 
# data_vline29 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(189.48))
# data_vline30 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(163.44))
# data_vline31 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(217.80))
# data_vline32 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(190.39))
# 
# data_vline33 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(162.62))
# data_vline34 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(136.03))
# data_vline35 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(191.03))
# data_vline36 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(163.62))
# 
# data_vline41 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(347))
# data_vline42 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(299.38))
# data_vline43 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(345))
# data_vline44 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(299.57))
# 
# data_vline45 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(168.39))
# data_vline46 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(166.28))
# data_vline47 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(191.49))
# data_vline48 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(168.85))
# 
# data_vline49 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(113.76))
# data_vline50 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(137.32))
# data_vline51 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(114.95))
# data_vline52 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(137.50))
# 
# data_vline53 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(111.56))
# data_vline54 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(111.28))
# data_vline55 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(112.75))
# data_vline56 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(112.29))
# 
# 
lab1=c(expression("PE-rich_127"), expression("PE-rich_048"), expression("PC-rich_056"), expression("PC-rich_077"))
#lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
names(Photoperiod.labs) <- c("8", "12", "16", "24")
WL.labs <- c("Photoperiod")
names(WL.labs) <- c("WW")
O2.labs <- c("Light level")
names(O2.labs) <- c(21)

MultiCultiOD750SmallcellmlPigmentAllPlot <- MultiCultiPigmentMax %>%
  # filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
  # filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
  # filter(Photoperiod != "24") %>%
  #filter(E_days != "1") %>%
  ggplot() +
  # geom_smooth(aes(x = Time_h, y = Chlapgcell, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
  geom_point(aes(x = Time_h, y = Chlapgcell, colour = as.factor(Strain)),  alpha = 0.9, size = 3, show.legend = T) +
#   
#   geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
  scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
  scale_y_continuous(breaks=seq(0, 15, by = 3)) +
  coord_cartesian(ylim = c(-0.5, 15.5)) +
  labs(y = "Chl" ~italic(a)~ "content ( fg " ~ cell^-1~")", x = "Elapsed time (h)") +
  ggh4x::facet_nested(cols = vars(WL, Photoperiod), rows = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.07,0.95),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.text = element_text(size=10))
MultiCultiOD750SmallcellmlPigmentAllPlot


# lab1=c(expression("PE-rich_127"), expression("PE-rich_048"), expression("PC-rich_056"), expression("PC-rich_077"))
# #lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# WL.labs <- c("Photoperiod")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)
# MultiCultiOD750SmallcellmlPigmentAllPlot <- MultiCultiPigmentMax %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(E_days != "1") %>%
#   ggplot() +
#   # geom_smooth(aes(x = Time_h, y = Carpgcell, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
#   geom_point(aes(x = Time_h, y = Carpgcell, colour = as.factor(Strain)),  alpha = 0.9, size = 3, show.legend = T) +
#     geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   scale_y_continuous(breaks=seq(0, 5, by = 1)) +
#   coord_cartesian(ylim = c(0, 5.5)) +
#   labs(y = "Car content ( fg " ~ cell^-1~")", x = "Elapsed time (h)") +
#   ggh4x::facet_nested(rows = vars(WL, Photoperiod), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=16),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.07,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         #plot.background = element_rect(colour = "dodgerblue4", size = 3),
#         legend.text = element_text(size=10))
# MultiCultiOD750SmallcellmlPigmentAllPlot
# 
# lab1=c(expression("PE-rich_127"), expression("PE-rich_048"), expression("PC-rich_056"), expression("PC-rich_077"))
# #lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# WL.labs <- c("Photoperiod")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)
# MultiCultiOD750SmallcellmlPigmentAllPlot <- MultiCultiPigmentMax %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(E_days != "1") %>%
#   ggplot() +
#   # geom_smooth(aes(x = Time_h, y = PEpgcell, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
#   geom_point(aes(x = Time_h, y = PEpgcell, colour = as.factor(Strain)),  alpha = 0.9, size = 3, show.legend = T) +
#     geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   scale_y_continuous(breaks=seq(0, 40, by = 10)) +
#   coord_cartesian(ylim = c(-5, 45)) +
#   labs(y = "PE content ( fg " ~ cell^-1~")", x = "Elapsed time (h)") +
#   ggh4x::facet_nested(rows = vars(WL, Photoperiod), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=16),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.07,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         #plot.background = element_rect(colour = "dodgerblue4", size = 3),
#         legend.text = element_text(size=10))
# MultiCultiOD750SmallcellmlPigmentAllPlot
# 
# lab1=c(expression("PE-rich_127"), expression("PE-rich_048"), expression("PC-rich_056"), expression("PC-rich_077"))
# #lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# WL.labs <- c("Photoperiod")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)
# MultiCultiOD750SmallcellmlPigmentAllPlot <- MultiCultiPigmentMax %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(E_days != "1") %>%
#   ggplot() +
#   # geom_smooth(aes(x = Time_h, y = PCpgcell, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
#   geom_point(aes(x = Time_h, y = PCpgcell, colour = as.factor(Strain)),  alpha = 0.9, size = 3, show.legend = T) +
#     geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   scale_y_continuous(breaks=seq(0, 40, by = 10)) +
#   coord_cartesian(ylim = c(-5, 45)) +
#   labs(y = "PC content ( fg " ~ cell^-1~")", x = "Elapsed time (h)") +
#   ggh4x::facet_nested(rows = vars(WL, Photoperiod), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=16),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.07,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         #plot.background = element_rect(colour = "dodgerblue4", size = 3),
#         legend.text = element_text(size=10))
# MultiCultiOD750SmallcellmlPigmentAllPlot
# 
# 
# lab1=c(expression("PE-rich_127"), expression("PE-rich_048"), expression("PC-rich_056"), expression("PC-rich_077"))
# #lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# WL.labs <- c("Photoperiod")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)
# MultiCultiOD750SmallcellmlPigmentAllPlot <- MultiCultiPigmentMax %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(E_days != "1") %>%
#   ggplot() +
#   # geom_smooth(aes(x = Time_h, y = APCpgcell, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
#   geom_point(aes(x = Time_h, y = APCpgcell, colour = as.factor(Strain)),  alpha = 0.9, size = 3, show.legend = T) +
#     geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   scale_y_continuous(breaks=seq(0, 5, by = 1)) +
#   coord_cartesian(ylim = c(-0.5, 5.5)) +
#   labs(y = "APC content ( fg " ~ cell^-1~")", x = "Elapsed time (h)") +
#   ggh4x::facet_nested(rows = vars(WL, Photoperiod), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=16),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.07,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         #plot.background = element_rect(colour = "dodgerblue4", size = 3),
#         legend.text = element_text(size=10))
# MultiCultiOD750SmallcellmlPigmentAllPlot
# 
# 
# lab1=c(expression("PE-rich_127"), expression("PE-rich_048"), expression("PC-rich_056"), expression("PC-rich_077"))
# #lab1=c(expression("BA127R"), expression("BA48R"), expression("BA56G"), expression("BA77G"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# WL.labs <- c("Photoperiod")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)
# MultiCultiOD750SmallcellmlPigmentAllPlot <- MultiCultiPigmentMax %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(E_days != "1") %>%
#   ggplot() +
# 
#   # geom_smooth(aes(x = Time_h, y = Phycopgcell, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
#   geom_point(aes(x = Time_h, y = Phycopgcell, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
#   
#   geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   scale_y_continuous(breaks=seq(0, 50, by = 10)) +
#   coord_cartesian(ylim = c(-5, 55)) +
#   labs(y = "Total phycobilin content ( fg  " ~ cell^-1~")", x = "Elapsed time (h)") +
#   ggh4x::facet_nested(cols = vars(WL, Photoperiod), rows = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=16),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.07,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         #plot.background = element_rect(colour = "dodgerblue4", size = 3),
#         legend.text = element_text(size=10))
# MultiCultiOD750SmallcellmlPigmentAllPlot

```

# Save data set
```{r save}

# saveRDS(MultiCultiPigmentMax, file.path(DataOut, paste(Project, "MultiCultiPigmentMax.Rds", sep = "_"), fsep = .Platform$file.sep))

```


Tot Phyco - PARphotondose and chla-PARphotondose
```{r fig.height = 5, fig.width = 8, warning = FALSE}


MultiCultiPigmentMaxNew <- MultiCultiPigmentMax %>% 
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 

scaleFUN <- function(x) sprintf("%.1f", x)
MultiCultiPigmentMax$facets = factor(MultiCultiPigmentMax$WL, labels = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"))

lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))

data_vline1 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline2 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(346))
data_vline3 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline4 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(344))

data_vline25 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(245.39))
data_vline26 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(216.33))
data_vline27 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(296.45))
data_vline28 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(244.38))

data_vline29 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(189.48))
data_vline30 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.44))
data_vline31 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(217.80))
data_vline32 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(190.39))

data_vline33 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(162.62))
data_vline34 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(136.03))
data_vline35 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(191.03))
data_vline36 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.62))

data_vline41 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline42 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.38))
data_vline43 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline44 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.57))

data_vline53 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.56))
data_vline54 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.28))
data_vline55 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.75))
data_vline56 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.29))

data_vline77 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(110))
data_vline78 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(94.23))
data_vline79 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(79.66))
data_vline80 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(107))


data_text <- data.frame(
  facets   = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),
  PARPhotonDose = c(77760000),
  label = c('B'))

PhycoPlot <- MultiCultiPigmentMaxNew %>%
  filter(PARPhotonDose == 432000|
  PARPhotonDose == 864000|
  PARPhotonDose == 1944000|
  PARPhotonDose == 3888000|
  PARPhotonDose == 6480000|
  PARPhotonDose == 8640000|
  PARPhotonDose == 77760000) %>%
  
  filter(PhycoChlaRatio> 0) %>% 
  #filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
  ggplot() +

  geom_point(aes(x = Time_h, y = Phycopgcell, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +

  #geom_text(data=data_text, aes(x=300, y=48, label=label), size=5) +
  
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  
  scale_y_continuous(breaks=seq(0, 50, by = 10)) +
  coord_cartesian(ylim = c(0, 50)) +
  labs(y = "Phyco content ( fg  " ~ cell^-1~")", x = "Elapsed time (h)") +
  
  ggh4x::facet_nested(cols = vars(facets, PARPhotonDose), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        #axis.text.x = element_blank(),
        axis.text.x = element_text(size=11.5),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        #axis.title.x = element_blank(),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.065,0.91),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PhycoPlot






MultiCultiPigmentMaxNew <- MultiCultiPigmentMax %>% 
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 

scaleFUN <- function(x) sprintf("%.1f", x)
MultiCultiPigmentMax$facets = factor(MultiCultiPigmentMax$WL, labels = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"))

lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))

data_vline1 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline2 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(346))
data_vline3 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline4 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(344))

data_vline25 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(245.39))
data_vline26 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(216.33))
data_vline27 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(296.45))
data_vline28 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(244.38))

data_vline29 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(189.48))
data_vline30 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.44))
data_vline31 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(217.80))
data_vline32 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(190.39))

data_vline33 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(162.62))
data_vline34 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(136.03))
data_vline35 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(191.03))
data_vline36 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.62))

data_vline41 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline42 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.38))
data_vline43 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline44 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.57))

data_vline53 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.56))
data_vline54 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.28))
data_vline55 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.75))
data_vline56 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.29))

data_vline77 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(110))
data_vline78 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(94.23))
data_vline79 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(79.66))
data_vline80 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(107))


data_text <- data.frame(
  facets   = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),
  PARPhotonDose = c(77760000),
  label = c('B'))

PhycoPlot <- MultiCultiPigmentMaxNew %>%
  filter(PARPhotonDose == 432000|
  PARPhotonDose == 864000|
  PARPhotonDose == 1944000|
  PARPhotonDose == 3888000|
  PARPhotonDose == 6480000|
  PARPhotonDose == 8640000|
  PARPhotonDose == 77760000) %>%
  
  filter(PhycoChlaRatio> 0) %>% 
  #filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
  ggplot() +

  geom_point(aes(x = Time_h, y = Chlapgcell, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  #geom_text(data=data_text, aes(x=300, y=48, label=label), size=5) +
  
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  
  # scale_y_continuous(labels=scaleFUN, breaks=seq(0, 50, by = 10)) +
  # coord_cartesian(ylim = c(-5, 55)) +
  
  scale_y_continuous(breaks=seq(0, 15, by = 3)) +
  coord_cartesian(ylim = c(0, 15)) +
  labs(y = "Chl" ~italic(a)~ "content ( fg  " ~ cell^-1~")", x = "Elapsed time (h)") +
  
  ggh4x::facet_nested(cols = vars(facets, PARPhotonDose), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        #axis.text.x = element_blank(),
        axis.text.x = element_text(size=11.5),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        #axis.title.x = element_blank(),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.065,0.91),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PhycoPlot

```



pigments exp
```{r}


O1 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 30 | Par_ue == 300 | Par_ue == 90 | Par_ue == 180) %>% 
  filter(Photoperiod == 24) %>% 
  filter(Day < 4)

O2 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 180 | Par_ue == 300) %>% 
  filter(Photoperiod == 16) %>% 
  filter(Day == 4)

O3 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 16) %>% 
  filter(Day == 6)

O4 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 30) %>% 
  filter(Photoperiod == 16) %>% 
  filter(Day == 12)

O5 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 900) %>% 
  filter(Photoperiod == 16) %>% 
  filter(Day == 4)

O6 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 30) %>% 
  filter(Photoperiod == 8 | Photoperiod == 12) %>% 
  filter(Day == 12| Day == 13)
  
O7 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Day == 12 | Day ==13)

O8 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(Day == 8 | Day ==9)

O9 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(Day == 11)

O10 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Day == 8 | Day == 9)

O11 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Day == 6 | Day == 7)

O12 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(Day == 6 | Day ==7)

O13 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(Day == 9)

O14 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(Day == 4 | Day ==5)

O15 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PC-rich_056") %>%  
  filter(Day == 7)

O16 <- MultiCultiPigmentMaxNew %>%
  filter(Par_ue == 900) %>% 
  filter(Photoperiod == 8 | Photoperiod == 12 | Photoperiod == 24) 

MultiCultiPigmentExp <-rbind(O1, O2, O3, O4, O5, O6, O7, O8, O9, O10, O11, O12, O13, O14, O15, O16)

rm(O1, O2, O3, O4, O5, O6, O7, O8, O9, O10, O11, O12, O13, O14, O15, O16)

MultiCultiPigmentExp2<-MultiCultiPigmentExp %>% 
drop_na()
```


# Save data set
```{r save}

# saveRDS(MultiCultiPigmentExp2, file.path(DataOut, paste(Project, "MultiCultiPigmentExp2.Rds", sep = "_"), fsep = .Platform$file.sep))

```



Tot Phyco - PARphotondose and chla-PARphotondose
```{r fig.height = 5, fig.width = 8, warning = FALSE}


scaleFUN <- function(x) sprintf("%.1f", x)
MultiCultiPigmentExp$facets = factor(MultiCultiPigmentExp$WL, labels = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"))

lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))

data_vline1 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline2 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(346))
data_vline3 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline4 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(344))

data_vline25 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(245.39))
data_vline26 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(216.33))
data_vline27 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(296.45))
data_vline28 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(244.38))

data_vline29 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(189.48))
data_vline30 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.44))
data_vline31 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(217.80))
data_vline32 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(190.39))

data_vline33 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(162.62))
data_vline34 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(136.03))
data_vline35 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(191.03))
data_vline36 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.62))

data_vline41 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline42 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.38))
data_vline43 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline44 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.57))

data_vline53 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.56))
data_vline54 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.28))
data_vline55 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.75))
data_vline56 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.29))

data_vline77 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(110))
data_vline78 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(94.23))
data_vline79 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(79.66))
data_vline80 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(107))


data_text <- data.frame(
  facets   = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),
  PARPhotonDose = c(77760000),
  label = c('B'))

PhycoPlot <- MultiCultiPigmentExp %>%
  filter(PARPhotonDose == 432000|
  PARPhotonDose == 864000|
  PARPhotonDose == 1944000|
  PARPhotonDose == 3888000|
  PARPhotonDose == 6480000|
  PARPhotonDose == 8640000|
  PARPhotonDose == 77760000) %>%
  
  filter(PhycoChlaRatio> 0) %>% 
  #filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
  ggplot() +

  geom_point(aes(x = Time_h, y = Phycopgcell, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +

  #geom_text(data=data_text, aes(x=300, y=48, label=label), size=5) +
  
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  
  scale_y_continuous(breaks=seq(0, 50, by = 10)) +
  coord_cartesian(ylim = c(0, 50)) +
  labs(y = "Phyco content ( fg  " ~ cell^-1~")", x = "Elapsed time (h)") +
  
  ggh4x::facet_nested(cols = vars(facets, PARPhotonDose), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        #axis.text.x = element_blank(),
        axis.text.x = element_text(size=11.5),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        #axis.title.x = element_blank(),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.065,0.91),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PhycoPlot




scaleFUN <- function(x) sprintf("%.1f", x)
MultiCultiPigmentExp$facets = factor(MultiCultiPigmentExp$WL, labels = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"))

lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))

data_vline1 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline2 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(346))
data_vline3 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline4 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(344))

data_vline25 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(245.39))
data_vline26 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(216.33))
data_vline27 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(296.45))
data_vline28 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(244.38))

data_vline29 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(189.48))
data_vline30 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.44))
data_vline31 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(217.80))
data_vline32 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(190.39))

data_vline33 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(162.62))
data_vline34 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(136.03))
data_vline35 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(191.03))
data_vline36 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.62))

data_vline41 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline42 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.38))
data_vline43 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline44 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.57))

data_vline53 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.56))
data_vline54 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.28))
data_vline55 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.75))
data_vline56 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.29))

data_vline77 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(110))
data_vline78 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(94.23))
data_vline79 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(79.66))
data_vline80 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(107))


data_text <- data.frame(
  facets   = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),
  PARPhotonDose = c(77760000),
  label = c('B'))

PhycoPlot <- MultiCultiPigmentExp %>%
  filter(PARPhotonDose == 432000|
  PARPhotonDose == 864000|
  PARPhotonDose == 1944000|
  PARPhotonDose == 3888000|
  PARPhotonDose == 6480000|
  PARPhotonDose == 8640000|
  PARPhotonDose == 77760000) %>%
  
  filter(PhycoChlaRatio> 0) %>% 
  #filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
  ggplot() +

  geom_point(aes(x = Time_h, y = Chlapgcell, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  #geom_text(data=data_text, aes(x=300, y=48, label=label), size=5) +
  
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  
  # scale_y_continuous(labels=scaleFUN, breaks=seq(0, 50, by = 10)) +
  # coord_cartesian(ylim = c(-5, 55)) +
  
  scale_y_continuous(breaks=seq(0, 15, by = 3)) +
  coord_cartesian(ylim = c(0, 15)) +
  labs(y = "Chl" ~italic(a)~ "content ( fg  " ~ cell^-1~")", x = "Elapsed time (h)") +
  
  ggh4x::facet_nested(cols = vars(facets, PARPhotonDose), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        #axis.text.x = element_blank(),
        axis.text.x = element_text(size=11.5),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        #axis.title.x = element_blank(),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.065,0.91),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PhycoPlot

```




car/chla, phyco/chla max - photoperiod and Par_ue
```{r fig.height = 6, fig.width = 8, warning = FALSE}

# data_vline1 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(347))
# data_vline2 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(346))
# data_vline3 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(345))
# data_vline4 <- data.frame(Par_ue= c(30),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(344))
# 
# data_vline5 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(321.02))
# data_vline6 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(319.92))
# data_vline7 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(347))
# data_vline8 <- data.frame(Par_ue= c(90),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(345))
# 
# data_vline9 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(240.90))
# data_vline10 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(240.81))
# data_vline11 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(266.84))
# data_vline12 <- data.frame(Par_ue= c(180),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(266.93))
# 
# data_vline13 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(187.92))
# data_vline14 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(214.41))
# data_vline15 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(240.72))
# data_vline16 <- data.frame(Par_ue= c(300),Photoperiod= c(8),O2= c(21),WL= c("WW"),value = c(215.42))
# 
# data_vline21 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(347))
# data_vline22 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(346))
# data_vline23 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(345))
# data_vline24 <- data.frame(Par_ue= c(30),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(344))
# 
# data_vline25 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(245.39))
# data_vline26 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(216.33))
# data_vline27 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(296.45))
# data_vline28 <- data.frame(Par_ue= c(90),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(244.38))
# 
# data_vline29 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(189.48))
# data_vline30 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(163.44))
# data_vline31 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(217.80))
# data_vline32 <- data.frame(Par_ue= c(180),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(190.39))
# 
# data_vline33 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(162.62))
# data_vline34 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(136.03))
# data_vline35 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(191.03))
# data_vline36 <- data.frame(Par_ue= c(300),Photoperiod= c(12),O2= c(21),WL= c("WW"),value = c(163.62))
# 
# data_vline41 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(347))
# data_vline42 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(299.38))
# data_vline43 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(345))
# data_vline44 <- data.frame(Par_ue= c(30),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(299.57))
# 
# data_vline45 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(168.39))
# data_vline46 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(166.28))
# data_vline47 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(191.49))
# data_vline48 <- data.frame(Par_ue= c(90),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(168.85))
# 
# data_vline49 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(113.76))
# data_vline50 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(137.32))
# data_vline51 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(114.95))
# data_vline52 <- data.frame(Par_ue= c(180),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(137.50))
# 
# data_vline53 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(111.56))
# data_vline54 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(111.28))
# data_vline55 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(112.75))
# data_vline56 <- data.frame(Par_ue= c(300),Photoperiod= c(16),O2= c(21),WL= c("WW"),value = c(112.29))
# 
#   
# lab1=c(expression("PE-rich_127"), expression("PE-rich_048"), expression("PC-rich_056"), expression("PC-rich_077"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# WL.labs <- c("Photoperiod")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)
# MultiCultiOD750SmallcellmlPigmentAllPlot <- MultiCultiPigmentMax %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(E_days != "1") %>%
#   ggplot() +
#   # geom_smooth(aes(x = Time_h, y = ChlaCarRatio, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
#   geom_point(aes(x = Time_h, y = CarChlaRatio, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
#   
#   geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   # scale_y_continuous(breaks=seq(0, 5, by = 1)) +
#   # coord_cartesian(ylim = c(-0.5, 5.5)) +
#   labs(y = "Car/Chl" ~italic(a)~ "ratio", x = "Elapsed time (h)") +
#   
#   ggh4x::facet_nested(rows = vars(WL, Photoperiod), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=16),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.07,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         #plot.background = element_rect(colour = "dodgerblue4", size = 3),
#         legend.text = element_text(size=10))
# MultiCultiOD750SmallcellmlPigmentAllPlot
# 
# 
# 
# lab1=c(expression("PE-rich_127"), expression("PE-rich_048"), expression("PC-rich_056"), expression("PC-rich_077"))
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# Photoperiod.labs <- c("8 h", "12 h", "16 h", "24 h")
# names(Photoperiod.labs) <- c("8", "12", "16", "24")
# WL.labs <- c("Photoperiod")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)
# MultiCultiOD750SmallcellmlPigmentAllPlot <- MultiCultiPigmentMax %>%
#   filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
#   filter(Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) %>%
#   filter(Photoperiod != "24") %>%
#   #filter(PhycoChlaRatio >= -0.5 & PhycoChlaRatio <= 4) %>%
#   ggplot() +
#   # geom_smooth(aes(x = Time_h, y = ChlaPhycoRatio, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
#   geom_point(aes(x = Time_h, y = PhycoChlaRatio, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
#   
#   geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
#   geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
#   geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "palegreen4") +
#   geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
#   
#   scale_colour_discrete(type=c("brown4", "brown1", "palegreen4", "palegreen3"), name="", labels = lab1) +
#   # scale_y_continuous(breaks=seq(0, 5, by = 1)) +
#   # coord_cartesian(ylim = c(-0.5, 5.5)) +
#   labs(y = "Total phycobilin/Chl " ~italic(a)~ "ratio", x = "Elapsed time (h)") +
#   ggh4x::facet_nested(rows = vars(WL, Photoperiod), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.title = element_text(size=16),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.07,0.95),
#         #legend.key = element_rect(size = 0.1, fill = "transparent"),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.key.width= unit(0.005, 'cm'),
#         # legend.text.align = 0,
#         legend.spacing.x = unit(0.01, 'cm'),
#         #plot.background = element_rect(colour = "dodgerblue4", size = 3),
#         legend.text = element_text(size=10))
# MultiCultiOD750SmallcellmlPigmentAllPlot
#   
```


car/chla and Phyco/chla - PARphotondose
```{r fig.height = 5, fig.width = 8, warning = FALSE}
MultiCultiPigmentMaxNew <- MultiCultiPigmentMax %>% 
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 

scaleFUN <- function(x) sprintf("%.1f", x)
MultiCultiPigmentMax$facets = factor(MultiCultiPigmentMax$WL, labels = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"))

lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))

data_vline1 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline2 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(346))
data_vline3 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline4 <- data.frame(PARPhotonDose= c(432000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(344))

data_vline25 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(245.39))
data_vline26 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(216.33))
data_vline27 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(296.45))
data_vline28 <- data.frame(PARPhotonDose= c(1944000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(244.38))

data_vline29 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(189.48))
data_vline30 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.44))
data_vline31 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(217.80))
data_vline32 <- data.frame(PARPhotonDose= c(3888000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(190.39))

data_vline33 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(162.62))
data_vline34 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(136.03))
data_vline35 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(191.03))
data_vline36 <- data.frame(PARPhotonDose= c(6480000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(163.62))

data_vline41 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(347))
data_vline42 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.38))
data_vline43 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(345))
data_vline44 <- data.frame(PARPhotonDose= c(864000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(299.57))

data_vline53 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.56))
data_vline54 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(111.28))
data_vline55 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.75))
data_vline56 <- data.frame(PARPhotonDose= c(8640000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(112.29))

data_vline77 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(110))
data_vline78 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(94.23))
data_vline79 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(79.66))
data_vline80 <- data.frame(PARPhotonDose= c(77760000),facets= c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),value = c(107))


data_text <- data.frame(
  facets   = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"),
  PARPhotonDose = c(77760000),
  label = c('B'))

PhycoPlot <- MultiCultiPigmentMaxNew %>%
  filter(PARPhotonDose == 432000|
  PARPhotonDose == 864000|
  PARPhotonDose == 1944000|
  PARPhotonDose == 3888000|
  PARPhotonDose == 6480000|
  PARPhotonDose == 8640000|
  PARPhotonDose == 77760000) %>%
  
  filter(PhycoChlaRatio> 0) %>% 
  #filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
  ggplot() +

  geom_point(aes(x = Time_h, y = CarChlaRatio, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  #geom_text(data=data_text, aes(x=300, y=48, label=label), size=5) +
  
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  
  # scale_y_continuous(labels=scaleFUN, breaks=seq(0, 50, by = 10)) +
  # coord_cartesian(ylim = c(-5, 55)) +
  
  scale_y_continuous(breaks=seq(0, 0.8, by = 0.2)) +
  coord_cartesian(ylim = c(0, 0.8)) +
  labs(y = "Car/Chl" ~italic(a)~ "ratio", x = "Elapsed time (h)") +
  
  ggh4x::facet_nested(cols = vars(facets, PARPhotonDose), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        #axis.text.x = element_blank(),
        axis.text.x = element_text(size=11.5),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        #axis.title.x = element_blank(),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.065,0.91),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PhycoPlot





scaleFUN <- function(x) sprintf("%.1f", x)
MultiCultiPigmentMax$facets = factor(MultiCultiPigmentMax$WL, labels = c("PAR~photon~dose~(µmol~photons~m^{-2}~d^{-1})"))

lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))

PhycoPlot <- MultiCultiPigmentMaxNew %>%
  filter(PARPhotonDose == 432000|
  PARPhotonDose == 864000|
  PARPhotonDose == 1944000|
  PARPhotonDose == 3888000|
  PARPhotonDose == 6480000|
  PARPhotonDose == 8640000|
  PARPhotonDose == 77760000) %>%
  
  filter(PhycoChlaRatio> 0) %>% 
  #filter(Strain == "BA77G" | Strain == "BA56G" | Strain == "BA127R" | Strain == "BA48R") %>%
  ggplot() +

  geom_point(aes(x = Time_h, y = PhycoChlaRatio, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  #geom_text(data=data_text, aes(x=300, y=48, label=label), size=5) +
  
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  
  scale_y_continuous(labels=scaleFUN, breaks=seq(0, 8, by = 2)) +
  coord_cartesian(ylim = c(0, 8)) +
  labs(y = "Phyco/Chl " ~italic(a)~ "ratio", x = "Elapsed time (h)") +
  
  ggh4x::facet_nested(cols = vars(facets, PARPhotonDose), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        #axis.text.x = element_blank(),
        axis.text.x = element_text(size=11.5),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        #axis.title.x = element_blank(),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.065,0.91),
        #legend.key = element_rect(size = 0.1, fill = "transparent"),
        legend.key.height= unit(0.005, 'cm'),
        legend.key.width= unit(0.005, 'cm'),
        # legend.text.align = 0,
        legend.spacing.x = unit(0.01, 'cm'),
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PhycoPlot

```



Pigment max time
```{r}

#colnames(MultiCultiPigmentMax)
MultiCultiPigmentMaxGrowth <- na.omit(MultiCultiPigmentMax)

MultiCultiPigmentMaxGrowth<- MultiCultiPigmentMaxGrowth %>%
  group_by(Strain, Par_ue, Photoperiod) %>%
  summarise(ID, Day, ExpDate, Run, Strain, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_parDay, meanOD680Day, meanOD720Day, cellml, ChlaugmL, CarugmL, PEugmL, PCugmL, APCugmL, PARPhotonDose, Chlapgcell, Carpgcell, PEpgcell, PCpgcell, APCpgcell, Phycopgcell, CarChlaRatio, PhycoChlaRatio, Time_h, facets, MaxChlapgcell = max(Chlapgcell, na.rm = TRUE), MaxCarpgcell = max(Carpgcell, na.rm = TRUE), MaxPhycopgcell = max(Phycopgcell, na.rm = TRUE), MaxPhycoChlaRatio = max(PhycoChlaRatio, na.rm = TRUE), MaxCarChlaRatio = max(CarChlaRatio, na.rm = TRUE), MaxPEpgcell = max(PEpgcell, na.rm = TRUE), MaxPCpgcell = max(PCpgcell, na.rm = TRUE), MaxAPCpgcell = max(APCpgcell, na.rm = TRUE))


MultiCultiPigmentMaxGrowth<- MultiCultiPigmentMaxGrowth %>%
group_by(Strain, Par_ue, Photoperiod) %>%
mutate(TimeMaxChla = Time_h[which.max(Chlapgcell)],
       TimeMaxCar = Time_h[which.max(Carpgcell)],
       TimeMaxPhyco = Time_h[which.max(Phycopgcell)],
       TimeMaxPhycoChlaRatio = Time_h[which.max(PhycoChlaRatio)],
       TimeMaxCarChlaRatio = Time_h[which.max(CarChlaRatio)],
       TimeMinCarChlaRatio = Time_h[which.min(CarChlaRatio)])

# MultiCultiPigmentMaxGrowth2<- MultiCultiPigmentMaxGrowth %>%
#   select(-c(meanActinic_parDay, meanOD680Day, meanOD720Day, cellml, ChlaugmL, CarugmL, PEugmL, PCugmL, APCugmL, Chlapgcell, Carpgcell, PEpgcell, PCpgcell, APCpgcell, Phycopgcell, CarChlaRatio, PhycoChlaRatio, Time_h, facets, Day)) %>% 
#   unique()

```


```{r}
#colnames(MultiCultiPigmentMaxGrowth2)


PigmentMaxGrowth <- MultiCultiPigmentMaxGrowth %>%
  left_join(., MaxGrowthMetaData, by = c("Strain" = "Strain", "Par_ue" = "Par_ue", "Photoperiod" = "Photoperiod")) 
```


y - time max AGR, x- max pigments time
```{r fig.height = 6, fig.width = 8, warning = FALSE}


PigmentMaxGrowth2 <- PigmentMaxGrowth %>% 
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 


lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))

Strain.labs <- c("PE-rich_127", "PE-rich_048", "PC-rich_056", "PC-rich_077")
names(Strain.labs) <- c("BA127R", "BA48R", "BA56G", "BA77G")

Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
WL.labs <- c("Strain")
names(WL.labs) <- c("WW")
O2.labs <- c("Light level")
names(O2.labs) <- c(21)

#scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
PigmentMaxGrowthPlot <- PigmentMaxGrowth2 %>%
  ggplot() +
  geom_point(aes(x = TimeMaxPhyco, y = MaxGrowthH, colour = as.factor(Strain), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = T) +
labs(y = "Maximum absolute growth rate (h)", x = "Maximum absolute Phyco content (h)") +
  # scale_x_continuous(breaks=seq(0, 4000000, by = 1000000)) +
  # coord_cartesian(xlim = c(-100, 3300000)) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
    scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  # ggh4x::facet_nested(rows = vars(WL, Strain), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs, Strain = Strain.labs)) +
  
  scale_y_continuous(trans = log10_trans(),
                     breaks = trans_breaks("log10", function(x) 10^x),
                     labels = trans_format("log10", math_format(10^.x))) +
  annotation_logticks(sides = "l", colour = "gray60") +
  
  scale_x_continuous(trans = log10_trans(),
                     breaks = trans_breaks("log10", function(x) 10^x),
                     labels = trans_format("log10", math_format(10^.x))) +
  #scale_x_continuous(labels = comma) + 
  #scale_x_continuous(label=scientific_10) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.08,0.85),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PigmentMaxGrowthPlot




lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))

Strain.labs <- c("PE-rich_127", "PE-rich_048", "PC-rich_056", "PC-rich_077")
names(Strain.labs) <- c("BA127R", "BA48R", "BA56G", "BA77G")

Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
WL.labs <- c("Strain")
names(WL.labs) <- c("WW")
O2.labs <- c("Light level")
names(O2.labs) <- c(21)

#scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
PigmentMaxGrowthPlot <- PigmentMaxGrowth2 %>%
  ggplot() +

  geom_point(aes(x = TimeMaxChla, y = MaxGrowthH, colour = as.factor(Strain), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = T) +
  # geom_point(aes(x = TimeMaxPhycoChlaRatio, y = MaxGrowthH, colour = as.factor(Strain)), size = 3.5, alpha = 0.8, show.legend = F) +
labs(y = "Maximum absolute growth rate (h)", x = "Maximum absolute Chl" ~italic(a)~ "content (h)") +
  
  # scale_x_continuous(breaks=seq(0, 4000000, by = 1000000)) +
  # coord_cartesian(xlim = c(-100, 3300000)) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
    scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  # ggh4x::facet_nested(rows = vars(WL, Strain), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs, Strain = Strain.labs)) +
  
  scale_y_continuous(trans = log10_trans(),
                     breaks = trans_breaks("log10", function(x) 10^x),
                     labels = trans_format("log10", math_format(10^.x))) +
  annotation_logticks(sides = "l", colour = "gray60") +
  
  scale_x_continuous(trans = log10_trans(),
                     breaks = trans_breaks("log10", function(x) 10^x),
                     labels = trans_format("log10", math_format(10^.x))) +
  #scale_x_continuous(labels = comma) + 
  #scale_x_continuous(label=scientific_10) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.08,0.85),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PigmentMaxGrowthPlot



lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))

Strain.labs <- c("PE-rich_127", "PE-rich_048", "PC-rich_056", "PC-rich_077")
names(Strain.labs) <- c("BA127R", "BA48R", "BA56G", "BA77G")

Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
WL.labs <- c("Strain")
names(WL.labs) <- c("WW")
O2.labs <- c("Light level")
names(O2.labs) <- c(21)

#scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
PigmentMaxGrowthPlot <- PigmentMaxGrowth2 %>%
  ggplot() +

  geom_point(aes(x = TimeMaxCar, y = MaxGrowthH, colour = as.factor(Strain), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = T) +
  # geom_point(aes(x = TimeMaxPhycoChlaRatio, y = MaxGrowthH, colour = as.factor(Strain)), size = 3.5, alpha = 0.8, show.legend = F) +
labs(y = "Maximum absolute growth rate (h)", x = "Maximum absolute Car content (h)") +
  
  # scale_x_continuous(breaks=seq(0, 4000000, by = 1000000)) +
  # coord_cartesian(xlim = c(-100, 3300000)) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
    scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  # ggh4x::facet_nested(rows = vars(WL, Strain), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs, Strain = Strain.labs)) +
  
  scale_y_continuous(trans = log10_trans(),
                     breaks = trans_breaks("log10", function(x) 10^x),
                     labels = trans_format("log10", math_format(10^.x))) +
  annotation_logticks(sides = "l", colour = "gray60") +
  
  scale_x_continuous(trans = log10_trans(),
                     breaks = trans_breaks("log10", function(x) 10^x),
                     labels = trans_format("log10", math_format(10^.x))) +
  #scale_x_continuous(labels = comma) + 
  #scale_x_continuous(label=scientific_10) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.08,0.85),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PigmentMaxGrowthPlot



lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))

Strain.labs <- c("PE-rich_127", "PE-rich_048", "PC-rich_056", "PC-rich_077")
names(Strain.labs) <- c("BA127R", "BA48R", "BA56G", "BA77G")

Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
WL.labs <- c("Strain")
names(WL.labs) <- c("WW")
O2.labs <- c("Light level")
names(O2.labs) <- c(21)

#scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
PigmentMaxGrowthPlot <- PigmentMaxGrowth2 %>%
  ggplot() +

  geom_point(aes(x = TimeMaxPhycoChlaRatio, y = MaxGrowthH, colour = as.factor(Strain), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = T) +
labs(y = "Maximum absolute growth rate (h)", x = "Maximum absolute Phyco/Chl" ~italic(a)~ "ratio (h)") +
  
  # scale_x_continuous(breaks=seq(0, 4000000, by = 1000000)) +
  # coord_cartesian(xlim = c(-100, 3300000)) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
    scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  # ggh4x::facet_nested(rows = vars(WL, Strain), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs, Strain = Strain.labs)) +
  
  scale_y_continuous(trans = log10_trans(),
                     breaks = trans_breaks("log10", function(x) 10^x),
                     labels = trans_format("log10", math_format(10^.x))) +
  annotation_logticks(sides = "l", colour = "gray60") +
  
  scale_x_continuous(trans = log10_trans(),
                     breaks = trans_breaks("log10", function(x) 10^x),
                     labels = trans_format("log10", math_format(10^.x))) +
  #scale_x_continuous(labels = comma) + 
  #scale_x_continuous(label=scientific_10) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.08,0.85),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PigmentMaxGrowthPlot


lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))

Strain.labs <- c("PE-rich_127", "PE-rich_048", "PC-rich_056", "PC-rich_077")
names(Strain.labs) <- c("BA127R", "BA48R", "BA56G", "BA77G")

Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
WL.labs <- c("Strain")
names(WL.labs) <- c("WW")
O2.labs <- c("Light level")
names(O2.labs) <- c(21)

#scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
PigmentMaxGrowthPlot <- PigmentMaxGrowth2 %>%
  ggplot() +

  geom_point(aes(x = TimeMinCarChlaRatio, y = MaxGrowthH, colour = as.factor(Strain), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.8, show.legend = T) +
labs(y = "Maximum absolute growth rate (h)", x = "Minimum absolute Car/Chl" ~italic(a)~ "ratio (h)") +
  
  # scale_x_continuous(breaks=seq(0, 4000000, by = 1000000)) +
  # coord_cartesian(xlim = c(-100, 3300000)) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
    scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  # ggh4x::facet_nested(rows = vars(WL, Strain), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs, Strain = Strain.labs)) +
  
  scale_y_continuous(trans = log10_trans(),
                     breaks = trans_breaks("log10", function(x) 10^x),
                     labels = trans_format("log10", math_format(10^.x))) +
  annotation_logticks(sides = "l", colour = "gray60") +
  
  scale_x_continuous(trans = log10_trans(),
                     breaks = trans_breaks("log10", function(x) 10^x),
                     labels = trans_format("log10", math_format(10^.x))) +
  #scale_x_continuous(labels = comma) + 
  #scale_x_continuous(label=scientific_10) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.08,0.85),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))
PigmentMaxGrowthPlot



```



```{r}
# 
# data_omit <- na.omit(MultiCultiPigmentMax) 
# 
# MultiCultiPigmentMaxGrowth<- data_omit %>%
#   group_by(Strain, Par_ue, Photoperiod) %>%
#   summarise(ID, Day, ExpDate, Run, Strain, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_parDay, meanOD680Day, meanOD720Day, cellml, ChlaugmL, CarugmL, PEugmL, PCugmL, APCugmL, PhotonDose, Chlapgcell, Carpgcell, PEpgcell, PCpgcell, APCpgcell, Phycopgcell, CarChlaRatio, PhycoChlaRatio, Time_h,  MaxPhycoChlaRatio = max(PhycoChlaRatio, na.rm = TRUE))
# 
# 
# MultiCultiPigmentMaxGrowth2<- MultiCultiPigmentMaxGrowth %>%
# #mutate(Timemax = Time_h(which.max(PhycoChlaRatio)))
# group_by(Strain, Par_ue, Photoperiod) %>%
# mutate(Timemax = Time_h[which.max(PhycoChlaRatio)])


```



# Save assembled spectra data set
```{r save Olis}

#saveRDS(PARvsPUR, file.path(DataOut, paste(Project, "PURSySlRedGreenCCA.Rds", sep = "_"), fsep = .Platform$file.sep))

```


```{r fig.height = 8, fig.width = 8, warning = FALSE}
# 
#   ggarrange(my_dataChla, my_dataCar, my_dataPE, my_dataPC,
#           ncol = 2, nrow = 2)

```

# Save data set
```{r save}

# saveRDS(MultiCultiDataCleanGrowth, file.path(DataOut, paste(Project, "MultiCultiDataCleanGrowth.Rds", sep = "_"), fsep = .Platform$file.sep))

```

Heatmap example
```{r fig.height = 4, fig.width = 8, warning = FALSE}
MultiCultiDataCleanGrowthHeatBA127<- MultiCultiDataCleanGrowth %>%
  #filter(Strain == "BA127R") %>%
  select(c(Strain, Par_ue, Photoperiod, deltaOD_Lmu_corr, WL))

MultiCultiDataCleanGrowthHeatBA127 <- MultiCultiDataCleanGrowthHeatBA127 %>%
  mutate(deltaOD_Lmu_corr = round(deltaOD_Lmu_corr, digits = 2)) %>%
  mutate(Par_ue = as.character(Par_ue)) %>%
  mutate(Photoperiod = as.character(Photoperiod))

```


Growth heatmap per PAR
```{r fig.height = 8, fig.width = 8, warning = FALSE}
# library(gtable)
# library(grid)
# library(gridExtra)
# library(egg)

# layout <- c(
#   area(t = 1, l = 1, b = 1, r = 1),
#   area(t = 1, l = 1, b = 1, r = 1),
#   area(t = 5, l = 1, b = 5, r = 1),
#   area(t = 5, l = 1, b = 5, r = 1)
# )

test <- MultiCultiDataCleanGrowthHeatBA127 %>% 
  mutate(group = Strain) %>% 
  select(-c(Strain)) %>% 
  
  mutate(group=case_when(group=="BA127R"~"PE-rich_127",
         group=="BA48R"~"PE-rich_048",
        group=="BA56G"~"PC-rich_056",
         group=="BA77G"~"PC-rich_077")) 

cols <- setNames(c('seagreen4', 'palegreen3', 'brown1', 'brown4'), c("PE-rich_127", "PE-rich_048", "PC-rich_056", "PC-rich_077"))

# group.labs <- c("PE-rich_127", "PE-rich_048", "PC-rich_056", "PC-rich_077")
# names(group.labs) <- c("BA127R", "BA48R", "BA56G", "BA77G")
test$group <- factor(test$group, levels = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"))

test_split <- test %>%
  mutate(color_high = cols[group]) %>%
  group_split(group)

purrr::map(test_split, ~{
  ggplot(.x, aes(Photoperiod, Par_ue)) +
  geom_tile(aes(x = Photoperiod, y = Par_ue, fill = deltaOD_Lmu_corr), color = "black", show.legend = F) +
  geom_text(aes(x = Photoperiod, y = Par_ue, fill = deltaOD_Lmu_corr, label = deltaOD_Lmu_corr), color = "black", size = 3) + 
    
  # geom_rect(aes(xmin=1, xmax=2, ymin=Inf, ymax=3),
  #              size=1.4, colour="grey30", fill=NA) +
    
    
  geom_curve(aes(x = 4, y = 4.1, xend = 3.2, yend = 5), arrow = arrow(length = unit(0.03, "npc"), ends = "both", type="closed"), curvature = 0.2, size = 0.7, colour = "gray20") +
  geom_curve(aes(x = 4, y = 1.1, xend = 3.2, yend = 2), arrow = arrow(length = unit(0.03, "npc"), ends = "both", type="closed"), curvature = 0.2, size = 0.7, colour = "gray20") +
  geom_curve(aes(x = 3, y = 2.1, xend = 1.2, yend = 3), arrow = arrow(length = unit(0.03, "npc"), ends = "both", type="closed"), curvature = 0.2, size = 0.7, colour = "gray20") +
    
  geom_curve(aes(x = 4, y = 2.1, xend = 3.2, yend = 4), arrow = arrow(length = unit(0.03, "npc"), ends = "both", type="closed"), curvature = 0.2, size = 0.7, colour = "gray20") +
  geom_curve(aes(x = 2, y = 3.1, xend = 1.2, yend = 4), arrow = arrow(length = unit(0.03, "npc"), ends = "both", type="closed"), curvature = 0.2, size = 0.7, colour = "gray20") +
  xlim("8","12", "16", "24") +
  ylim("30","90", "180", "300", "900") +
  scale_fill_gradient2(unique(.x$group), 
                       low = "white",
                       #mid = "gray",
                       high = unique(.x$color_high), 
                       #midpoint=0.1,
                       #guide = "colourbar",
                       aesthetics = "fill") +
    labs(y = "PAR ( µmol photons  "~m^-2~""~s^-1~")", x = "Photoperiod (h)") +
    ggh4x::facet_nested(cols = vars(group)) +
    #ggh4x::facet_nested(cols = vars(group), labeller = labeller(group = group.labs)) 
    #facet_grid(~group)
  #     annotation_custom(
  #   grob = rectGrob(gp = gpar(fill = "white")),
  #   xmin = -Inf,
  #   xmax = Inf,
  #   ymin = 5,
  #   ymax = 6
  # ) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        # legend.position = c(0.08,0.91),
        # legend.key.height= unit(0.005, 'cm'),
        # legend.spacing.x = unit(0.01, 'cm'),
        legend.text = element_blank())
}) %>%
  wrap_plots() +
  plot_layout(guides = "collect", ncol = 2) 
  
      
  # annotate("rect", xmin=-Inf, xmax=Inf, ymin=5, ymax=Inf, alpha=0.4)
  #plot_layout(design = layout, ncol = 4, widths = c(0.5, 0.5)) 
  # save(S, file = "test.png")
```

Growth heatmap per PUR
```{r}
# MultiCultiDataCleanGrowthHeatPUR <- MultiCultiDataCleanGrowthHeatBA127 %>% 
#   
#   left_join(., TargetSpectraLong, by = c("ID" = "CultureID"))
  

# MaxGrowthNew <- MaxGrowth2 %>%
#     mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
#          Strain=="BA48R"~"PE-rich_048",
#         Strain=="BA56G"~"PC-rich_056",
#          Strain=="BA77G"~"PC-rich_077")) 
```



Growth heatmap per PUR
```{r fig.height = 8, fig.width = 8, warning = FALSE}
# library(gtable)
# library(grid)
# library(gridExtra)
# library(egg)
MaxGrowthNew2 <- MaxGrowth2 %>%
  mutate(Par_ue = as.character(Par_ue)) %>%
  #mutate(PUR = as.character(PUR)) %>%
  mutate(Photoperiod = as.character(Photoperiod))



MaxGrowthNew2 <- MaxGrowthNew2 %>%

  mutate(group = Strain) %>%
  select(-c(Strain)) %>%
  mutate(PUR = round(PUR, digits = 0)) %>%
  mutate(deltaOD_Lmu_corr = round(deltaOD_Lmu_corr, digits = 2)) %>%
  mutate(group=case_when(group=="BA127R"~"PE-rich_127",
         group=="BA48R"~"PE-rich_048",
        group=="BA56G"~"PC-rich_056",
         group=="BA77G"~"PC-rich_077")) 


cols <- setNames(c('seagreen4', 'palegreen3', 'brown1', 'brown4'), c("PE-rich_127", "PE-rich_048", "PC-rich_056", "PC-rich_077"))

# group.labs <- c("PE-rich_127", "PE-rich_048", "PC-rich_056", "PC-rich_077")
# names(group.labs) <- c("BA127R", "BA48R", "BA56G", "BA77G")
MaxGrowthNew2$group <- factor(MaxGrowthNew2$group, levels = c("PC-rich_056", "PC-rich_077", "PE-rich_048", "PE-rich_127"))

test_split <- MaxGrowthNew2 %>%
  mutate(color_high = cols[group]) %>%
  group_split(group)

purrr::map(test_split, ~{
  ggplot(.x, aes(Photoperiod, Par_ue)) +
  geom_tile(aes(x = Photoperiod, y = Par_ue, fill = deltaOD_Lmu_corr), color = "black", show.legend = F) +
  geom_text(aes(x = Photoperiod, y = Par_ue, fill = deltaOD_Lmu_corr, label = PUR), color = "black", size = 3) + 
    
  # geom_curve(aes(x = 4, y = 4.1, xend = 3.2, yend = 5), arrow = arrow(length = unit(0.03, "npc"), ends = "both", type="closed"), curvature = 0.2, size = 0.7, colour = "gray20") +
  # geom_curve(aes(x = 4, y = 1.1, xend = 3.2, yend = 2), arrow = arrow(length = unit(0.03, "npc"), ends = "both", type="closed"), curvature = 0.2, size = 0.7, colour = "gray20") +
  # geom_curve(aes(x = 3, y = 2.1, xend = 1.2, yend = 3), arrow = arrow(length = unit(0.03, "npc"), ends = "both", type="closed"), curvature = 0.2, size = 0.7, colour = "gray20") +
  #   
  # geom_curve(aes(x = 4, y = 2.1, xend = 3.2, yend = 4), arrow = arrow(length = unit(0.03, "npc"), ends = "both", type="closed"), curvature = 0.2, size = 0.7, colour = "gray20") +
  # geom_curve(aes(x = 2, y = 3.1, xend = 1.2, yend = 4), arrow = arrow(length = unit(0.03, "npc"), ends = "both", type="closed"), curvature = 0.2, size = 0.7, colour = "gray20") +
  xlim("8","12", "16", "24") +
  ylim("30","90", "180", "300", "900") +
  scale_fill_gradient2(unique(.x$group), 
                       low = "white",
                       #mid = "gray",
                       high = unique(.x$color_high), 
                       #midpoint=0.1,
                       #guide = "colourbar",
                       aesthetics = "fill") +
    labs(y = "PUR ( µmol photons  "~m^-2~""~s^-1~")", x = "Photoperiod (h)") +
    ggh4x::facet_nested(cols = vars(group)) +
    #ggh4x::facet_nested(cols = vars(group), labeller = labeller(group = group.labs)) 
    #facet_grid(~group)
  #     annotation_custom(
  #   grob = rectGrob(gp = gpar(fill = "white")),
  #   xmin = -Inf,
  #   xmax = Inf,
  #   ymin = 5,
  #   ymax = 6
  # ) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        axis.text.y = element_blank(),
        legend.background = element_rect(fill="transparent"),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        # legend.position = c(0.08,0.91),
        # legend.key.height= unit(0.005, 'cm'),
        # legend.spacing.x = unit(0.01, 'cm'),
        legend.text = element_blank())
}) %>%
  wrap_plots() +
  plot_layout(guides = "collect", ncol = 2) 
  
      
  # annotate("rect", xmin=-Inf, xmax=Inf, ymin=5, ymax=Inf, alpha=0.4)
  #plot_layout(design = layout, ncol = 4, widths = c(0.5, 0.5)) 
  # save(S, file = "test.png")
```

TDG

Load TDG catalog
```{r load local multiculticatalog, message = FALSE, warning = FALSE, echo=FALSE}
gs4_deauth()

TDGcatalog<- read_sheet("https://docs.google.com/spreadsheets/d/1dig2XH03aMK2uhD62yGA7xLJm49CL8I0d5jMSJYO-tU/edit#gid=0") 

as.data.frame(TDGcatalog)
TDGcatalog <- TDGcatalog 

```


TDG plot
```{r fig.height = 6, fig.width = 8, warning = FALSE}

# str(TDG2)
TDGcatalog2 <- TDGcatalog %>% 
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) %>% 
  mutate(TDG = as.numeric(TDG)) %>% 
  mutate(DayEnd = as.numeric(DayEnd)) %>% 
  mutate(Par_ue = as.numeric(Par_ue)) %>% 
  mutate(Photoperiod = as.numeric(Photoperiod)) %>%
  mutate(Tend = as.numeric(Tend)) %>%
  mutate(TDG = round(TDG, digits = 3)) %>%  
  mutate(Tend = round(Tend, digits = 0)) 




TDGcatalog2$facets = factor(TDGcatalog2$O2, labels = c("PAR~(µmol~photons~m^{-2}~s^{-1})"))

TDGcatalog2$facets2 = factor(TDGcatalog2$WL, labels = c("Photoperiod~(h)"))

data_vline1 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline2 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(346))
data_vline3 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))
data_vline4 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(344))

data_vline5 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(321.02))
data_vline6 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(319.92))
data_vline7 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline8 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))

data_vline9 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(240.90))
data_vline10 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(240.81))
data_vline11 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(266.84))
data_vline12 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(266.93))

data_vline13 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(187.92))
data_vline14 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(214.41))
data_vline15 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(240.72))
data_vline16 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(215.42))

data_vline17 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110))
data_vline18 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109.5))
data_vline19 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109))
data_vline20 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(108.5))

data_vline21 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline22 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(346))
data_vline23 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))
data_vline24 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(344))

data_vline25 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(245.39))
data_vline26 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(216.33))
data_vline27 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(296.45))
data_vline28 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(244.38))

data_vline29 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(189.48))
data_vline30 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(163.44))
data_vline31 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(217.80))
data_vline32 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(190.39))

data_vline33 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(162.62))
data_vline34 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(136.03))
data_vline35 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(191.03))
data_vline36 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(163.62))

data_vline37 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110))
data_vline38 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109.5))
data_vline39 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109))
data_vline40 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(108.5))

data_vline41 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline42 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(299.38))
data_vline43 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))
data_vline44 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(299.57))

data_vline45 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(168.39))
data_vline46 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(166.28))
data_vline47 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(191.49))
data_vline48 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(168.85))

data_vline49 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(113.76))
data_vline50 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(137.32))
data_vline51 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(114.95))
data_vline52 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(137.50))

data_vline53 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(111.56))
data_vline54 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(111.28))
data_vline55 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(112.75))
data_vline56 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(112.29))

data_vline57 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110))
data_vline58 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109.45))
data_vline59 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(108))
data_vline60 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(107))

data_vline61 <- data.frame(Par_ue= c(30),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(154.64))
data_vline62 <- data.frame(Par_ue= c(30),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(119.35))
data_vline63 <- data.frame(Par_ue= c(30),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(157.85))
data_vline64 <- data.frame(Par_ue= c(30),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(138.78))

data_vline65 <- data.frame(Par_ue= c(90),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(114.68))
data_vline66 <- data.frame(Par_ue= c(90),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(103.77))
data_vline67 <- data.frame(Par_ue= c(90),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(120.27))
data_vline68 <- data.frame(Par_ue= c(90),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(120.18))

data_vline69 <- data.frame(Par_ue= c(180),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(93.32))
data_vline70 <- data.frame(Par_ue= c(180),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(100.38))
data_vline71 <- data.frame(Par_ue= c(180),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110.28))
data_vline72 <- data.frame(Par_ue= c(180),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(108.08))

data_vline73 <- data.frame(Par_ue= c(300),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(93.78))
data_vline74 <- data.frame(Par_ue= c(300),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(79.20))
data_vline75 <- data.frame(Par_ue= c(300),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(95.79))
data_vline76 <- data.frame(Par_ue= c(300),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(98.36))

data_vline77 <- data.frame(Par_ue= c(900),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110))
data_vline78 <- data.frame(Par_ue= c(900),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(94.23))
data_vline79 <- data.frame(Par_ue= c(900),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(79.66))
data_vline80 <- data.frame(Par_ue= c(900),Photoperiod= c(24),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(107))

# lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
# 
# Strain.labs <- c("PE-rich_127", "PE-rich_048", "PC-rich_056", "PC-rich_077")
# names(Strain.labs) <- c("BA127R", "BA48R", "BA56G", "BA77G")
# 
# Par_ue.labs <- c("30 µE", "90 µE", "180 µE", "300 µE", "900 µE")
# names(Par_ue.labs) <- c("30", "90", "180", "300", "900")
# WL.labs <- c("Strain")
# names(WL.labs) <- c("WW")
# O2.labs <- c("Light level")
# names(O2.labs) <- c(21)

#scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
TDGPlot <- TDGcatalog2 %>%
  filter(Photoperiod != 24) %>% 
  ggplot() +
  geom_point(aes(x = Tend, y = TDG, colour = as.factor(Strain)), size = 3.5, alpha = 0.8, show.legend = T) +
  
  
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline17, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline18, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline19, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline20, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline37, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline38, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline39, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline40, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +


  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline57, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline58, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline59, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline60, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  # geom_vline(data = data_vline61, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  # geom_vline(data = data_vline62, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  # geom_vline(data = data_vline63, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  # geom_vline(data = data_vline64, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  # 
  # geom_vline(data = data_vline65, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  # geom_vline(data = data_vline66, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  # geom_vline(data = data_vline67, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  # geom_vline(data = data_vline68, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  # 
  # geom_vline(data = data_vline69, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  # geom_vline(data = data_vline70, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  # geom_vline(data = data_vline71, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  # geom_vline(data = data_vline72, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  # 
  # geom_vline(data = data_vline73, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  # geom_vline(data = data_vline74, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  # geom_vline(data = data_vline75, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  # geom_vline(data = data_vline76, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  # 
  # geom_vline(data = data_vline77, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  # geom_vline(data = data_vline78, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  # geom_vline(data = data_vline79, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  # geom_vline(data = data_vline80, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  # 
  # 
  
  
labs(y = "TDG", x = "Elapsed time (h)") +
  # scale_x_continuous(breaks=seq(0, 4000000, by = 1000000)) +
  # coord_cartesian(xlim = c(-100, 3300000)) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  #   scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  
  ggh4x::facet_nested(cols = vars(facets2, Photoperiod), rows = vars(facets, Par_ue), labeller = label_parsed) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.085,0.92),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))
TDGPlot
```


GrowthSymmetry

Load GS catalog
```{r load local multiculticatalog, message = FALSE, warning = FALSE, echo=FALSE}
gs4_deauth()

# GScatalog<- read_sheet("https://docs.google.com/spreadsheets/d/1ggM66cScp1w4-hEfCVA7GSbgmpYz-pfJRkBZkMwzWlI/edit#gid=0") 


GScatalog<- read_sheet("https://docs.google.com/spreadsheets/d/1JG_GvHuJBtGf4NfWBSrgm0GxM7EpFVLQG-BARl8Lw8A/edit#gid=0")

as.data.frame(GScatalog)
GScatalog <- GScatalog 

```
```{r}
GScatalog2 <- GScatalog %>% 
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) %>% 
  mutate(Acc = as.numeric(Acc)) %>% 
  mutate(Dec = as.numeric(Dec)) %>% 
  #mutate(GS = as.numeric(GS)) %>% 
  mutate(Par_ue = as.numeric(Par_ue)) %>% 
  mutate(Photoperiod = as.numeric(Photoperiod)) %>%
  mutate(tMaxAGI = as.numeric(tMaxAGI)) %>%
  mutate(tMaxDGI = as.numeric(tMaxDGI)) %>%
  mutate(tMaxAGI = round(tMaxAGI, digits = 0)) %>% 
  mutate(tMaxDGI = round(tMaxDGI, digits = 0))

```


```{r fig.height = 6, fig.width = 8, warning = FALSE}

GScatalog2$facets = factor(GScatalog2$O2, labels = c("PAR~(µmol~photons~m^{-2}~s^{-1})"))

GScatalog2$facets2 = factor(GScatalog2$WL, labels = c("Photoperiod~(h)"))

data_vline1 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline2 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(346))
data_vline3 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))
data_vline4 <- data.frame(Par_ue= c(30),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(344))

data_vline5 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(321.02))
data_vline6 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(319.92))
data_vline7 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline8 <- data.frame(Par_ue= c(90),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))

data_vline9 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(240.90))
data_vline10 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(240.81))
data_vline11 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(266.84))
data_vline12 <- data.frame(Par_ue= c(180),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(266.93))

data_vline13 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(187.92))
data_vline14 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(214.41))
data_vline15 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(240.72))
data_vline16 <- data.frame(Par_ue= c(300),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(215.42))

data_vline17 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110))
data_vline18 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109.5))
data_vline19 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109))
data_vline20 <- data.frame(Par_ue= c(900),Photoperiod= c(8),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(108.5))

data_vline21 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline22 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(346))
data_vline23 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))
data_vline24 <- data.frame(Par_ue= c(30),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(344))

data_vline25 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(245.39))
data_vline26 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(216.33))
data_vline27 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(296.45))
data_vline28 <- data.frame(Par_ue= c(90),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(244.38))

data_vline29 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(189.48))
data_vline30 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(163.44))
data_vline31 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(217.80))
data_vline32 <- data.frame(Par_ue= c(180),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(190.39))

data_vline33 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(162.62))
data_vline34 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(136.03))
data_vline35 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(191.03))
data_vline36 <- data.frame(Par_ue= c(300),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(163.62))

data_vline37 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110))
data_vline38 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109.5))
data_vline39 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109))
data_vline40 <- data.frame(Par_ue= c(900),Photoperiod= c(12),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(108.5))

data_vline41 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(347))
data_vline42 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(299.38))
data_vline43 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(345))
data_vline44 <- data.frame(Par_ue= c(30),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(299.57))

data_vline45 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(168.39))
data_vline46 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(166.28))
data_vline47 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(191.49))
data_vline48 <- data.frame(Par_ue= c(90),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(168.85))

data_vline49 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(113.76))
data_vline50 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(137.32))
data_vline51 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(114.95))
data_vline52 <- data.frame(Par_ue= c(180),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(137.50))

data_vline53 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(111.56))
data_vline54 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(111.28))
data_vline55 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(112.75))
data_vline56 <- data.frame(Par_ue= c(300),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(112.29))

data_vline57 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(110))
data_vline58 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(109.45))
data_vline59 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(108))
data_vline60 <- data.frame(Par_ue= c(900),Photoperiod= c(16),facets= c("PAR~(µmol~photons~m^{-2}~s^{-1})"),facets2= c("Photoperiod~(h)"),value = c(107))


GSPlot<-GScatalog2 %>%
  ggplot() +
  geom_point(aes(x = tMaxDGI, y = Acc, colour = as.factor(Strain)), size = 3.5, alpha = 0.8, show.legend = T) +
  
  
    geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline5, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline6, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline7, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline8, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline9, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline10, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline11, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline12, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline13, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline14, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline15, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline16, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline17, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline18, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline19, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline20, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline21, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline22, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline23, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline24, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline25, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline26, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline27, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline28, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline29, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline30, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline31, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline32, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline33, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline34, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline35, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline36, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline37, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline38, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline39, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline40, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +


  geom_vline(data = data_vline41, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline42, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline43, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline44, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline45, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline46, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline47, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline48, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline49, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline50, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline51, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline52, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline53, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline54, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline55, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline56, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  geom_vline(data = data_vline57, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline58, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline59, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline60, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  
  
labs(y = "Growth symmetry", x = "Elapsed time (h)") +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  geom_hline(aes(yintercept = 50), linetype="dotted") +
  ggh4x::facet_nested(cols = vars(facets2, Photoperiod), rows = vars(facets, Par_ue), labeller = label_parsed) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.085,0.92),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))
GSPlot

```

```{r fig.height = 8, fig.width = 8, warning = FALSE}

# p1=mtcars %>% 
#   ggplot(aes(x=cyl, y=mpg))+  
#   geom_boxplot(show.legend = F, aes(fill=cyl))+
#   geom_point(position=position_jitterdodge(jitter.width=2, dodge.width = 0), 
#              pch=21, aes(fill=factor(vs)), show.legend = F) 

GScatalog2$facets = factor(GScatalog2$O2, labels = c("PAR~(µmol~photons~m^{-2}~s^{-1})"))

GScatalog2$facets2 = factor(GScatalog2$WL, labels = c("Photoperiod~(h)"))

GSPlot<-GScatalog2 %>%
  filter(Phase != "TP") %>% 
  #filter(Peak == "ACC") %>% 
  #filter(Strain == "PE-rich_048") %>% 
  ggplot(x = Phase, y = Acc) +
  #geom_boxplot(aes(x = Phase, y = Acc, fill=as.factor(Strain)), show.legend = F)+
  
  geom_boxplot(aes(x = Phase, y = Acc, fill=as.factor(Strain)), show.legend = T, position = position_dodge(preserve = "single"), outlier.size=0.9) +
  
  #geom_point(aes(x = Phase, y = GS, colour = as.factor(Strain)), size = 3.5, alpha = 0.8, show.legend = T) +
  
labs(y = "Growth symmetry (%)", x = "Phase of growth") +
  scale_fill_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  geom_hline(aes(yintercept = 50), linetype="dotted") +
  ggh4x::facet_nested(cols = vars(facets2, Photoperiod), rows = vars(facets, Par_ue), labeller = label_parsed) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=11),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.24,0.95),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=9))
GSPlot

```

```{r}
GScatalog2<-GScatalog2 %>% 
  mutate(Acceleration_len=as.numeric(Acceleration_len)) %>% 
  mutate(Tstart_h=as.numeric(Tstart_h)) %>% 
  mutate(tMaxDGI=as.numeric(tMaxDGI))

# GScatalog22<-GScatalog2 %>% 
#   mutate(GS_h = Acc*100/Photoperiod)
# 
# GScatalog23<-GScatalog2 %>% 
#   mutate(GS_h = Acc*100/Acceleration_len)

GScatalog24<-GScatalog2 %>% 
  mutate(GS_h = tMaxDGI-Tstart_h)


```


```{r fig.height = 8, fig.width = 8, warning = FALSE}

# p1=mtcars %>% 
#   ggplot(aes(x=cyl, y=mpg))+  
#   geom_boxplot(show.legend = F, aes(fill=cyl))+
#   geom_point(position=position_jitterdodge(jitter.width=2, dodge.width = 0), 
#              pch=21, aes(fill=factor(vs)), show.legend = F) 

GScatalog24$facets = factor(GScatalog24$O2, labels = c("PAR~(µmol~photons~m^{-2}~s^{-1})"))

GScatalog24$facets2 = factor(GScatalog24$WL, labels = c("Photoperiod~(h)"))

GSPlot<-GScatalog24 %>%
  filter(GS_h>=0) %>% 
  filter(Phase != "TP") %>% 
  #filter(Peak == "ACC") %>% 
  #filter(Strain == "PE-rich_048") %>% 
  ggplot(x = Phase, y = GS_h) +
  #geom_boxplot(aes(x = Phase, y = Acc, fill=as.factor(Strain)), show.legend = F)+
  
  geom_boxplot(aes(x = Phase, y = GS_h, fill=as.factor(Strain)), show.legend = T, position = position_dodge(preserve = "single"), outlier.size=0.9) +
  
  #geom_point(aes(x = Phase, y = GS, colour = as.factor(Strain)), size = 3.5, alpha = 0.8, show.legend = T) +
  
labs(y = "Growth symmetry (h)", x = "Phase of growth") +
  scale_fill_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  #geom_hline(aes(yintercept = 50), linetype="dotted") +
  ggh4x::facet_nested(cols = vars(facets2, Photoperiod), rows = vars(facets, Par_ue), labeller = label_parsed) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=11),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.24,0.95),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=9))
GSPlot

```


```{r fig.height = 8, fig.width = 8, warning = FALSE}

# p1=mtcars %>% 
#   ggplot(aes(x=cyl, y=mpg))+  
#   geom_boxplot(show.legend = F, aes(fill=cyl))+
#   geom_point(position=position_jitterdodge(jitter.width=2, dodge.width = 0), 
#              pch=21, aes(fill=factor(vs)), show.legend = F) 
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))
GScatalog2$facets = factor(GScatalog2$O2, labels = c("Strain"))

GScatalog2$facets2 = factor(GScatalog2$WL, labels = c("Photoperiod~(h)"))

GSPlot<-GScatalog2 %>%
  filter(Phase != "TP") %>% 
  #filter(Peak == "ACC") %>% 
  #filter(Strain == "PE-rich_048") %>% 
  ggplot(x = Phase, y = Acc) +
  #geom_boxplot(aes(x = Phase, y = Acc, fill=as.factor(Strain)), show.legend = F)+
  
  geom_boxplot(aes(x = Phase, y = Acc, fill=as.factor(Par_ue)), show.legend = T, position = position_dodge(preserve = "single"), outlier.size=0.9) +
  
  #geom_point(aes(x = Phase, y = GS, colour = as.factor(Strain)), size = 3.5, alpha = 0.8, show.legend = T) +
  
  labs(y = "Growth symmetry (%)", x = "Phase of growth") +
    scale_fill_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2) +
  #scale_fill_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  geom_hline(aes(yintercept = 50), linetype="dotted") +
  ggh4x::facet_nested(cols = vars(facets2, Photoperiod), rows = vars(facets, Strain), labeller = label_parsed) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=11),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.25,0.93),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=9))
GSPlot



```

```{r fig.height = 8, fig.width = 8, warning = FALSE}

data_hlineGS8 <- data.frame(Photoperiod= c(8),facets2= c("Photoperiod~(h)"),value = c(4))
data_hlineGS12 <- data.frame(Photoperiod= c(12),facets2= c("Photoperiod~(h)"),value = c(6))
data_hlineGS16 <- data.frame(Photoperiod= c(16),facets2= c("Photoperiod~(h)"),value = c(8))

lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))
GScatalog24$facets = factor(GScatalog24$O2, labels = c("Strain"))

GScatalog24$facets2 = factor(GScatalog24$WL, labels = c("Photoperiod~(h)"))

GSPlot<-GScatalog24 %>%
  filter(Phase != "TP") %>% 
  filter(GS_h>=0) %>% 
  #filter(Peak == "ACC") %>% 
  #filter(Strain == "PE-rich_048") %>% 
  ggplot(x = Par_ue, y = GS_h) +
  #geom_boxplot(aes(x = Phase, y = Acc, fill=as.factor(Strain)), show.legend = F)+
  # 
  # geom_boxplot(aes(x = Phase, y = GS_h, fill=as.factor(Par_ue)), show.legend = T, position = position_dodge(preserve = "single"), outlier.size=0.9) +
  
  geom_point(aes(x = Par_ue, y = GS_h, colour = as.factor(Strain)), size = 3.5, alpha = 0.8, show.legend = T) +
  geom_line(aes(x = Par_ue, y = GS_h, colour = as.factor(Strain)), alpha = 0.8, show.legend = T) +
  geom_hline(data = data_hlineGS8, aes(yintercept = value), linetype="dotted") +
  geom_hline(data = data_hlineGS12, aes(yintercept = value), linetype="dotted") +
  geom_hline(data = data_hlineGS16, aes(yintercept = value), linetype="dotted") +
  
  labs(y = "Growth symmetry (h)", x = "Phase of growth") +
    scale_fill_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2) +
  #scale_fill_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  #geom_hline(aes(yintercept = 50), linetype="dotted") +
  ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Phase, Strain), labeller = label_parsed) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=11),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.25,0.93),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=9))
GSPlot



```


Par Sine df
```{r}

gs4_deauth()

ParSine<- read_sheet("https://docs.google.com/spreadsheets/d/1SU2PzqK_wIYNlJpYS6nTDFDfHWAGfI_n9-An98d3rDc/edit#gid=0")

as.data.frame(ParSine)
ParSine <- ParSine 

ParSine<-ParSine %>% 
  mutate(PAR_Sine = as.numeric(PAR_Sine)) %>% 
  mutate(PUR_round_Ex = as.numeric(PUR_round_Ex)) %>% 
  
  mutate(PUR_Ex = as.numeric(PUR_Ex)) %>% 
  mutate(PUR_Sine_Ex = as.numeric(PUR_Sine_Ex)) %>% 
  mutate(PUR_St = as.numeric(PUR_St)) %>% 
  mutate(PUR_round_St = as.numeric(PUR_round_St)) %>% 
  mutate(PUR_Sine_St = as.numeric(PUR_Sine_St)) %>% 
  
  mutate(Par_ue = as.numeric(Par_ue)) %>% 
  mutate(Photoperiod = as.numeric(Photoperiod)) %>% 
  mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 



```



```{r}
GScatalogAll <- GScatalog24 %>%
  left_join(., ParSine, by = c("Strain" = "Strain", "Photoperiod" = "Photoperiod", "Par_ue" = "Par_ue")) 

GScatalogAll2 <- GScatalogAll %>%
  mutate(GS_h_round = GS_h) %>% 
  mutate(PAR_Sine_round = PAR_Sine) %>% 
  mutate(GS_h_round = round(GS_h_round, digits = 0)) %>% 
  
  filter(GS_h_round == Photoperiod_h_Sine)
  
```


```{r fig.height = 7, fig.width = 8, warning = FALSE}

data_hlineGS8 <- data.frame(Photoperiod= c(8),facets2= c("Photoperiod~(h)"),value = c(4))
data_hlineGS12 <- data.frame(Photoperiod= c(12),facets2= c("Photoperiod~(h)"),value = c(6))
data_hlineGS16 <- data.frame(Photoperiod= c(16),facets2= c("Photoperiod~(h)"),value = c(8))

lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))
GScatalogAll2$facets = factor(GScatalogAll2$O2, labels = c("Phase~of~growth"))

GScatalogAll2$facets2 = factor(GScatalogAll2$WL, labels = c("Photoperiod~(h)"))

GSPlot<-GScatalogAll2 %>%
  filter(Phase != "TP") %>% 
  filter(GS_h>=0) %>% 
  #filter(Peak == "ACC") %>% 
  #filter(Strain == "PE-rich_048") %>% 
  ggplot(x = PAR_Sine, y = GS_h) +

  # 
  # geom_boxplot(aes(x = Phase, y = GS_h, fill=as.factor(Par_ue)), show.legend = T, position = position_dodge(preserve = "single"), outlier.size=0.9) +
  
  geom_point(aes(x = PAR_Sine, y = GS_h, colour = as.factor(Strain), shape=as.factor(Par_ue)), size = 3.5, alpha = 0.8, show.legend = T) +
  
  geom_hline(data = data_hlineGS8, aes(yintercept = value), linetype="dotted") +
  geom_hline(data = data_hlineGS12, aes(yintercept = value), linetype="dotted") +
  geom_hline(data = data_hlineGS16, aes(yintercept = value), linetype="dotted") +
  
  labs(y = "Growth symmetry (h to reach maxDGI)", x = "Actual PAR they got based on sine shape") +
    # scale_fill_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  #geom_hline(aes(yintercept = 50), linetype="dotted") +
  ggh4x::facet_nested(cols = vars(facets2, Photoperiod), rows = vars(facets, Phase), labeller = label_parsed) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=11),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.08,0.87),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=9))
GSPlot



```


```{r fig.height = 7, fig.width = 8, warning = FALSE}

data_hlineGS8 <- data.frame(Photoperiod= c(8),facets2= c("Photoperiod~(h)"),value = c(4))
data_hlineGS12 <- data.frame(Photoperiod= c(12),facets2= c("Photoperiod~(h)"),value = c(6))
data_hlineGS16 <- data.frame(Photoperiod= c(16),facets2= c("Photoperiod~(h)"),value = c(8))

lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))
GScatalogAll2$facets = factor(GScatalogAll2$O2, labels = c("Phase~of~growth"))

GScatalogAll2$facets2 = factor(GScatalogAll2$WL, labels = c("Photoperiod~(h)"))

GSPlot<-GScatalogAll2 %>%
    filter(AchivePreStationary == "Yes") %>% 
  filter(Phase != "TP") %>% 
  filter(GS_h>=0) %>% 
  ggplot(x = PUR_Sine_Ex, y = GS_h) +

  geom_point(aes(x = PUR_Sine_Ex, y = GS_h, colour = as.factor(Strain), shape=as.factor(Par_ue)), size = 3.5, alpha = 0.8, show.legend = T) +
  
  geom_hline(data = data_hlineGS8, aes(yintercept = value), linetype="dotted") +
  geom_hline(data = data_hlineGS12, aes(yintercept = value), linetype="dotted") +
  geom_hline(data = data_hlineGS16, aes(yintercept = value), linetype="dotted") +
  
  labs(y = "Growth symmetry (h to reach maxDGI)", x = "Actual PUR they got based on sine shape") +
    # scale_fill_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  #geom_hline(aes(yintercept = 50), linetype="dotted") +
  ggh4x::facet_nested(cols = vars(facets2, Photoperiod), rows = vars(facets, Phase), labeller = label_parsed) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=11),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.08,0.87),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=9))
GSPlot



```



```{r}

colnames(GScatalogAll2)

GScatalogAllExp<-GScatalogAll2 %>% 
filter(Phase == "Exponential") %>% 
  select(-c(PUR_St, PUR_round_St, PUR_Sine_St, PAR_Sine_round, PUR_round_Ex)) %>% 
  mutate(PUR=PUR_Ex) %>% 
  mutate(PUR_Sine=PUR_Sine_Ex) %>% 
  select(-c(PUR_Ex, PUR_Sine_Ex))

GScatalogAllSt<-GScatalogAll2 %>% 
filter(Phase == "Pre-stationary") %>% 
  select(-c(PAR_Sine_round, PUR_round_Ex, PUR_Ex, PUR_Sine_Ex, PUR_round_St)) %>% 
  mutate(PUR=PUR_St) %>% 
  mutate(PUR_Sine=PUR_Sine_St) %>% 
  select(-c(PUR_St, PUR_Sine_St))

GScatalogAllAll<-rbind(GScatalogAllExp, GScatalogAllSt)


GScatalogAllAll<-GScatalogAllAll %>% 
  mutate(E_day = Tstart_h/24) %>% 
  mutate(E_day = round(E_day, digits = 0)) 

```


```{r fig.height = 7, fig.width = 8, warning = FALSE}

data_hlineGS8 <- data.frame(Photoperiod= c(8),facets2= c("Photoperiod~(h)"),value = c(4))
data_hlineGS12 <- data.frame(Photoperiod= c(12),facets2= c("Photoperiod~(h)"),value = c(6))
data_hlineGS16 <- data.frame(Photoperiod= c(16),facets2= c("Photoperiod~(h)"),value = c(8))

lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))
GScatalogAllAll$facets = factor(GScatalogAllAll$O2, labels = c("Phase~of~growth"))

GScatalogAllAll$facets2 = factor(GScatalogAllAll$WL, labels = c("Photoperiod~(h)"))

GSPlot<-GScatalogAllAll %>%
  filter(AchivePreStationary == "Yes") %>% 
  #filter(Phase != "Pre-stationary") %>% 
  filter(E_day >= 4) %>% 
  filter(GS_h>=0) %>% 
  ggplot(x = PUR_Sine, y = GS_h) +

  geom_point(aes(x = PUR_Sine, y = GS_h, colour = as.factor(E_day), shape=as.factor(Par_ue)), size = 3.5, alpha = 0.8, show.legend = T) +
  
  geom_hline(data = data_hlineGS8, aes(yintercept = value), linetype="dotted") +
  geom_hline(data = data_hlineGS12, aes(yintercept = value), linetype="dotted") +
  geom_hline(data = data_hlineGS16, aes(yintercept = value), linetype="dotted") +
  
  labs(y = "Growth symmetry (h to reach maxDGI)", x = "Actual PUR they got based on sine shape") +
    # scale_fill_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  #geom_hline(aes(yintercept = 50), linetype="dotted") +
  ggh4x::facet_nested(cols = vars(facets2, Photoperiod), rows = vars(Phase, Strain), labeller = label_parsed) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=11),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.08,0.87),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=9))
GSPlot


```

```{r fig.height = 7, fig.width = 8, warning = FALSE}

data_hlineGS8 <- data.frame(Photoperiod= c(8),facets2= c("Photoperiod~(h)"),value = c(4))
data_hlineGS12 <- data.frame(Photoperiod= c(12),facets2= c("Photoperiod~(h)"),value = c(6))
data_hlineGS16 <- data.frame(Photoperiod= c(16),facets2= c("Photoperiod~(h)"),value = c(8))

lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))
GScatalogAllAll$facets = factor(GScatalogAllAll$O2, labels = c("Phase~of~growth"))

GScatalogAllAll$facets2 = factor(GScatalogAllAll$WL, labels = c("Photoperiod~(h)"))

GSPlot<-GScatalogAllAll %>%
  filter(Phase != "TP") %>% 
  filter(GS_h>=0) %>% 
  ggplot(x = PUR_Sine, y = GS_h) +

  geom_point(aes(x = PUR_Sine, y = GS_h, colour = as.factor(Strain), shape=as.factor(Par_ue)), size = 3.5, alpha = 0.8, show.legend = T) +
  
  geom_hline(data = data_hlineGS8, aes(yintercept = value), linetype="dotted") +
  geom_hline(data = data_hlineGS12, aes(yintercept = value), linetype="dotted") +
  geom_hline(data = data_hlineGS16, aes(yintercept = value), linetype="dotted") +
  
  labs(y = "Growth symmetry (h to reach maxDGI)", x = "Actual PUR they got based on sine shape") +
    # scale_fill_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  #geom_hline(aes(yintercept = 50), linetype="dotted") +
  ggh4x::facet_nested(cols = vars(facets2, Photoperiod), rows = vars(facets, Phase), labeller = label_parsed) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=11),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.08,0.87),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=9))
GSPlot



```



Beta parameter
https://padpadpadpad.github.io/rTPC/articles/fit_many_models.html

citation:
Daniel Padfield, Hannah O’Sullivan, & Samraat Pawar (2021). rTPC and nls.multstart: A new pipeline to fit thermal performance curves in R. Methods in Ecology and Evolution. https://doi.org/10.1111/2041-210X.13585

```{r}

# install package from GitHub
#remotes::install_github("padpadpadpad/rTPC")

# load packages
library(rTPC)
library(nls.multstart)
library(broom)
library(tidyverse)

# write function to label ggplot2 panels
label_facets_num <- function(string){
  len <- length(string)
  string = paste('(', 1:len, ') ', string, sep = '')
  return(string)
}

```


```{r}

# # load in data
# data("chlorella_tpc")
# 
# # keep just a single curve
# d <- filter(chlorella_tpc, curve_id == 1)
# 
# # show the data
# ggplot(d, aes(temp, rate)) +
#   geom_point() +
#   theme_bw(base_size = 12) +
#   labs(x = 'Temperature (ºC)',
#        y = 'Metabolic rate',
#        title = 'Respiration across temperatures')

#works when it is 13 variables, duplicate value
# dS<-d %>% 
#   filter(temp == 16)
# dS2<-rbind(d, dS)

#works when we have 3 columns
# dS<-d %>%
# select(-c(process, flux, growth_temp))

```

```{r}

# # fit every model formulation in rTPC
# d_fits <- nest(d, data = c(temp, rate)) %>%
#   mutate(beta = map(data, ~nls_multstart(rate~beta_2012(temp = temp, a, b, c, d, e),
#                         data = .x,
#                         iter = c(6,6,6,6,6),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'beta_2012') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'beta_2012') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'beta_2012'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'beta_2012'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)))
# 
# #d_fits$beta[[1]]

```

```{r}

# # stack models
# d_stack <- select(d_fits, -data) %>%
#   pivot_longer(., names_to = 'model_name', values_to = 'fit', beta)
# 
# # get parameters using tidy
# params <- d_stack %>%
#   mutate(., est = map(fit, tidy)) %>%
#   select(-fit) %>%
#   unnest(est)
# 
# # get predictions using augment
# newdata <- tibble(temp = seq(min(d$temp), max(d$temp), length.out = 100))
# d_preds <- d_stack %>%
#   mutate(., preds = map(fit, augment, newdata = newdata)) %>%
#   select(-fit) %>%
#   unnest(preds)
# 
# # plot
# ggplot(d_preds, aes(temp, rate)) +
#   geom_point(aes(temp, rate), d) +
#   geom_line(aes(temp, .fitted), col = 'blue') +
#   facet_wrap(~model_name, labeller = labeller(model_name = label_facets_num), scales = 'free', ncol = 5) +
#   theme_bw(base_size = 12) +
#   theme(legend.position = 'none',
#         strip.text = element_text(hjust = 0),
#         strip.background = element_blank()) +
#   labs(x = 'Temperature (ºC)',
#        y = 'Metabolic rate',
#        title = 'Fits of every model available in rTPC') +
#   geom_hline(aes(yintercept = 0), linetype = 2)

```

all 25 fits
```{r}
# fit every model formulation in rTPC
# d_fits <- nest(d, data = c(temp, rate)) %>%
#   mutate(beta = map(data, ~nls_multstart(rate~beta_2012(temp = temp, a, b, c, d, e),
#                         data = .x,
#                         iter = c(6,6,6,6,6),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'beta_2012') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'beta_2012') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'beta_2012'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'beta_2012'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          boatman = map(data, ~nls_multstart(rate~boatman_2017(temp = temp, rmax, tmin, tmax, a,b),
#                         data = .x,
#                         iter = c(4,4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'boatman_2017') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'boatman_2017') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'boatman_2017'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'boatman_2017'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          briere2 = map(data, ~nls_multstart(rate~briere2_1999(temp = temp, tmin, tmax, a,b),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'briere2_1999') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'briere2_1999') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'briere2_1999'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'briere2_1999'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          delong = map(data, ~nls_multstart(rate~delong_2017(temp = temp, c, eb, ef, tm, ehc),
#                         data = .x,
#                         iter = c(4,4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'delong_2017') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'delong_2017') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'delong_2017'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'delong_2017'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          flinn = map(data, ~nls_multstart(rate~flinn_1991(temp = temp, a, b, c),
#                         data = .x,
#                         iter = c(5,5,5),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'flinn_1991') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'flinn_1991') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'flinn_1991'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'flinn_1991'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          gaussian = map(data, ~nls_multstart(rate~gaussian_1987(temp = temp, rmax, topt, a),
#                         data = .x,
#                         iter = c(4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'gaussian_1987') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'gaussian_1987') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'gaussian_1987'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'gaussian_1987'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          hinshelwood = map(data, ~nls_multstart(rate~hinshelwood_1947(temp = temp, a, e, b, eh),
#                         data = .x,
#                         iter = c(5,5,5,5),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'hinshelwood_1947') - 1,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'hinshelwood_1947') + 1,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'hinshelwood_1947'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'hinshelwood_1947'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          joehnk = map(data, ~nls_multstart(rate~joehnk_2008(temp = temp, rmax, topt, a, b, c),
#                         data = .x,
#                         iter = c(4,4,4,4, 4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'joehnk_2008') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'joehnk_2008') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'joehnk_2008'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'joehnk_2008'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          johnson_lewin = map(data, ~suppressWarnings(nls_multstart(rate~ johnsonlewin_1946(temp = temp, r0, e, eh, topt),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'johnsonlewin_1946') - 1,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'johnsonlewin_1946') + 1,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'johnsonlewin_1946'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'johnsonlewin_1946'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE))),
#          kamykowski = map(data, ~nls_multstart(rate~kamykowski_1985(temp = temp, tmin, tmax, a, b, c),
#                         data = .x,
#                         iter = c(4,4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'kamykowski_1985') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'kamykowski_1985') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'kamykowski_1985'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'kamykowski_1985'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          lactin2 = map(data, ~nls_multstart(rate~lactin2_1995(temp = temp, a, b, tmax, delta_t),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'lactin2_1995') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'lactin2_1995') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'lactin2_1995'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'lactin2_1995'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          lrf = map(data, ~nls_multstart(rate~lrf_1991(temp = temp, rmax, topt, tmin, tmax),
#                   data = d,
#                   iter = c(3,3,3,3),
#                   start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'lrf_1991') - 10,
#                   start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'lrf_1991') + 10,
#                   lower = get_lower_lims(.x$temp, .x$rate, model_name = 'lrf_1991'),
#                   upper = get_upper_lims(.x$temp, .x$rate, model_name = 'lrf_1991'),
#                   supp_errors = 'Y',
#                   convergence_count = FALSE)),
#          modifiedgaussian = map(data, ~nls_multstart(rate~modifiedgaussian_2006(temp = temp, rmax, topt, a, b),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'modifiedgaussian_2006') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'modifiedgaussian_2006') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'modifiedgaussian_2006'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'modifiedgaussian_2006'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          oneill = map(data, ~nls_multstart(rate~oneill_1972(temp = temp, rmax, ctmax, topt, q10),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'oneill_1972') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'oneill_1972') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'oneill_1972'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'oneill_1972'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          pawar = map(data, ~nls_multstart(rate~pawar_2018(temp = temp, r_tref, e, eh, topt, tref = 15),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'pawar_2018') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'pawar_2018') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'pawar_2018'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'pawar_2018'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          quadratic = map(data, ~nls_multstart(rate~quadratic_2008(temp = temp, a, b, c),
#                         data = .x,
#                         iter = c(4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'quadratic_2008') - 0.5,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'quadratic_2008') + 0.5,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'quadratic_2008'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'quadratic_2008'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          ratkowsky = map(data, ~nls_multstart(rate~ratkowsky_1983(temp = temp, tmin, tmax, a, b),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'ratkowsky_1983') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'ratkowsky_1983') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'ratkowsky_1983'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'ratkowsky_1983'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          rezende = map(data, ~nls_multstart(rate~rezende_2019(temp = temp, q10, a,b,c),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'rezende_2019') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'rezende_2019') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'rezende_2019'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'rezende_2019'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          sharpeschoolfull = map(data, ~nls_multstart(rate~sharpeschoolfull_1981(temp = temp, r_tref,e,el,tl,eh,th, tref = 15),
#                         data = .x,
#                         iter = c(4,4,4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'sharpeschoolfull_1981') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'sharpeschoolfull_1981') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'sharpeschoolfull_1981'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'sharpeschoolfull_1981'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          sharpeschoolhigh = map(data, ~nls_multstart(rate~sharpeschoolhigh_1981(temp = temp, r_tref,e,eh,th, tref = 15),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'sharpeschoolhigh_1981') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'sharpeschoolhigh_1981') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'sharpeschoolhigh_1981'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'sharpeschoolhigh_1981'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          sharpeschoollow = map(data, ~nls_multstart(rate~sharpeschoollow_1981(temp = temp, r_tref,e,el,tl, tref = 15),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'sharpeschoollow_1981') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'sharpeschoollow_1981') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'sharpeschoollow_1981'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'sharpeschoollow_1981'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          spain = map(data, ~nls_multstart(rate~spain_1982(temp = temp, a,b,c,r0),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'spain_1982') - 1,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'spain_1982') + 1,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'spain_1982'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'spain_1982'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          thomas1 = map(data, ~nls_multstart(rate~thomas_2012(temp = temp, a,b,c,topt),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'thomas_2012') - 1,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'thomas_2012') + 2,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'thomas_2012'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'thomas_2012'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          thomas2 = map(data, ~nls_multstart(rate~thomas_2017(temp = temp, a,b,c,d,e),
#                         data = .x,
#                         iter = c(3,3,3,3,3),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'thomas_2017') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'thomas_2017') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'thomas_2017'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'thomas_2017'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)),
#          weibull = map(data, ~nls_multstart(rate~weibull_1995(temp = temp, a,topt,b,c),
#                         data = .x,
#                         iter = c(4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'weibull_1995') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'weibull_1995') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'weibull_1995'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'weibull_1995'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)))

```

dummy df
```{r}

gs4_deauth()

dummy<- read_sheet("https://docs.google.com/spreadsheets/d/1Mf565NYw1fO0i1cYEQ1eDWNJULea4x8p4SE6F5_cl2Q/edit#gid=0")

as.data.frame(dummy)
dummy <- dummy 

dummy<-dummy %>% 
  mutate(curve_id = as.numeric(curve_id)) %>% 
  mutate(temp = as.numeric(temp)) %>% 
  mutate(rate = as.numeric(rate)) 

```


```{r}
# ggplot(d2, aes(temp, rate)) +
#   geom_point() +
#   theme_bw(base_size = 12) +
#   labs(x = 'Temperature (ºC)',
#        y = 'Metabolic rate',
#        title = 'Respiration across temperatures')
```

```{r}
d1 <- MultiCultiDataCleanGrowth4 %>%
  filter(Strain == "PE-rich_127") %>% 
  filter(Par_ue == 900) %>% 
  select(c(Strain, PARPhotonDose, deltaOD_Lmu_corr)) %>% 
  mutate(temp = PARPhotonDose) %>% 
  mutate(rate = deltaOD_Lmu_corr) %>% 
  mutate(curve_id = Strain) %>% 
  select(-c(PARPhotonDose, deltaOD_Lmu_corr))  %>% 
  mutate(curve_id=case_when(curve_id=="PE-rich_048"~1, curve_id=="PE-rich_127"~1, curve_id=="PC-rich_056"~1, curve_id=="PC-rich_077"~1)) %>%
  select(c(curve_id, temp, rate)) 

d1 <- MultiCultiDataCleanGrowth4 %>%
  filter(Strain == "PE-rich_127") %>% 
  filter(Par_ue != 900) %>% 
  select(c(Strain, PARPhotonDose, deltaOD_Lmu_corr)) %>% 
  mutate(temp = PARPhotonDose) %>% 
  mutate(rate = deltaOD_Lmu_corr) %>% 
  mutate(curve_id = Strain) %>% 
  select(-c(PARPhotonDose, deltaOD_Lmu_corr))  %>% 
  mutate(curve_id=case_when(curve_id=="PE-rich_048"~1, curve_id=="PE-rich_127"~1, curve_id=="PC-rich_056"~1, curve_id=="PC-rich_077"~1)) %>%
  select(c(curve_id, temp, rate)) 
```

```{r}

d2 <- MultiCultiDataCleanGrowth4 %>%
  filter(Strain == "PE-rich_048") %>% 
  filter(Par_ue == 900) %>% 
  select(c(Strain, PARPhotonDose, deltaOD_Lmu_corr)) %>% 
  mutate(temp = PARPhotonDose) %>% 
  mutate(rate = deltaOD_Lmu_corr) %>% 
  mutate(curve_id = Strain) %>% 
  select(-c(PARPhotonDose, deltaOD_Lmu_corr))  %>% 
  mutate(curve_id=case_when(curve_id=="PE-rich_048"~2, curve_id=="PE-rich_127"~2, curve_id=="PC-rich_056"~2, curve_id=="PC-rich_077"~2)) %>%
  select(c(curve_id, temp, rate)) 

d2 <- MultiCultiDataCleanGrowth4 %>%
  filter(Strain == "PE-rich_048") %>% 
  filter(Par_ue != 900) %>% 
  select(c(Strain, PARPhotonDose, deltaOD_Lmu_corr)) %>% 
  mutate(temp = PARPhotonDose) %>% 
  mutate(rate = deltaOD_Lmu_corr) %>% 
  mutate(curve_id = Strain) %>% 
  select(-c(PARPhotonDose, deltaOD_Lmu_corr))  %>% 
  mutate(curve_id=case_when(curve_id=="PE-rich_048"~2, curve_id=="PE-rich_127"~2, curve_id=="PC-rich_056"~2, curve_id=="PC-rich_077"~2)) %>%
  select(c(curve_id, temp, rate)) 
```

```{r}

d3 <- MultiCultiDataCleanGrowth4 %>%
  filter(Strain == "PC-rich_056") %>% 
  filter(Par_ue == 900) %>% 
  select(c(Strain, PARPhotonDose, deltaOD_Lmu_corr)) %>% 
  mutate(temp = PARPhotonDose) %>% 
  mutate(rate = deltaOD_Lmu_corr) %>% 
  mutate(curve_id = Strain) %>% 
  select(-c(PARPhotonDose, deltaOD_Lmu_corr))  %>% 
  mutate(curve_id=case_when(curve_id=="PE-rich_048"~3, curve_id=="PE-rich_127"~3, curve_id=="PC-rich_056"~3, curve_id=="PC-rich_077"~3)) %>%
  select(c(curve_id, temp, rate)) 

d3 <- MultiCultiDataCleanGrowth4 %>%
  filter(Strain == "PC-rich_056") %>% 
  filter(Par_ue != 900) %>% 
  select(c(Strain, PARPhotonDose, deltaOD_Lmu_corr)) %>% 
  mutate(temp = PARPhotonDose) %>% 
  mutate(rate = deltaOD_Lmu_corr) %>% 
  mutate(curve_id = Strain) %>% 
  select(-c(PARPhotonDose, deltaOD_Lmu_corr))  %>% 
  mutate(curve_id=case_when(curve_id=="PE-rich_048"~3, curve_id=="PE-rich_127"~3, curve_id=="PC-rich_056"~3, curve_id=="PC-rich_077"~3)) %>%
  select(c(curve_id, temp, rate)) 
```

```{r}

d1 <- MultiCultiDataCleanGrowth4 %>%
  filter(Strain == "PC-rich_077") %>% 
  filter(Par_ue == 900) %>% 
  select(c(Strain, PARPhotonDose, deltaOD_Lmu_corr)) %>% 
  mutate(temp = PARPhotonDose) %>% 
  mutate(rate = deltaOD_Lmu_corr) %>% 
  mutate(curve_id = Strain) %>% 
  select(-c(PARPhotonDose, deltaOD_Lmu_corr))  %>% 
  mutate(curve_id=case_when(curve_id=="PE-rich_048"~1, curve_id=="PE-rich_127"~1, curve_id=="PC-rich_056"~1, curve_id=="PC-rich_077"~1)) %>%
  select(c(curve_id, temp, rate)) 

d2<-rbind(d1, dummy)


d4 <- MultiCultiDataCleanGrowth4 %>%
  filter(Strain == "PC-rich_077") %>% 
  filter(Par_ue != 900) %>% 
  select(c(Strain, PARPhotonDose, deltaOD_Lmu_corr)) %>% 
  mutate(temp = PARPhotonDose) %>% 
  mutate(rate = deltaOD_Lmu_corr) %>% 
  mutate(curve_id = Strain) %>% 
  select(-c(PARPhotonDose, deltaOD_Lmu_corr))  %>% 
  mutate(curve_id=case_when(curve_id=="PE-rich_048"~2, curve_id=="PE-rich_127"~2, curve_id=="PC-rich_056"~2, curve_id=="PC-rich_077"~2)) %>%
  select(c(curve_id, temp, rate)) 

d5<-rbind(d3, d4)

d2<-d5
```








```{r}

# d2 <- MultiCultiDataCleanGrowth4 %>%
#   filter(Strain == "PE-rich_127") %>% 
#   filter(Par_ue != 900) %>% 
#   select(c(Strain, PARPhotonDose, deltaOD_Lmu_corr)) %>% 
#   mutate(temp = PARPhotonDose) %>% 
#   mutate(rate = deltaOD_Lmu_corr) %>% 
#   mutate(curve_id = Strain) %>% 
#   select(-c(PARPhotonDose, deltaOD_Lmu_corr))  %>% 
#   mutate(curve_id=case_when(curve_id=="PE-rich_048"~1, curve_id=="PE-rich_127"~1, curve_id=="PC-rich_056"~1, curve_id=="PC-rich_077"~1)) %>%
#   select(c(curve_id, temp, rate)) 


# d_fits2 <- nest(d2, data = c(temp, rate)) %>%
#   mutate(boatman = map(data, ~nls_multstart(rate~boatman_2017(temp = temp, rmax, tmin, tmax, a,b),
#                         data = .x,
#                         iter = c(4,4,4,4,4),
#                         start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'boatman_2017') - 10,
#                         start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'boatman_2017') + 10,
#                         lower = get_lower_lims(.x$temp, .x$rate, model_name = 'boatman_2017'),
#                         upper = get_upper_lims(.x$temp, .x$rate, model_name = 'boatman_2017'),
#                         supp_errors = 'Y',
#                         convergence_count = FALSE)))

#najlepszy
d_fits2 <- nest(d2, data = c(temp, rate)) %>%
         mutate(thomas1 = map(data, ~nls_multstart(rate~thomas_2012(temp = temp, a,b,c,topt),
                        data = .x,
                        iter = c(4,4,4,4),
                        start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'thomas_2012') - 1,
                        start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'thomas_2012') + 2,
                        lower = get_lower_lims(.x$temp, .x$rate, model_name = 'thomas_2012'),
                        upper = get_upper_lims(.x$temp, .x$rate, model_name = 'thomas_2012'),
                        supp_errors = 'Y',
                        convergence_count = FALSE)))

#tez bardzo dobry!
d_fits2 <- nest(d2, data = c(temp, rate)) %>%
        mutate(quadratic = map(data, ~nls_multstart(rate~quadratic_2008(temp = temp, a, b, c),
                        data = .x,
                        iter = c(4,4,4),
                        start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'quadratic_2008') - 0.5,
                        start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'quadratic_2008') + 0.5,
                        lower = get_lower_lims(.x$temp, .x$rate, model_name = 'quadratic_2008'),
                        upper = get_upper_lims(.x$temp, .x$rate, model_name = 'quadratic_2008'),
                        supp_errors = 'Y',
                        convergence_count = FALSE)))

#super - gdy nie ma ostrego spadku
d_fits2 <- nest(d2, data = c(temp, rate)) %>%
        mutate(modifiedgaussian = map(data, ~nls_multstart(rate~modifiedgaussian_2006(temp = temp, rmax, topt, a, b),
                        data = .x,
                        iter = c(4,4,4,4),
                        start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'modifiedgaussian_2006') - 10,
                        start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'modifiedgaussian_2006') + 10,
                        lower = get_lower_lims(.x$temp, .x$rate, model_name = 'modifiedgaussian_2006'),
                        upper = get_upper_lims(.x$temp, .x$rate, model_name = 'modifiedgaussian_2006'),
                        supp_errors = 'Y',
                        convergence_count = FALSE)))


d_fits2 <- nest(d2, data = c(temp, rate)) %>%
        mutate(lactin2 = map(data, ~nls_multstart(rate~lactin2_1995(temp = temp, a, b, tmax, delta_t),
                        data = .x,
                        iter = c(4,4,4,4),
                        start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'lactin2_1995') - 10,
                        start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'lactin2_1995') + 10,
                        lower = get_lower_lims(.x$temp, .x$rate, model_name = 'lactin2_1995'),
                        upper = get_upper_lims(.x$temp, .x$rate, model_name = 'lactin2_1995'),
                        supp_errors = 'Y',
                        convergence_count = FALSE)))


d_fits2 <- nest(d2, data = c(temp, rate)) %>%
        mutate(briere2 = map(data, ~nls_multstart(rate~briere2_1999(temp = temp, tmin, tmax, a,b),
                        data = .x,
                        iter = c(4,4,4,4),
                        start_lower = get_start_vals(.x$temp, .x$rate, model_name = 'briere2_1999') - 10,
                        start_upper = get_start_vals(.x$temp, .x$rate, model_name = 'briere2_1999') + 10,
                        lower = get_lower_lims(.x$temp, .x$rate, model_name = 'briere2_1999'),
                        upper = get_upper_lims(.x$temp, .x$rate, model_name = 'briere2_1999'),
                        supp_errors = 'Y',
                        convergence_count = FALSE)))


```

```{r}

# stack models
d_stack <- select(d_fits2, -data) %>%
  pivot_longer(., names_to = 'model_name', values_to = 'fit', modifiedgaussian)

# get parameters using tidy
params <- d_stack %>%
  mutate(., est = map(fit, tidy)) %>%
  select(-fit) %>%
  unnest(est)

# get predictions using augment
newdata <- tibble(temp = seq(min(d2$temp), max(d2$temp), length.out = 100))
d_preds <- d_stack %>%
  mutate(., preds = map(fit, augment, newdata = newdata)) %>%
  select(-fit) %>%
  unnest(preds)

# plot
ggplot(d_preds, aes(temp, rate)) +
  geom_point(aes(temp, rate), d2) +
  geom_line(aes(temp, .fitted, colour=as.factor(curve_id))) +
  facet_wrap(~model_name, labeller = labeller(model_name = label_facets_num), scales = 'free', ncol = 5) +
  theme_bw(base_size = 12) +
  theme(legend.position = 'none',
        strip.text = element_text(hjust = 0),
        strip.background = element_blank()) +
  labs(x = 'Temperature (ºC)',
       y = 'Metabolic rate',
       title = 'Fits of every model available in rTPC') +
  geom_hline(aes(yintercept = 0), linetype = 2)

# quadratic_127PUR_Fit<-d_preds
# quadratic_127PUR_Params<-params
# quadratic_127PUR_d2<-d2


# briere2900_Fit<-d_preds
# briere2900_Params<-params
# briere2900_d2<-d2

```

```{r fig.height = 7, fig.width = 8.5, warning = FALSE}

#str(CleanGrowthPARPUR)
# CleanGrowthPARPUR2<-CleanGrowthPARPUR %>% 
# filter(deltaOD_Lmu_se<1.146435e-03)


O2.labs <- c("Strain")
names(O2.labs) <- c(21)

lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("1 µE"), expression("2 µE"), expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

ggplot(CleanGrowthPARPUR, aes(PhotonDose_value, deltaOD_Lmu_corr)) +
  geom_point(aes(PhotonDose_value, deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3, alpha = 0.9, show.legend = T, CleanGrowthPARPUR) +
  
  geom_errorbar(aes(x = PhotonDose_value, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), width=4000000, data = . %>% filter(deltaOD_Lmu_se<8.057558e-03)) +
  
  geom_line(aes(temp, .fitted, linetype=as.factor(Condition)), show.legend = F, quadratic_Fitok) +
  scale_y_continuous(breaks=seq(0, 0.25, by = 0.1)) +
  coord_cartesian(ylim = c(0, 0.25)) +
  scale_x_continuous(label=scientific_10) +
  scale_linetype_manual(values=c("equal900" = "dotted", "less900" = "solid"), breaks=c('8', '12', '16', "24", "", "")) +
  
  scale_colour_manual(values = c("", "", "darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2, breaks=c('', '', '30', "90", "180", "300", "900")) +
  
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  # scale_colour_manual(values = c("black", "pink4", "darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2) +
  
  labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  geom_hline(aes(yintercept = 0), linetype = 2) +

  ggh4x::facet_nested(cols = vars(O2, Strain), rows = vars(PhotonDose), labeller = labeller(O2 = O2.labs)) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=12, angle = 45, vjust = 1, hjust = 1),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.94,0.85),
        #legend.position = c(0.06,0.85),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.15, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))


```

```{r}
CleanGrowthPAR <- MultiCultiDataCleanGrowth4 %>%
  select(c(Strain, Par_ue, Photoperiod, O2, WL, PARPhotonDose, deltaOD_Lmu_corr, deltaOD_Lmu_se)) %>% 
  mutate(PhotonDose = WL) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="WW" ~"PAR")) %>% 
  mutate(PhotonDose_value = PARPhotonDose) %>% 
  select(-c(PARPhotonDose))
  
CleanGrowthPUR <- MultiCultiDataCleanGrowth4 %>%
  select(c(Strain, Par_ue, Photoperiod, O2, WL, PURPhotonDose, deltaOD_Lmu_corr, deltaOD_Lmu_se)) %>% 
  mutate(PhotonDose = WL) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="WW" ~"PUR")) %>% 
  mutate(PhotonDose_value = PURPhotonDose) %>% 
  select(-c(PURPhotonDose))
#colnames(MultiCultiDataCleanGrowth4)

CleanGrowthPARPUR <-rbind(CleanGrowthPAR, CleanGrowthPUR)

```




```{r}
# lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
# lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))
# data_textB <- data.frame(
#   O2 = c(21),
#   Strain  = c("PE-rich_127"),
#   label = c("B"))
# O2.labs <- c("Strain")
# names(O2.labs) <- c(21)
# scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
# GrowthratePUR <- MultiCultiDataCleanGrowth4 %>%
#   filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
#   ggplot() +
#   geom_point(aes(x = PURPhotonDose, y = deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.9, show.legend = T) +
#     geom_text(data=data_textB, aes(x=32000000, y=0.25, label=label), size=5) +
#    geom_errorbar(aes(x = PURPhotonDose, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5, width=2000000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +
#   labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "PUR photon dose ( µmol photons "~m^-2~""~d^-1~")") +
#   scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
#   scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2) +
#   ggh4x::facet_nested(cols = vars(O2, Strain), labeller = labeller(O2 = O2.labs)) +
#   scale_x_continuous(label=scientific_10) +
#   guides(color = guide_legend(order = 1), shape = guide_legend(order = 2)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.text = element_text(size=12),
#         axis.text.x = element_text(size=12, angle = 45, vjust = 1, hjust = 1),
#         axis.title = element_text(size=16),
#         strip.background = element_rect(fill="white"),
#         strip.text = element_text(size=12),
#         axis.title.y = element_text(margin=margin(r=10)),
#         axis.title.x = element_text(margin=margin(t=10)),
#         legend.background = element_rect(fill="transparent"),
#         legend.position = c(0.06,0.80),
#         legend.key.height= unit(0.005, 'cm'),
#         legend.spacing.y = unit(-0.1, "cm"),
#         legend.title = element_blank(),
#         legend.text = element_text(size=10))
# GrowthratePUR

```



params all
```{r}

quadratic_048PAR_Params2 <-quadratic_048PAR_Params %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PE-rich_048")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))

quadratic_127PAR_Params2 <-quadratic_127PAR_Params %>%
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PE-rich_127")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))

quadratic_056PAR_Params2 <-quadratic_056PAR_Params %>%
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PC-rich_056")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))

quadratic_077PAR_Params2 <-quadratic_077PAR_Params %>%
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PC-rich_077")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))
  


quadratic_048PUR_Params2 <-quadratic_048PUR_Params %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PE-rich_048")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))

quadratic_127PUR_Params2 <-quadratic_127PUR_Params %>%
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PE-rich_127")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))

quadratic_056PUR_Params2 <-quadratic_056PUR_Params %>%
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PC-rich_056")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))

quadratic_077PUR_Params2 <-quadratic_077PUR_Params %>%
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PC-rich_077")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))


quadratic_Params2 <- rbind(quadratic_048PAR_Params2, 
                          quadratic_127PAR_Params2,
                          quadratic_056PAR_Params2,
                          quadratic_077PAR_Params2,
                          quadratic_048PUR_Params2,
                          quadratic_127PUR_Params2,
                          quadratic_056PUR_Params2,
                          quadratic_077PUR_Params2)

rm(quadratic_048PAR_Params2, 
                          quadratic_127PAR_Params2,
                          quadratic_056PAR_Params2,
                          quadratic_077PAR_Params2,
                          quadratic_048PUR_Params2,
                          quadratic_127PUR_Params2,
                          quadratic_056PUR_Params2,
                          quadratic_077PUR_Params2)
```

d_preds all
```{r}
# quadratic_127PUR_Fit<-d_preds

quadratic_048PAR_Fit2 <-quadratic_048PAR_Fit %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PE-rich_048")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))

quadratic_127PAR_Fit2 <-quadratic_127PAR_Fit %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PE-rich_127")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))

quadratic_056PAR_Fit2 <-quadratic_056PAR_Fit %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PC-rich_056")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))

quadratic_077PAR_Fit2 <-quadratic_077PAR_Fit %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PC-rich_077")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))
  


quadratic_048PUR_Fit2 <-quadratic_048PUR_Fit %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PE-rich_048")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))

quadratic_127PUR_Fit2 <-quadratic_127PUR_Fit %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PE-rich_127")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))

quadratic_056PUR_Fit2 <-quadratic_056PUR_Fit %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PC-rich_056")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))

quadratic_077PUR_Fit2 <-quadratic_077PUR_Fit %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = model_name) %>% 
  mutate(Strain=case_when(Strain=="quadratic"~"PC-rich_077")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))


quadratic_Fit2 <- rbind(quadratic_048PAR_Fit2, 
                          quadratic_127PAR_Fit2,
                          quadratic_056PAR_Fit2,
                          quadratic_077PAR_Fit2,
                          quadratic_048PUR_Fit2,
                          quadratic_127PUR_Fit2,
                          quadratic_056PUR_Fit2,
                          quadratic_077PUR_Fit2)

rm(quadratic_048PAR_Fit2, 
                          quadratic_127PAR_Fit2,
                          quadratic_056PAR_Fit2,
                          quadratic_077PAR_Fit2,
                          quadratic_048PUR_Fit2,
                          quadratic_127PUR_Fit2,
                          quadratic_056PUR_Fit2,
                          quadratic_077PUR_Fit2)
```


d2 all
```{r}
# quadratic_127PUR_d2<-d2

quadratic_048PAR_d22 <-quadratic_048PAR_d2 %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = curve_id) %>% 
  mutate(Strain=case_when(Strain==1~"PE-rich_048", Strain==2~"PE-rich_048")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))

quadratic_127PAR_d22 <-quadratic_127PAR_d2 %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = curve_id) %>% 
  mutate(Strain=case_when(Strain==1~"PE-rich_127", Strain==2~"PE-rich_127")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))

quadratic_056PAR_d22 <-quadratic_056PAR_d2 %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = curve_id) %>% 
  mutate(Strain=case_when(Strain==1~"PC-rich_056", Strain==2~"PC-rich_056")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))

quadratic_077PAR_d22 <-quadratic_077PAR_d2 %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = curve_id) %>% 
  mutate(Strain=case_when(Strain==1~"PC-rich_077", Strain==2~"PC-rich_077")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PAR", PhotonDose=="less900"~"PAR"))
  


quadratic_048PUR_d22 <-quadratic_048PUR_d2 %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = curve_id) %>% 
  mutate(Strain=case_when(Strain==1~"PE-rich_048", Strain==2~"PE-rich_048")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))

quadratic_127PUR_d22 <-quadratic_127PUR_d2 %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = curve_id) %>% 
  mutate(Strain=case_when(Strain==1~"PE-rich_127", Strain==2~"PE-rich_127")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))

quadratic_056PUR_d22 <-quadratic_056PUR_d2 %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = curve_id) %>%  
  mutate(Strain=case_when(Strain==1~"PC-rich_056", Strain==2~"PC-rich_056")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))

quadratic_077PUR_d22 <-quadratic_077PUR_d2 %>% 
  mutate(Condition = curve_id) %>% 
  mutate(Strain = curve_id) %>% 
  mutate(Strain=case_when(Strain==1~"PC-rich_077", Strain==2~"PC-rich_077")) %>%
  mutate(Condition=case_when(Condition==1~"equal900", Condition==2~"less900")) %>% 
  mutate(PhotonDose = Condition) %>% 
  mutate(PhotonDose=case_when(PhotonDose=="equal900"~"PUR", PhotonDose=="less900"~"PUR"))


quadratic_d22 <- rbind(quadratic_048PAR_d22, 
                          quadratic_127PAR_d22,
                          quadratic_056PAR_d22,
                          quadratic_077PAR_d22,
                          quadratic_048PUR_d22,
                          quadratic_127PUR_d22,
                          quadratic_056PUR_d22,
                          quadratic_077PUR_d22)

rm(quadratic_048PAR_d22, 
                          quadratic_127PAR_d22,
                          quadratic_056PAR_d22,
                          quadratic_077PAR_d22,
                          quadratic_048PUR_d22,
                          quadratic_127PUR_d22,
                          quadratic_056PUR_d22,
                          quadratic_077PUR_d22)
```



# Save assembled spectra data set
```{r save fit params}

saveRDS(quadratic_Paramsok, file.path(DataOut, paste(Project, "quadratic_Paramsok.Rds", sep = "_"), fsep = .Platform$file.sep))

saveRDS(quadratic_Fitok, file.path(DataOut, paste(Project, "quadratic_Fitok.Rds", sep = "_"), fsep = .Platform$file.sep))

saveRDS(quadratic_d2ok, file.path(DataOut, paste(Project, "quadratic_d2ok.Rds", sep = "_"), fsep = .Platform$file.sep))

saveRDS(CleanGrowthPARPUR, file.path(DataOut, paste(Project, "CleanGrowthPARPUR.Rds", sep = "_"), fsep = .Platform$file.sep))

```


Fit file
```{r}
Project <- "PICO"
DataIn <- file.path("..", "ImportedData", "SySlmanuscriptWWPhotoperiod", fsep = .Platform$file.sep)
FileEncode <- "UTF-8"
Delimiter <- ","
HeaderRows <- 0
```

Fit file
Exported Rmd only first time in session
```{r}
list.files(path = DataIn, pattern = Project, full.names = TRUE)
```

Fit file
```{r read ProcessFile}
CleanGrowthPARPURFile <- "../ImportedData/SySlmanuscriptWWPhotoperiod/PICO_CleanGrowthPARPUR.Rds"
CleanGrowthPARPURFileName <- str_split(string = CleanGrowthPARPURFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")
CleanGrowthPARPUR <- readRDS(CleanGrowthPARPURFile)  %>%
  ungroup()

quadratic_d2File <- "../ImportedData/SySlmanuscriptWWPhotoperiod/PICO_quadratic_d2.Rds"
quadratic_d2FileName <- str_split(string = quadratic_d2File, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")
quadratic_d2 <- readRDS(quadratic_d2File)  %>%
  ungroup()

quadratic_FitFile <- "../ImportedData/SySlmanuscriptWWPhotoperiod/PICO_quadratic_Fit.Rds"
quadratic_FitFileName <- str_split(string = quadratic_FitFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")
quadratic_Fit <- readRDS(quadratic_FitFile)  %>%
  ungroup()

quadratic_ParamsFile <- "../ImportedData/SySlmanuscriptWWPhotoperiod/PICO_quadratic_Params.Rds"
quadratic_ParamsFileName <- str_split(string = quadratic_ParamsFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")
quadratic_Params <- readRDS(quadratic_ParamsFile)  %>%
  ungroup()

```


```{r}

quadratic_d2<-quadratic_d2 %>% 
  filter(curve_id == 1)

quadratic_Fit<-quadratic_Fit %>% 
  filter(curve_id == 1)

quadratic_Params<-quadratic_Params %>% 
  filter(curve_id == 1)


quadratic_d2ok<-rbind(quadratic_d2,quadratic_d22)
quadratic_Fitok<-rbind(quadratic_Fit,quadratic_Fit2)
quadratic_Paramsok<-rbind(quadratic_Params,quadratic_Params2)

quadratic_Fitok<-quadratic_Fitok %>% 
  mutate(O2 = PhotonDose) %>% 
  mutate(O2=case_when(O2=="PAR"~21, PhotonDose=="PUR"~21))

```





