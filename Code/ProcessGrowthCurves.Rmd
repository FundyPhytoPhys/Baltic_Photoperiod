---
title: "ProcessGrowthCurve"
author:
- Sylwia Sliwinska-Wilczewska
- Douglas A. Campbell
date: "`r format(Sys.Date())`"
output:
bookdown::html_document2:
    code_folding: show
    keep_md: yes
    toc: TRUE
    toc_float: TRUE
    toc_depth: 6
    fig_caption: yes
bibliography: BalticPhotoperiod.bib
csl: plos-one.csl
editor_options: 
  markdown: 
    wrap: 72
---

# Set Chunk Options

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
knitr::opts_chunk$set(fig.path='Figs/')
```

# Introduction

This RMD process MultiCulti files and generate growth curves plot.

# Load Libraries and set Project Variables

```{r load libraries} 
library(tidyverse)
library(lubridate)
library(stringr)
library(broom)
library(knitr)
library(OneR)
library(zoo)
library(strucchange)
library(ggpubr)
library(reshape2)
library(photobiology)
library(gcookbook)
library(scales)
library(googledrive)
library(googlesheets4)
library(readxl)
```

```{r set project variables}
Project <- "Baltic_Photoperiod"
DataOut <- file.path("..", "Data", "ProcessedData", "ProcessedGrowthCurveData")
DataIn <- file.path("..", "Data", "ImportedData", "ImportedMCData", fsep = .Platform$file.sep)

FileEncode <- "UTF-8" 
Delimiter <- ""
HeaderRows <- 0
```

# List and read imported MC files

```{r Exported Rmd only first time in session}
list.files(path = DataIn, pattern = Project, full.names = TRUE)
```

```{r read pigments File}
#df ontained mean OD per day from Multiculti and Abs from Olis spectra for selected nm. Based on this I calculated pigments per mL and per cell (pg/cell)

MCPigmentFile <- "../Data/ImportedData/Baltic_Photoperiod_Imported_Pigments_OtherRepository.Rds"
MCPigmentFileName <- str_split(string = MCPigmentFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")
MCPigment <- readRDS(MCPigmentFile)  %>%
  ungroup()
```

combine pigments data (for Solisense) and number of cells (based on MultiCulti OD) with PUR and Growth rate
```{r Preparing df for further analysis}
MCPigment<-MCPigment %>% 
  drop_na(Date, MC) %>%
  mutate(OlisDate = Date) %>% 
  mutate(CultureID=ID) %>% 
  select(-c(FilenameMultiCulti,Filename,E_days,Date, ID)) %>% 
  mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) %>% 
  select(-c(InnocDate,Abs440, Abs480, Abs565, Abs620, Abs650, Abs665)) %>% 
  filter(Par_ue!= 600) 
```

```{r Replace negative values in data frame by zero, delete errors}
MCPigment <- MCPigment
MCPigment[MCPigment < 0] <- 0

MCPigment<-MCPigment %>% 
  filter(PhycoChlaRatio<10)
```

```{r Calculate pigments per L}
MCPigment <- MCPigment %>%
  mutate(cellL=cellml*1000) %>% 
  mutate(ChlaugL = ChlaugmL*1000) %>% 
  mutate(PhycougL = (PCugmL+PEugmL+APCugmL)*1000) 
```

```{r Test plot - pigments per cell, fig.height = 8, fig.width = 8}
# scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
# lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
# lab2=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
# lab3=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))
# 
# MCPigment %>%
#   ggplot() +
#   geom_point(aes(x = Time_h, y = Phycopgcell, colour = as.factor(Strain)), alpha = 0.9, size = 3, show.legend = T) +
#   scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
#   ggh4x::facet_nested(cols = vars(Photoperiod), rows = vars(Par_ue), labeller = label_parsed) +
#   theme_bw()
```

```{r save rds}
saveRDS(MCPigment, file.path(DataOut, paste(Project, "Processed_MCPigmentAll.Rds", sep = "_"), fsep = .Platform$file.sep))
```

```{r Combine Chla, phyco, and Car in one column for final plot}
MCPigment1<-MCPigment %>% 
  select(-c(Chlapgcell, Carpgcell)) %>% 
  mutate(Pigmentspgcell=Phycopgcell*1) %>% 
  select(-c(Phycopgcell))
MCPigment1$PigmentsName = "Total~phycobilins"

MCPigment2<-MCPigment %>% 
  select(-c(Phycopgcell, Carpgcell)) %>% 
  mutate(Pigmentspgcell=Chlapgcell*1) %>% 
  select(-c(Chlapgcell))
MCPigment2$PigmentsName = "Chlorophyll~a"

MCPigment3<-MCPigment %>% 
  select(-c(Chlapgcell, Phycopgcell)) %>% 
  mutate(Pigmentspgcell=Carpgcell*1) %>% 
  select(-c(Carpgcell))
MCPigment3$PigmentsName = "Carotenoids"
  
MCPigmentPlot<-rbind(MCPigment1, MCPigment2, MCPigment3)

rm(MCPigment1, MCPigment2, MCPigment3)
```

```{r Create tidy PAR photon dose column and facets for plot}
MCPigmentPlot <- MCPigmentPlot %>%
    mutate(PARPhotonDoseTidy=PARPhotonDose/100000)

MCPigmentPlot$facetsPARPhotonDose = factor(MCPigmentPlot$WL, labels = c("PAR~photon~dose~(10^{5}~µmol~photons~m^{-2}~d^{-1})"))
```

```{r Final pigments per cell plot, fig.height = 8, fig.width = 8}
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }
lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
lab2=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab3=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))

MCPigmentPlot %>%
  filter(PARPhotonDoseTidy == 4.32000|
  PARPhotonDoseTidy == 6.48000|
  PARPhotonDoseTidy == 8.64000|
  PARPhotonDoseTidy == 43.20000|
  PARPhotonDoseTidy == 64.80000|
  PARPhotonDoseTidy == 86.40000) %>%
  ggplot() +
  geom_point(aes(x = Time_h, y = Pigmentspgcell, colour = as.factor(Strain)), alpha = 0.9, size = 3, show.legend = T) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  labs(y = "Pigments content ( pg  " ~ cell^-1~")", x = "Elapsed time (h)") +
  ggh4x::facet_nested(cols = vars(facetsPARPhotonDose, PARPhotonDoseTidy), rows = vars(factor(PigmentsName, levels=c('Chlorophyll~a', 'Total~phycobilins', 'Carotenoids'))), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.08,0.92),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.005, "cm"),
        legend.spacing.x = unit(-0.005, "cm"),
        legend.title = element_blank(),
        legend.text = element_text(size=10))
```

```{r Combine phyco/Chla ratio and car/chla ratio in one column for final plot}
MCPigmentRatio1<-MCPigment %>% 
  select(-c(PhycoChlaRatio)) %>% 
  mutate(PigmentsRatio=CarChlaRatio*1) %>% 
  select(-c(CarChlaRatio))
MCPigmentRatio1$PigmentsRatioName = "Car/Chl~a~ratio"

MCPigmentRatio2<-MCPigment %>% 
  select(-c(CarChlaRatio)) %>% 
  mutate(PigmentsRatio=PhycoChlaRatio*1) %>% 
  select(-c(PhycoChlaRatio))
MCPigmentRatio2$PigmentsRatioName = "Total~Phyco/Chl~a~ratio"

MCPigmentRatioPlot<-rbind(MCPigmentRatio1, MCPigmentRatio2)

rm(MCPigmentRatio1, MCPigmentRatio2)
```

```{r Create tidy PAR photon dose column and facets for plot}
MCPigmentRatioPlot <- MCPigmentRatioPlot %>%
    mutate(PARPhotonDoseTidy=PARPhotonDose/100000)

MCPigmentRatioPlot$facetsPARPhotonDose = factor(MCPigmentRatioPlot$WL, labels = c("PAR~photon~dose~(10^{5}~µmol~photons~m^{-2}~d^{-1})"))
```

```{r Final pigments per cell plot, fig.height = 5, fig.width = 8}
data_textA <- data.frame(
  facetsPARPhotonDose=c("PAR~photon~dose~(10^{5}~µmol~photons~m^{-2}~d^{-1})"),
  PARPhotonDoseTidy = c(86.40000),
  label = c("A"))

lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
lab2=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab3=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))

Plot1<-MCPigmentRatioPlot %>%
  filter(PigmentsRatioName!="Car/Chl~a~ratio") %>% 
  filter(PARPhotonDoseTidy == 4.32000|
  PARPhotonDoseTidy == 6.48000|
  PARPhotonDoseTidy == 8.64000|
  PARPhotonDoseTidy == 43.20000|
  PARPhotonDoseTidy == 64.80000|
  PARPhotonDoseTidy == 86.40000) %>%
  ggplot() +
  geom_point(aes(x = Time_h, y = PigmentsRatio, colour = as.factor(Strain)), alpha = 0.9, size = 3, show.legend = T) +
  geom_text(data=data_textA, aes(x=300, y=6.3, label=label), size=5) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  labs(y = "Total Phyco/Chl a ratio", x = "Elapsed time (h)") +
  #labs(y = "Total Phycobilins/Chl " ~italic(a)~ "ratio", x = "Elapsed time (h)") +
  scale_y_continuous(breaks=seq(0, 7.5, by = 1.5)) +
  coord_cartesian(ylim = c(0, 6.5)) +
  ggh4x::facet_nested(cols = vars(facetsPARPhotonDose, PARPhotonDoseTidy), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_blank(),
        axis.title = element_text(size=16),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_blank(),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.08,0.87),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.005, "cm"),
        legend.spacing.x = unit(-0.005, "cm"),
        legend.title = element_blank(),
        axis.ticks.x = element_blank(),
        legend.text = element_text(size=10))
Plot1
```

```{r Read processed Olis and jaz tidy file}
OLISAllPURTidyFile <- "../Data/ProcessedData/Baltic_Photoperiod_Processed_OlisSpectraTidy.Rds"
OLISAllPURTidyFileName <- str_split(string = OLISAllPURTidyFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")
OLISAllPURTidy <- readRDS(OLISAllPURTidyFile)  %>%
  ungroup()
```

```{r Create final PUR/PAR ratio plot, fig.height = 5, fig.width = 8}
data_textB <- data.frame(
  facetsPARPhotonDose=c("PAR~photon~dose~(10^{5}~µmol~photons~m^{-2}~d^{-1})"),
  PARPhotonDoseTidy = c(86.40000),
  label = c("B"))

lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))
lab2=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab3=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))

Plot2<-OLISAllPURTidy %>%
  filter(PARPhotonDoseTidy == 4.32000|
  PARPhotonDoseTidy == 6.48000|
  PARPhotonDoseTidy == 8.64000|
  PARPhotonDoseTidy == 43.20000|
  PARPhotonDoseTidy == 64.80000|
  PARPhotonDoseTidy == 86.40000) %>%
  ggplot() +
  geom_point(aes(x = E_hours, y = PURPARRatio, colour = as.factor(Strain)), alpha = 0.9, size = 3, show.legend = F) +
  geom_text(data=data_textB, aes(x=300, y=1.05, label=label), size=5) +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  labs(y = "PUR/PAR ratio", x = "Elapsed time (h)") +
  scale_y_continuous(breaks=seq(0, 1, by = 0.5)) +
  coord_cartesian(ylim = c(0, 1.1)) +
  ggh4x::facet_nested(cols = vars(facetsPARPhotonDose, PARPhotonDoseTidy), labeller = label_parsed) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        legend.background = element_rect(fill="white"),
        legend.position = c(0.08,0.87),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.005, "cm"),
        legend.spacing.x = unit(-0.005, "cm"),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.title = element_blank(),
        legend.text = element_text(size=10))
Plot2
```

```{r Final Plot arrange, fig.height = 10, fig.width = 8, warning = FALSE}
ggarrange(Plot1,Plot2,
          ncol = 1, nrow = 2)
```

```{r Cleaning the environment}
rm(data_textA, data_textB, Plot1, Plot2)
```













```{r}
OLISAllPURTidyhase <- OLISAllPURTidy %>%
  left_join(., tmaxAG, by = c("Strain"="Strain","Par_ue"="Par_ue","Photoperiod"="Photoperiod"))
```

pozniej potrzebne do solisense i growth, nie wyrzucac na razie!
```{r Load tmaxAG}
# gs4_deauth()
# 
# tmaxAG<- read_sheet("https://docs.google.com/spreadsheets/d/1WyB4jonJGW9uFzKHp1Z6DnkMv-CP1PerwQ6sSLK7O8I/edit#gid=0")
# 
# as.data.frame(tmaxAG)
# tmaxAG <- tmaxAG
# 
# tmaxAG<-tmaxAG %>% 
#   mutate(Par_ue = as.numeric(Par_ue)) %>%
#   mutate(Photoperiod = as.numeric(Photoperiod)) %>%
#   mutate(dayRound_tmaxAG = as.numeric(dayRound_tmaxAG)) %>%
#   mutate(hRound_tmaxAG = as.numeric(hRound_tmaxAG)) %>% 
#   mutate(day_tmaxAG = as.numeric(day_tmaxAG)) %>% 
#   mutate(h_tmaxAG = as.numeric(h_tmaxAG)) %>%
#   mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
#          Strain=="BA48R"~"PE-rich_048",
#         Strain=="BA56G"~"PC-rich_056",
#          Strain=="BA77G"~"PC-rich_077"))
```
Combine OLISAllPURShort with tmaxAG data from google sheet

OLISAllPURShortPhase -> Divided PAR, PUR and PUR/PAR Ratio data to Exponential and Pre-stationary phase according to tmaxAG from google sheet
```{r}
# OLISAllPURTidyhase <- OLISAllPURTidy %>%
#   left_join(., tmaxAG, by = c("Strain"="Strain","Par_ue"="Par_ue","Photoperiod"="Photoperiod")) 
# 
# OLISAllPURTidyhase <- OLISAllPURTidyhase %>%
#   mutate(Phase = O2) %>% 
#   mutate(Phase=case_when(E_days<=dayRound_tmaxAG~"Exponential",
#          E_days>dayRound_tmaxAG~"Pre-stationary"))
```


```{r Create df for plot}
# data_vline1 <- data.frame(Par_ue= c(30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900),Photoperiod= c(8,8,8,8,8,12,12,12,12,12,16,16,16,16,16,24,24,24,24,24),facetsPar_ue= c("PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})"),facetsPhotoperiod= c("Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)"), value = c(347,321.02,240.90,187.92,168,347,245.39,189.48,162.62,168,347,168.39,113.76,111.56,110,154.64,114.68,93.32,93.78,110))
# 
# data_vline2 <- data.frame(Par_ue= c(30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900),Photoperiod= c(8,8,8,8,8,12,12,12,12,12,16,16,16,16,16,24,24,24,24,24),facetsPar_ue= c("PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})"),facetsPhotoperiod= c("Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)"), value = c(346,319.92,240.81,214.41,168,346,216.33,163.44,136.03,168,299.38,166.28,137.32,111.28,109.45,119.35,103.77,100.38,79.20,94.23))
# 
# data_vline3 <- data.frame(Par_ue= c(30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900),Photoperiod= c(8,8,8,8,8,12,12,12,12,12,16,16,16,16,16,24,24,24,24,24),facetsPar_ue= c("PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})"),facetsPhotoperiod= c("Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)"), value = c(345,347,266.84,240.72,168,345,296.45,217.80,191.03,168,345,191.49,114.95,112.75,108,157.85,120.27,110.28,95.79,79.66))
# 
# data_vline4 <- data.frame(Par_ue= c(30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900),Photoperiod= c(8,8,8,8,8,12,12,12,12,12,16,16,16,16,16,24,24,24,24,24),facetsPar_ue= c("PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})"),facetsPhotoperiod= c("Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)"), value = c(344, 345, 266.93, 215.42, 168,344, 244.38,190.39,163.62,168,299.57, 168.85, 137.50, 112.29, 107,138.78, 120.18, 108.08, 98.36, 107))
```









combine with PUR data
```{r}
# MultiCultiGrowthRatePURExp<-MultiCultiGrowthRatePURExp %>%
#   select(-c(Filename, OD720_Lmu_corr, OD720_Lmu_se, OD720_LseGrowthFlag, GrowthAmpOD720Flag_14days))

# colnames(MCPigment)
# 
# MultiCultiPigmentMaxAll <- OLISAllPURTidy %>%
#   left_join(., MCPigment, by = c("Run"="Run","ID"="ID", "Tube"="Tube", "Strain"="Strain", "ExpDate"="ExpDate","Par_ue"="Par_ue","Photoperiod"="Photoperiod","O2"="O2","WL"="WL","LightShape"="LightShape","ExpEndDate"="ExpEndDate", "E_days"="MultiDay", "E_hours"="Time_h", "PARPhotonDose"="PARPhotonDose", "MC"="MC"))
```


Create only one pigment in exp - for Solisense data
Combine growth rate and exp pigments
```{r}
MultiCultiPigmentMaxAllExp<-MultiCultiPigmentMaxAll 
  
O1 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 30 | Par_ue == 300 | Par_ue == 90 | Par_ue == 180) %>% 
  filter(Photoperiod == 24) %>% 
  filter(E_days < 4)

O2 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 180 | Par_ue == 300) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 4)

O3 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 6)

O4 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 30) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 12)

O5 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 900 | Par_ue == 600) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 4)

O6 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 30) %>% 
  filter(Photoperiod == 8 | Photoperiod == 12) %>% 
  filter(E_days == 12| E_days == 13)
  
O7 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 8) %>% 
  filter(E_days == 12 | E_days ==13)

O8 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 8 | E_days ==9)

O9 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(E_days == 11)

O10 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 8) %>% 
  filter(E_days == 8 | E_days == 9)

O11 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 12) %>% 
  filter(E_days == 6 | E_days == 7)

O12 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 6 | E_days ==7)

O13 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(E_days == 9)

O14 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 4 | E_days ==5)

O15 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PC-rich_056") %>%  
  filter(E_days == 7)

O16 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 900) %>% 
  filter(Photoperiod == 8 | Photoperiod == 12)

O17 <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue == 900 | Par_ue == 600) %>% 
  filter(Photoperiod == 24) %>% 
  filter(E_hours < 100 & E_hours > 48)

MultiCultiPigmentMaxAllExp2 <-rbind(O1, O2, O3, O4, O5, O6, O7, O8, O9, O10, O11, O12, O13, O14, O15, O16, O17)

rm(O1, O2, O3, O4, O5, O6, O7, O8, O9, O10, O11, O12, O13, O14, O15, O16, O17)

  
```

Because I have replica in growt rate - I combine one choosen pigmen exp to all growth rate data
```{r}
#colnames(MultiCultiDataCleanGrowthAll4)
MultiCultiPigmentMaxAllExp4<-MultiCultiPigmentMaxAllExp2 %>% 
  # mutate(cellL=cellml*1000) %>% 
  # mutate(ChlaugL = ChlaugmL*1000) %>% 
  # mutate(PhycougL = (PCugmL+PEugmL+APCugmL)*1000) %>% 
  mutate(cellLExp = cellL) %>%
  mutate(ChlapgcellExp = Chlapgcell) %>% 
  mutate(PhycopgcellExp = Phycopgcell) %>% 
  mutate(ChlaugLExp = ChlaugL) %>% 
  mutate(PhycougLExp = PhycougL) %>% 
  mutate(PhycoChlaRatioExp = PhycopgcellExp/ChlapgcellExp) %>% 
  select(c(Strain, Par_ue, Photoperiod, ChlapgcellExp, PhycopgcellExp, ChlaugLExp, PhycougLExp, PhycoChlaRatioExp, cellLExp))
  
MultiCultiPigmentMaxAllExp <- MultiCultiPigmentMaxAll %>%
  full_join(., MultiCultiPigmentMaxAllExp4, by = c("Strain"="Strain", "Par_ue"="Par_ue","Photoperiod"="Photoperiod"))


```


Plot -> only exp Phyco, Chla, and Phyco/chla ratio
```{r fig.height = 8, fig.width = 8}


lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))

lab2=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab3=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))



Plot <- MultiCultiPigmentMaxAllExp %>%
   filter(Par_ue!=600) %>% 
  ggplot() +
  geom_point(aes(x = E_hoursExp, y = PhycopgcellExp, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  #labs(y = "Total Phyco/Chl " ~italic(a)~ "ratio", x = "Elapsed time (h)") +
  # scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  # coord_cartesian(ylim = c(0, 1.7)) +
  ggh4x::facet_nested(cols = vars(facetsPhotoperiod, Photoperiod), rows = vars(facetsPar_ue, Par_ue), labeller = label_parsed) +
  theme_bw()
Plot



Plot <- MultiCultiPigmentMaxAllExp %>%
   filter(Par_ue!=600) %>% 
  ggplot() +
  geom_point(aes(x = E_hoursExp, y = ChlapgcellExp, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  #labs(y = "Total Phyco/Chl " ~italic(a)~ "ratio", x = "Elapsed time (h)") +
  # scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  # coord_cartesian(ylim = c(0, 1.7)) +
  ggh4x::facet_nested(cols = vars(facetsPhotoperiod, Photoperiod), rows = vars(facetsPar_ue, Par_ue), labeller = label_parsed) +
  theme_bw() 
Plot


Plot <- MultiCultiPigmentMaxAllExp %>%
  filter(Par_ue!=600) %>% 
  ggplot() +
  geom_point(aes(x = E_hoursExp, y = PhycoChlaRatioExp, colour = as.factor(Strain)),  alpha = 0.8, size = 3, show.legend = T) +
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  #labs(y = "Total Phyco/Chl " ~italic(a)~ "ratio", x = "Elapsed time (h)") +
  # scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  # coord_cartesian(ylim = c(0, 1.7)) +
  ggh4x::facet_nested(cols = vars(facetsPhotoperiod, Photoperiod), rows = vars(facetsPar_ue, Par_ue), labeller = label_parsed) +
  theme_bw() 
Plot


```

Create df with only exp data for PUR, PUR/PAR ratio, pigments and cell/L
```{r}
#colnames(MultiCultiPigmentMaxAllExp)
GrowthPigmentPURonlyExp<-MultiCultiPigmentMaxAllExp %>% 
  select(-c(SpectraDate, E_days, PUR, PURPhotonDose, PURPARRatio, E_hours, meanActinic_parDay, meanOD680Day, meanOD720Day, cellml, ChlaugmL, CarugmL, PEugmL, PCugmL, APCugmL, Chlapgcell, Carpgcell, PEpgcell, OlisDate, cellL, ChlaugL, PhycougL, PCpgcell, APCpgcell, Phycopgcell, CarChlaRatio, PhycoChlaRatio, PEPCRatio)) %>% 
  unique()
  
```


rm additional df
```{r}
rm(MultiCultiGrowthAll, MultiCultiGrowth, MultiCultiGrowth121, MultiCultiDataCleanGrowthAll2, MultiCultiDataCleanGrowthAll4)
```









#Growth rate

MultiCulti Assesment
```{r}
Project <- "PicoBaltic"
DataIn <- file.path("..","GrowthAssessData", fsep = .Platform$file.sep)
FileEncode <- "UTF-8" 
Delimiter <- ","
HeaderRows <- 0
```


MultiCulti Assesment
Exported only first time in session
```{r}
list.files(path = DataIn, pattern = Project, full.names = TRUE)
```

GrowthAssessData/PICO_MultiAssesment_CCA contain WWPhotoperiod data!!! Genius - fix this Sylwia!!!!

MultiCulti Assesment
```{r read ProcessFile}
MultiCultiGrowthFile <- "../GrowthAssessData/PicoBaltic_MultiAssesment_CCA.Rds"

MultiCultiGrowthFileName <- str_split(string = MultiCultiGrowthFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 

MultiCultiGrowth <- readRDS(MultiCultiGrowthFile)  %>%
  ungroup()


MultiCultiGrowth121File <- "../GrowthAssessData/PicoBaltic_MultiAssesment_RUN121trunc.Rds"

MultiCultiGrowth121FileName <- str_split(string = MultiCultiGrowth121File, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 

MultiCultiGrowth121 <- readRDS(MultiCultiGrowth121File)  %>%
  ungroup()

#colnames(MultiCultiData)


```

clean MultiCulti data for WWPhotoperiod manuscript

Because I have a few growth data as replica I made mean to get one value of deltaOD_Lmu_corr
```{r}
MultiCultiGrowthClean <- MultiCultiGrowth %>%
  summarize(Filename, Run, ID, Strain, MC, Tube, Par_ue, Photoperiod, O2, WL, InnocDate, ExpDate, LightShape, OD720_Lmu_corr, deltaOD_Lmu_corr, OD720_LseGrowthFlag, deltaOD_LseGrowthFlag, GrowthAmpOD720Flag_14days, GrowthAmpdeltaODFlag_14days, OD720_Lmu_se, deltaOD_Lmu_se)

MultiCultiGrowthClean <- MultiCultiGrowthClean %>%
  filter(WL == "WW") %>% 
  #filter(Par_ue != 600) %>% 
  filter(O2 == 21) %>% 
  filter(Strain == "BA127R" | Strain == "BA48R" | Strain == "BA56G" | Strain == "BA77G") %>% 
  filter(Run != "61") %>% 
  filter(MC!= "MCMIX004" | MC!= "MCMIX006")
#OD720_Lmu_se, deltaOD_Lmu_se


MultiCultiGrowth121Clean <- MultiCultiGrowth121 %>%
  summarize(Filename, Run, ID, Strain, MC, Tube, Par_ue, Photoperiod, O2, WL, InnocDate, ExpDate, LightShape, OD720_Lmu_corr, deltaOD_Lmu_corr, OD720_LseGrowthFlag, deltaOD_LseGrowthFlag, GrowthAmpOD720Flag_14days, GrowthAmpdeltaODFlag_14days, OD720_Lmu_se, deltaOD_Lmu_se)

MultiCultiGrowthAll<-rbind(MultiCultiGrowthClean, MultiCultiGrowth121Clean)

MultiCultiGrowthAll<-MultiCultiGrowthAll %>% 
  group_by(Strain,Photoperiod,Par_ue) %>% 
    summarize(Filename, Run, ID, Strain, MC, Tube, Par_ue, Photoperiod, O2, WL, InnocDate, ExpDate, LightShape, OD720_Lmu_corr, deltaOD_Lmu_corr, OD720_LseGrowthFlag, deltaOD_LseGrowthFlag, GrowthAmpOD720Flag_14days, GrowthAmpdeltaODFlag_14days, OD720_Lmu_se, deltaOD_Lmu_se,
              meandeltaOD_Lmu_corr=mean(deltaOD_Lmu_corr),
              sddeltaOD_Lmu_corr=sd(deltaOD_Lmu_corr)) %>% 
  ungroup()


rm(MultiCultiGrowthClean, MultiCultiGrowth121Clean)
```

Add PAR PhotonDose and correct name of strains
```{r}

MultiCultiGrowthAll<-MultiCultiGrowthAll %>% 
  mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077"))

  MultiCultiDataCleanAll1 <- MultiCultiGrowthAll %>%
  filter(Photoperiod != "24") %>% 
  mutate(PARPhotonDose =(Par_ue/2)*Photoperiod*3600)
  
  MultiCultiDataCleanAll2 <- MultiCultiGrowthAll %>%
  filter(Photoperiod == "24") %>% 
  mutate(PARPhotonDose = Par_ue*Photoperiod*3600) 
  
  MultiCultiGrowthAll <-rbind(MultiCultiDataCleanAll1, MultiCultiDataCleanAll2)
  rm(MultiCultiDataCleanAll1, MultiCultiDataCleanAll2)
  
```


Combine growth rate and all PUR
```{r}
#colnames(OLISSpectraMetaAllPURPARRatioCleanExpPUR)

#All PUR (divided to Phase) and growth rate
MultiCultiGrowthRate <- OLISAllPURShortPhase %>% 
  left_join(., MultiCultiGrowthAll, by = c("Run" = "Run", "ID" = "ID","Strain" = "Strain", "Par_ue" = "Par_ue", "Photoperiod" = "Photoperiod",  "O2" = "O2", "WL" = "WL",  "MC" = "MC", "Tube" = "Tube", "InnocDate" =  "InnocDate", "ExpDate" = "ExpDate", "LightShape" = "LightShape", "PARPhotonDose" = "PARPhotonDose")) 


```



Combine growth rate and exp PUR
```{r}
MultiCultiDataCleanGrowthAll2<-MultiCultiGrowthRate 
  
O1 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 30 | Par_ue == 300 | Par_ue == 90 | Par_ue == 180) %>% 
  filter(Photoperiod == 24) %>% 
  filter(E_days < 4)

O2 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 180 | Par_ue == 300) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 4)

O3 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 6)

O4 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 30) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 12)

O5 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 900 | Par_ue == 600) %>% 
  filter(Photoperiod == 16) %>% 
  filter(E_days == 4)

O6 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 30) %>% 
  filter(Photoperiod == 8 | Photoperiod == 12) %>% 
  filter(E_days == 12| E_days == 13)
  
O7 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 8) %>% 
  filter(E_days == 12 | E_days ==13)

O8 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 8 | E_days ==9)

O9 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 90) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(E_days == 11)

O10 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 8) %>% 
  filter(E_days == 8 | E_days == 9)

O11 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 180) %>% 
  filter(Photoperiod == 12) %>% 
  filter(E_days == 6 | E_days == 7)

O12 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 6 | E_days ==7)

O13 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 8) %>% 
  filter(Strain == "PC-rich_056") %>% 
  filter(E_days == 9)

O14 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PE-rich_127" | Strain == "PE-rich_048" | Strain == "PC-rich_077") %>% 
  filter(E_days == 4 | E_days ==5)

O15 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 300) %>% 
  filter(Photoperiod == 12) %>% 
  filter(Strain == "PC-rich_056") %>%  
  filter(E_days == 7)

O16 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 900) %>% 
  filter(Photoperiod == 8 | Photoperiod == 12)

O17 <- MultiCultiDataCleanGrowthAll2 %>%
  filter(Par_ue == 900 | Par_ue == 600) %>% 
  filter(Photoperiod == 24) %>% 
  filter(E_hours < 100 & E_hours > 48)

MultiCultiDataCleanGrowthAll3 <-rbind(O1, O2, O3, O4, O5, O6, O7, O8, O9, O10, O11, O12, O13, O14, O15, O16, O17)

rm(O1, O2, O3, O4, O5, O6, O7, O8, O9, O10, O11, O12, O13, O14, O15, O16, O17)

  
```

Because I have replica in growt rate - I combine one choosen PUR exp to all growth rate data
```{r}
#colnames(MultiCultiDataCleanGrowthAll4)
MultiCultiDataCleanGrowthAll4<-MultiCultiDataCleanGrowthAll3 %>% 
  mutate(PURExp = PUR) %>% 
  mutate(PURPhotonDoseExp = PURPhotonDose) %>% 
  mutate(PURPARRatioExp = PURPARRatio) %>% 
  mutate(E_hoursExp = E_hours) %>% 
  mutate(E_daysExp = E_days) %>% 
  select(c(Strain, Par_ue, Photoperiod, PURExp, PURPhotonDoseExp, PURPARRatioExp, E_hoursExp, E_daysExp))
  
MultiCultiGrowthRatePURExp <- MultiCultiGrowthRate %>%
  full_join(., MultiCultiDataCleanGrowthAll4, by = c("Strain"="Strain", "Par_ue"="Par_ue","Photoperiod"="Photoperiod"))


```



PUR/PAR ratio - all data and only exp
```{r fig.height = 8, fig.width = 8}


lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))

Plot <- MultiCultiGrowthRatePURExp %>%
  filter(Par_ue!=600) %>% 
  ggplot() +
  # geom_smooth(aes(x = Time_h, y = PURPARRatio, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
  geom_point(aes(x = E_hoursExp, y = PURPARRatioExp, colour = as.factor(Strain)), alpha = 0.9, size = 3, show.legend = T) +
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  labs(y = "PUR/PAR ratio", x = "Elapsed time (h)") +
  # geom_errorbar(aes(x = Photoperiod, ymin = OD720_Lmu_corr - OD720_Lmu_se, ymax = OD720_Lmu_corr + OD720_Lmu_se), size = 0.3, width=3, color = '#3C3B53', data = . %>% filter(GrowthAmpOD720Flag_14days  == 1)) +
  scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  coord_cartesian(ylim = c(0, 1.7)) +
  ggh4x::facet_nested(cols = vars(facetsPhotoperiod, Photoperiod), rows = vars(facetsPar_ue, Par_ue), labeller = label_parsed) +
  theme_bw() 
Plot





lab1=c(expression("PC-rich_056"), expression("PC-rich_077"), expression("PE-rich_048"), expression("PE-rich_127"))

Plot <- MultiCultiGrowthRatePURExp %>%
  filter(Par_ue!=600) %>% 
  filter(PURPARRatio>0.05) %>% 
  ggplot() +
  # geom_smooth(aes(x = Time_h, y = PURPARRatio, colour = as.factor(Strain)),  alpha = 0, size = 0.2, linetype = "solid", show.legend = T) +
  geom_point(aes(x = E_hours, y = PURPARRatio, colour = as.factor(Strain)), alpha = 0.9, size = 3, show.legend = T) +
  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +
  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="", labels = lab1) +
  labs(y = "PUR/PAR ratio", x = "Elapsed time (h)") +
  # geom_errorbar(aes(x = Photoperiod, ymin = OD720_Lmu_corr - OD720_Lmu_se, ymax = OD720_Lmu_corr + OD720_Lmu_se), size = 0.3, width=3, color = '#3C3B53', data = . %>% filter(GrowthAmpOD720Flag_14days  == 1)) +
  scale_y_continuous(breaks=seq(0, 1.2, by = 0.4)) +
  coord_cartesian(ylim = c(0, 1.7)) +
  ggh4x::facet_nested(cols = vars(facetsPhotoperiod, Photoperiod), rows = vars(facetsPar_ue, Par_ue), labeller = label_parsed) +
  # ggh4x::facet_nested(cols = vars(facets2, Photoperiod), rows = vars(facets, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() 
Plot


```


```{r fig.height = 5.5, fig.width = 8, warning = FALSE}

lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))


O2.labs <- c("Strain")
names(O2.labs) <- c(21)
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

Plot <- MultiCultiGrowthRatePURExp %>%
  filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
  # filter(OD720_Lmu_corr == 0 | OD720_Lmu_corr != 0 & OD720_LseGrowthFlag == 1) %>%
  ggplot() +
  geom_point(aes(x = PARPhotonDose, y = deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.9, show.legend = T) +
labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "PAR photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  # labs(shape="Photoperiod (h)", colour="Strain") +
   geom_errorbar(aes(x = PARPhotonDose, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5, width=2000000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +
  #geom_text(data=data_textA, aes(x=78000000, y=0.25, label=label), size=5) +
  scale_x_continuous(breaks=seq(0, 80000000, by = 20000000)) +
  coord_cartesian(xlim = c(-100, 83000000)) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1", "yellow"), name="", labels = lab2) +
  ggh4x::facet_nested(rows = vars(O2, Strain), labeller = labeller(O2 = O2.labs)) +
  scale_x_continuous(label=scientific_10) +
  guides(color = guide_legend(order = 1), shape = guide_legend(order = 2)) +
  theme_bw() 
Plot



Plot <- MultiCultiGrowthRate %>%
  filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
  # filter(OD720_Lmu_corr == 0 | OD720_Lmu_corr != 0 & OD720_LseGrowthFlag == 1) %>%
  ggplot() +
  geom_point(aes(x = PURPhotonDose, y = deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.9, show.legend = T) +
labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "PUR photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  # labs(shape="Photoperiod (h)", colour="Strain") +
   geom_errorbar(aes(x = PURPhotonDose, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5, width=2000000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +
  scale_x_continuous(breaks=seq(0, 80000000, by = 20000000)) +
  coord_cartesian(xlim = c(-100, 83000000)) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1", "yellow"), name="", labels = lab2) +
  ggh4x::facet_nested(rows = vars(O2, Strain), labeller = labeller(O2 = O2.labs)) +
  scale_x_continuous(label=scientific_10) +
  guides(color = guide_legend(order = 1), shape = guide_legend(order = 2)) +
  theme_bw() 
Plot

Plot <- MultiCultiGrowthRatePURExp %>%
  filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
  # filter(OD720_Lmu_corr == 0 | OD720_Lmu_corr != 0 & OD720_LseGrowthFlag == 1) %>%
  ggplot() +
  geom_point(aes(x = PURPhotonDoseExp, y = deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.9, show.legend = T) +
labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "PUR photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  # labs(shape="Photoperiod (h)", colour="Strain") +
   geom_errorbar(aes(x = PURPhotonDoseExp, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5, width=2000000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +
  scale_x_continuous(breaks=seq(0, 80000000, by = 20000000)) +
  coord_cartesian(xlim = c(-100, 83000000)) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1", "yellow"), name="", labels = lab2) +
  ggh4x::facet_nested(rows = vars(O2, Strain), labeller = labeller(O2 = O2.labs)) +
  scale_x_continuous(label=scientific_10) +
  guides(color = guide_legend(order = 1), shape = guide_legend(order = 2)) +
  theme_bw()
Plot

Plot <- MultiCultiGrowthRatePURExp %>%
  #filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
  # filter(OD720_Lmu_corr == 0 | OD720_Lmu_corr != 0 & OD720_LseGrowthFlag == 1) %>%
  ggplot() +
  geom_point(aes(x = PURPhotonDoseExp, y = meandeltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.9, show.legend = T) +
labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "PUR photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  # labs(shape="Photoperiod (h)", colour="Strain") +
   geom_errorbar(aes(x = PURPhotonDoseExp, ymin = meandeltaOD_Lmu_corr - sddeltaOD_Lmu_corr, ymax = meandeltaOD_Lmu_corr + sddeltaOD_Lmu_corr), alpha = 0.5, width=2000000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +
  scale_x_continuous(breaks=seq(0, 80000000, by = 20000000)) +
  coord_cartesian(xlim = c(-100, 83000000)) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1", "yellow"), name="", labels = lab2) +
  ggh4x::facet_nested(rows = vars(O2, Strain), labeller = labeller(O2 = O2.labs)) +
  scale_x_continuous(label=scientific_10) +
  guides(color = guide_legend(order = 1), shape = guide_legend(order = 2)) +
  theme_bw()
Plot



```



Added column PhotonDose_value and combine data to to PAR and PUR - long format (MultiCultiGrowthRatePURExpFit)
```{r}
MultiCultiGrowthRatePURExpFitPAR<-MultiCultiGrowthRatePURExp %>% 
  select(-c(PURPhotonDose)) %>% 
  mutate(PhotonDose_value = PARPhotonDose) %>% 
  mutate(PhotonDose = O2) %>% 
  mutate(PhotonDose = case_when(PhotonDose==21~"PAR")) %>% 
  select(-c(PARPhotonDose, PURPhotonDoseExp))
  
MultiCultiGrowthRatePURExpFitPUR<-MultiCultiGrowthRatePURExp %>% 
  select(-c(PARPhotonDose)) %>% 
  mutate(PhotonDose_value = PURPhotonDoseExp) %>% 
  mutate(PhotonDose = O2) %>% 
  mutate(PhotonDose = case_when(PhotonDose==21~"PUR")) %>% 
  select(-c(PURPhotonDose, PURPhotonDoseExp))

MultiCultiGrowthRatePURExpFit<-rbind(MultiCultiGrowthRatePURExpFitPAR, MultiCultiGrowthRatePURExpFitPUR)
rm(MultiCultiGrowthRatePURExpFitPAR, MultiCultiGrowthRatePURExpFitPUR)

```


```{r fig.height = 8, fig.width = 8, warning = FALSE}

lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))


O2.labs <- c("Strain")
names(O2.labs) <- c(21)
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }

Plot <- MultiCultiGrowthRatePURExpFit %>%
  filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
  # filter(OD720_Lmu_corr == 0 | OD720_Lmu_corr != 0 & OD720_LseGrowthFlag == 1) %>%
  ggplot() +
  geom_point(aes(x = PhotonDose_value, y = deltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.9, show.legend = T) +
labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
   # geom_errorbar(aes(x = PARPhotonDose, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5, width=2000000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +
  scale_x_continuous(breaks=seq(0, 80000000, by = 20000000)) +
  coord_cartesian(xlim = c(-100, 83000000)) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1", "yellow"), name="", labels = lab2) +
  ggh4x::facet_nested(rows = vars(O2, Strain), cols = vars(PhotonDose), labeller = labeller(O2 = O2.labs)) +
    # ggh4x::facet_nested(cols = vars(Strain), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs, Strain = Strain.labs)) +
  scale_x_continuous(label=scientific_10) +
  guides(color = guide_legend(order = 1), shape = guide_legend(order = 2)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=12, angle = 45, vjust = 1, hjust = 1),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.91,0.88),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=9))
Plot


Plot <- MultiCultiGrowthRatePURExpFit %>%
  #filter(deltaOD_Lmu_corr == 0 | deltaOD_Lmu_corr != 0 & deltaOD_LseGrowthFlag == 1) %>%
  # filter(OD720_Lmu_corr == 0 | OD720_Lmu_corr != 0 & OD720_LseGrowthFlag == 1) %>%
  ggplot() +
  geom_point(aes(x = PhotonDose_value, y = meandeltaOD_Lmu_corr, colour = as.factor(Par_ue), shape = as.factor(Photoperiod)), size = 3.5, alpha = 0.9, show.legend = T) +
labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
   # geom_errorbar(aes(x = PARPhotonDose, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se), alpha = 0.5, width=2000000, data = . %>% filter(GrowthAmpdeltaODFlag_14days  == 1)) +
  scale_x_continuous(breaks=seq(0, 80000000, by = 20000000)) +
  coord_cartesian(xlim = c(-100, 83000000)) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  scale_colour_manual(values = c("darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1", "yellow"), name="", labels = lab2) +
  ggh4x::facet_nested(rows = vars(O2, Strain), cols = vars(PhotonDose), labeller = labeller(O2 = O2.labs)) +
    # ggh4x::facet_nested(cols = vars(Strain), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs, Strain = Strain.labs)) +
  scale_x_continuous(label=scientific_10) +
  guides(color = guide_legend(order = 1), shape = guide_legend(order = 2)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=12, angle = 45, vjust = 1, hjust = 1),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.91,0.88),
        legend.key.height= unit(0.003, 'cm'),
        legend.spacing.y = unit(-0.1, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=9))
Plot

```

FIT curve

```{r test inhibition plot}

#Harrison & Platt, 1986
grcplatt <- function(I, a, b, Pmax){Pmax * (1-exp(-a*I/Pmax)) * exp(-b*I/Pmax)}

```



Harrison & Platt, 1986 
```{r platt fit}

CleanGrowthPARPURfit <- MultiCultiGrowthRatePURExpFit |>   
  filter(Par_ue !=900 & Par_ue !=600) |> 
  #filter(PhotonDose == "PAR") |>
  nest(data = -c("Strain", "PhotonDose")) |> 
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = PhotonDose_value, a, b, Pmax),
                                                    data = .x,
                                                    start = list(a = 0.1/2e7, b = 0.01/2e7, Pmax = 0.2),
                                                    lower = c(0, 0, 0)))
                                                    #upper = c(1,1,100)), 
                                                    #0))
         ) |>   
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance))
         )

GRCplatt_PredictGrowth <- CleanGrowthPARPURfit |>
  unnest(GRCplatt_Predict)

```


Harrison & Platt, 1986 
```{r platt fit}


CleanGrowthPARPURfit900 <- MultiCultiGrowthRatePURExpFit |>   
  filter(Par_ue !=30 & Par_ue !=90 & Par_ue !=180 & Par_ue !=300) |> 
  # filter(Par_ue == 900) |>
  #filter(PhotonDose == "PAR") |>
  nest(data = -c("Strain", "PhotonDose")) |> 
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = PhotonDose_value, a, b, Pmax),
                                                    data = .x,
                                                    start = list(a = 0.1/2e7, b = 0.01/2e7, Pmax = 0.2),
                                                    lower = c(0, 0, 0)))
                                                    #upper = c(1,1,100)), 
                                                    #0))
         ) |>   
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance))
         )

GRCplatt_PredictGrowth900 <- CleanGrowthPARPURfit900 |>
  unnest(GRCplatt_Predict)

```


add columns to get nice facet
```{r}

GRCplatt_PredictGrowth$facetsStrain = factor(GRCplatt_PredictGrowth$PhotonDose, labels = c("Strain", "Strain"))

GRCplatt_PredictGrowth900$facetsStrain = factor(GRCplatt_PredictGrowth900$PhotonDose, labels = c("Strain", "Strain"))

```


```{r}
# CleanGrowthPARPURfitbez900 <- CleanGrowthPARPUR %>%    
#   filter(Par_ue !=900) 
# 
# CleanGrowthPARPURfittylko900 <- CleanGrowthPARPUR %>%    
#   filter(Par_ue ==900) %>% 
#   filter(deltaOD_Lmu_se<8.057558e-03)
```



```{r fig.height = 8, fig.width = 8, warning = FALSE}

# O2.labs <- c("Strain")
# names(O2.labs) <- c(21)

lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("1 µE"), expression("2 µE"), expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("600 µE"), expression("900 µE"))
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }


ggplot(MultiCultiGrowthRatePURExpFit, aes(PhotonDose_value, meandeltaOD_Lmu_corr)) +
  geom_point(aes(PhotonDose_value, meandeltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
# 
#   geom_errorbar(aes(x = PhotonDose_value, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se, colour = as.factor(Par_ue)), width=4000000, data = . %>% filter(deltaOD_Lmu_se<8.057558e-03), show.legend = F) +
  geom_line(aes(PhotonDose_value, .fitted), show.legend = F, GRCplatt_PredictGrowth) +
  geom_line(aes(PhotonDose_value, .fitted), show.legend = F, GRCplatt_PredictGrowth900) +
  scale_y_continuous(breaks=seq(0, 0.25, by = 0.1)) +
  coord_cartesian(ylim = c(0, 0.25)) +
  scale_x_continuous(label=scientific_10) +
  scale_linetype_manual(values=c("equal900" = "dotted", "less900" = "solid"), breaks=c('8', '12', '16', "24", "", "")) +
  scale_colour_manual(values = c("", "", "darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1", "yellow"), name="", labels = lab2, breaks=c('', '', '30', "90", "180", "300", "600", "900")) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #geom_hline(aes(yintercept = 0), linetype = 2) +
    ggh4x::facet_nested(cols = vars(PhotonDose), rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  #ggh4x::facet_nested(rows = vars(O2, Strain), cols = vars(PhotonDose), labeller = labeller(O2 = O2.labs)) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() 

```


Fit for every Par_ue

Harrison & Platt, 1986 
```{r platt fit}

#Harrison & Platt, 1986
grcplatt <- function(I, a, b, Pmax){Pmax * (1-exp(-a*I/Pmax)) * exp(-b*I/Pmax)}

MultiCultiGrowthRatePURExpFitok<-MultiCultiGrowthRatePURExpFit %>% 
  #filter(deltaOD_Lmu_corr<0.21) %>% 
  filter(Par_ue !=600)

MultiCultiGrowthRatePURExpFit30 <- MultiCultiGrowthRatePURExpFitok |>   
  filter(Par_ue ==30) |> 
  #filter(PhotonDose == "PAR") |>
  nest(data = -c("Strain", "PhotonDose")) |> 
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = PhotonDose_value, a, b, Pmax),
                                                    data = .x,
                                                    start = list(a = 0.1/2e7, b = 0.01/2e7, Pmax = 0.2),
                                                    lower = c(0, 0, 0)))
                                                    #upper = c(1,1,100)), 
                                                    #0))
         ) |>   
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance))
         )

GRCplatt_PredictGrowth30 <- MultiCultiGrowthRatePURExpFit30 |>
  unnest(GRCplatt_Predict)




MultiCultiGrowthRatePURExpFit90 <- MultiCultiGrowthRatePURExpFitok |>   
  filter(Par_ue ==90) |> 
  #filter(PhotonDose == "PAR") |>
  nest(data = -c("Strain", "PhotonDose")) |> 
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = PhotonDose_value, a, b, Pmax),
                                                    data = .x,
                                                    start = list(a = 0.1/2e7, b = 0.01/2e7, Pmax = 0.2),
                                                    lower = c(0, 0, 0)))
                                                    #upper = c(1,1,100)), 
                                                    #0))
         ) |>   
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance))
         )

GRCplatt_PredictGrowth90 <- MultiCultiGrowthRatePURExpFit90 |>
  unnest(GRCplatt_Predict)


MultiCultiGrowthRatePURExpFit180 <- MultiCultiGrowthRatePURExpFitok |>   
  filter(Par_ue ==180) |> 
  #filter(PhotonDose == "PAR") |>
  nest(data = -c("Strain", "PhotonDose")) |> 
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = PhotonDose_value, a, b, Pmax),
                                                    data = .x,
                                                    start = list(a = 0.1/2e7, b = 0.01/2e7, Pmax = 0.2),
                                                    lower = c(0, 0, 0)))
                                                    #upper = c(1,1,100)), 
                                                    #0))
         ) |>   
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance))
         )

GRCplatt_PredictGrowth180 <- MultiCultiGrowthRatePURExpFit180 |>
  unnest(GRCplatt_Predict)



MultiCultiGrowthRatePURExpFit300 <- MultiCultiGrowthRatePURExpFitok |>   
  filter(Par_ue ==300) |> 
  #filter(PhotonDose == "PAR") |>
  nest(data = -c("Strain", "PhotonDose")) |> 
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = PhotonDose_value, a, b, Pmax),
                                                    data = .x,
                                                    start = list(a = 0.1/2e7, b = 0.01/2e7, Pmax = 0.2),
                                                    lower = c(0, 0, 0)))
                                                    #upper = c(1,1,100)), 
                                                    #0))
         ) |>   
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance))
         )

GRCplatt_PredictGrowth300 <- MultiCultiGrowthRatePURExpFit300 |>
  unnest(GRCplatt_Predict)


MultiCultiGrowthRatePURExpFit900 <- MultiCultiGrowthRatePURExpFitok |>   
  filter(Par_ue ==900) |> 
  #filter(PhotonDose == "PAR") |>
  nest(data = -c("Strain", "PhotonDose")) |> 
  mutate(GRCplatt_Model = map(data, ~nlsLM(deltaOD_Lmu_corr ~ grcplatt(I = PhotonDose_value, a, b, Pmax),
                                                    data = .x,
                                                    start = list(a = 0.1/2e7, b = 0.01/2e7, Pmax = 0.2),
                                                    lower = c(0, 0, 0)))
                                                    #upper = c(1,1,100)), 
                                                    #0))
         ) |>   
  mutate(GRCplatt_Param = map(GRCplatt_Model, tidy),          
         GRCplatt_Predict = map(GRCplatt_Model, possibly(augment)),          
         GRCplatt_Glance = map(GRCplatt_Model, possibly(glance))
         )

GRCplatt_PredictGrowth900 <- MultiCultiGrowthRatePURExpFit900 |>
  unnest(GRCplatt_Predict)


```


add columns to get nice facet
```{r}

GRCplatt_PredictGrowth30$facetsStrain = factor(GRCplatt_PredictGrowth30$PhotonDose, labels = c("Strain", "Strain"))
GRCplatt_PredictGrowth90$facetsStrain = factor(GRCplatt_PredictGrowth90$PhotonDose, labels = c("Strain", "Strain"))
GRCplatt_PredictGrowth180$facetsStrain = factor(GRCplatt_PredictGrowth180$PhotonDose, labels = c("Strain", "Strain"))
GRCplatt_PredictGrowth300$facetsStrain = factor(GRCplatt_PredictGrowth300$PhotonDose, labels = c("Strain", "Strain"))
GRCplatt_PredictGrowth900$facetsStrain = factor(GRCplatt_PredictGrowth900$PhotonDose, labels = c("Strain", "Strain"))
```


Nice plot
```{r fig.height = 8, fig.width = 8, warning = FALSE}

# O2.labs <- c("Strain")
# names(O2.labs) <- c(21)

lab1=c(expression("8 h"), expression("12 h"), expression("16 h"), expression("24 h"))
lab2=c(expression("1 µE"), expression("2 µE"), expression("30 µE"), expression("90 µE"), expression("180 µE"), expression("300 µE"), expression("900 µE"))
scientific_10 <- function(x) {   parse(text=gsub("e\\+*", " %*% 10^", scales::scientific_format()(x))) }


ggplot(MultiCultiGrowthRatePURExpFitok, aes(PhotonDose_value, deltaOD_Lmu_corr)) +
  geom_point(aes(PhotonDose_value, deltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
# 
#   geom_errorbar(aes(x = PhotonDose_value, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se, colour = as.factor(Par_ue)), width=4000000, data = . %>% filter(deltaOD_Lmu_se<8.057558e-03), show.legend = F) +
  geom_line(aes(PhotonDose_value, .fitted), colour = "darkslategray", show.legend = F, GRCplatt_PredictGrowth30) +
  geom_line(aes(PhotonDose_value, .fitted), colour = "lightblue4", show.legend = F, GRCplatt_PredictGrowth90) +
  geom_line(aes(PhotonDose_value, .fitted), colour = "hotpink4", show.legend = F, GRCplatt_PredictGrowth180) +
  geom_line(aes(PhotonDose_value, .fitted), colour = "indianred3", show.legend = F, GRCplatt_PredictGrowth300) +
  geom_line(aes(PhotonDose_value, .fitted), colour = "orange1", show.legend = F, GRCplatt_PredictGrowth900) +
  scale_y_continuous(breaks=seq(0, 0.25, by = 0.1)) +
  coord_cartesian(ylim = c(0, 0.25)) +
  scale_x_continuous(label=scientific_10) +
  scale_linetype_manual(values=c("equal900" = "dotted", "less900" = "solid"), breaks=c('8', '12', '16', "24", "", "")) +
  scale_colour_manual(values = c("", "", "darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2, breaks=c('', '', '30', "90", "180", "300", "900")) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #geom_hline(aes(yintercept = 0), linetype = 2) +
    ggh4x::facet_nested(cols = vars(PhotonDose), rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  #ggh4x::facet_nested(rows = vars(O2, Strain), cols = vars(PhotonDose), labeller = labeller(O2 = O2.labs)) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=12, angle = 45, vjust = 1, hjust = 1),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.92,0.88),
        #legend.position = c(0.06,0.85),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.15, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))



ggplot(MultiCultiGrowthRatePURExpFitok, aes(PhotonDose_value, meandeltaOD_Lmu_corr)) +
  geom_point(aes(PhotonDose_value, meandeltaOD_Lmu_corr, colour=as.factor(Par_ue), shape = as.factor(Photoperiod)), alpha = 0.9, size = 3.5, show.legend = T) +
# 
#   geom_errorbar(aes(x = PhotonDose_value, ymin = deltaOD_Lmu_corr - deltaOD_Lmu_se, ymax = deltaOD_Lmu_corr + deltaOD_Lmu_se, colour = as.factor(Par_ue)), width=4000000, data = . %>% filter(deltaOD_Lmu_se<8.057558e-03), show.legend = F) +
  geom_line(aes(PhotonDose_value, .fitted), colour = "darkslategray", show.legend = F, GRCplatt_PredictGrowth30) +
  geom_line(aes(PhotonDose_value, .fitted), colour = "lightblue4", show.legend = F, GRCplatt_PredictGrowth90) +
  geom_line(aes(PhotonDose_value, .fitted), colour = "hotpink4", show.legend = F, GRCplatt_PredictGrowth180) +
  geom_line(aes(PhotonDose_value, .fitted), colour = "indianred3", show.legend = F, GRCplatt_PredictGrowth300) +
  geom_line(aes(PhotonDose_value, .fitted), colour = "orange1", show.legend = F, GRCplatt_PredictGrowth900) +
  scale_y_continuous(breaks=seq(0, 0.25, by = 0.1)) +
  coord_cartesian(ylim = c(0, 0.25)) +
  scale_x_continuous(label=scientific_10) +
  scale_linetype_manual(values=c("equal900" = "dotted", "less900" = "solid"), breaks=c('8', '12', '16', "24", "", "")) +
  scale_colour_manual(values = c("", "", "darkslategray", "lightblue4", "hotpink4", "indianred3", "orange1"), name="", labels = lab2, breaks=c('', '', '30', "90", "180", "300", "900")) +
  #scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4")) +
  scale_shape_manual(values = c(15, 16, 17, 18), name="", labels = lab1) +
  labs(y = "Logistic growth rate " ~ "("~h^-1~")", x = "Photon dose ( µmol photons "~m^-2~""~d^-1~")") +
  #geom_hline(aes(yintercept = 0), linetype = 2) +
    ggh4x::facet_nested(cols = vars(PhotonDose), rows = vars(facetsStrain, Strain), labeller = label_parsed) +
  #ggh4x::facet_nested(rows = vars(O2, Strain), cols = vars(PhotonDose), labeller = labeller(O2 = O2.labs)) +
  # ggh4x::facet_nested(rows = vars(Par_ue), cols = vars(Photoperiod), labeller = labeller(Photoperiod = Photoperiod.labs,  Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.text.x = element_text(size=12, angle = 45, vjust = 1, hjust = 1),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.92,0.88),
        #legend.position = c(0.06,0.85),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.y = unit(-0.15, "cm"),
        # legend.spacing.x = unit(0.01, 'cm'),
        # legend.direction = "vertical", legend.box = "vertical",
        legend.title = element_blank(),
        legend.text = element_text(size=10))

```

```{r}
rm(MultiCultiGrowthRatePURExpFit30, MultiCultiGrowthRatePURExpFit90, MultiCultiGrowthRatePURExpFit180, MultiCultiGrowthRatePURExpFit300, MultiCultiGrowthRatePURExpFit900)
```

















GROWTH CURVE



# Comparison Multiculti Import data

# Add MultiCulti Data
MultiCulti Import
```{r}
Project <- "PICO"
DataIn <- file.path("..", "ImportedData", "MultiCultiImportSySl", fsep = .Platform$file.sep)
FileEncode <- "UTF-8" 
Delimiter <- ","
HeaderRows <- 0
```

MultiCulti Import
Exported only first time in session
```{r}
list.files(path = DataIn, pattern = Project, full.names = TRUE)
```

MultiCulti Import run39
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20211214_PICO_MC247_RUN39_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData39 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean39 <- MultiCultiData39 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall39 <- MultiCultiDataMean39 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA127R, BA48R
MultiCultiDataMeanSmall39BA127R <- MultiCultiDataMeanSmall39 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall39BA48R <- MultiCultiDataMeanSmall39 %>%
  filter(Strain == "BA48R") 

```

MultiCulti Import run40
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20211223_PICO_MC257_RUN40_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData40 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean40 <- MultiCultiData40 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall40 <- MultiCultiDataMean40 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA127R, BA48R
MultiCultiDataMeanSmall40BA127R <- MultiCultiDataMeanSmall40 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall40BA48R <- MultiCultiDataMeanSmall40 %>%
  filter(Strain == "BA48R") 

```

MultiCulti Import run43
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20211229_PICO_MC247_RUN43_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData43 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean43 <- MultiCultiData43 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall43 <- MultiCultiDataMean43 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA127R, BA48R
MultiCultiDataMeanSmall43BA127R <- MultiCultiDataMeanSmall43 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall43BA48R <- MultiCultiDataMeanSmall43 %>%
  filter(Strain == "BA48R") 

```

MultiCulti Import run44
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220107_PICO_MC257_RUN44_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData44 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean44 <- MultiCultiData44 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall44 <- MultiCultiDataMean44 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA56G, BA77G
MultiCultiDataMeanSmall44BA56G <- MultiCultiDataMeanSmall44 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall44BA77G <- MultiCultiDataMeanSmall44 %>%
  filter(Strain == "BA77G")

```

MultiCulti Import run45
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220113_PICO_MC247_RUN45_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData45 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean45 <- MultiCultiData45 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall45 <- MultiCultiDataMean45 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA56G, BA77G
MultiCultiDataMeanSmall45BA56G <- MultiCultiDataMeanSmall45 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall45BA77G <- MultiCultiDataMeanSmall45 %>%
  filter(Strain == "BA77G")

```

MultiCulti Import run46
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220122_PICO_MC257_RUN46_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData46 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean46 <- MultiCultiData46 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall46 <- MultiCultiDataMean46 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#BA56G, BA77G
MultiCultiDataMeanSmall46BA56G <- MultiCultiDataMeanSmall46 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall46BA77G <- MultiCultiDataMeanSmall46 %>%
  filter(Strain == "BA77G")

```


MultiCulti Import run60
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220405_PICO_MC247_RUN60_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData60 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean60 <- MultiCultiData60 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall60 <- MultiCultiDataMean60 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#900uE, 8strains
MultiCultiDataMeanSmall60BA127R <- MultiCultiDataMeanSmall60 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall60BA48R <- MultiCultiDataMeanSmall60 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall60BA56G <- MultiCultiDataMeanSmall60 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall60BA77G <- MultiCultiDataMeanSmall60 %>%
  filter(Strain == "BA77G")

```

MultiCulti Import run62
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220410_PICO_MC257_RUN62_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData62 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean62 <- MultiCultiData62 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall62 <- MultiCultiDataMean62 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#900uE, 8strains
MultiCultiDataMeanSmall62BA127R <- MultiCultiDataMeanSmall62 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall62BA48R <- MultiCultiDataMeanSmall62 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall62BA56G <- MultiCultiDataMeanSmall62 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall62BA77G <- MultiCultiDataMeanSmall62 %>%
  filter(Strain == "BA77G") 

```

MultiCulti Import run65
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220420_PICO_MC257_RUN65_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData65 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean65 <- MultiCultiData65 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall65 <- MultiCultiDataMean65 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#900uE, 8strains
MultiCultiDataMeanSmall65BA127R <- MultiCultiDataMeanSmall65 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall65BA48R <- MultiCultiDataMeanSmall65 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall65BA56G <- MultiCultiDataMeanSmall65 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall65BA77G <- MultiCultiDataMeanSmall65 %>%
  filter(Strain == "BA77G") 

```


MultiCulti Import run71
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220507_PICO_MC257_RUN71_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData71 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean71 <- MultiCultiData71 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall71 <- MultiCultiDataMean71 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#30UE, 300uE, 4 strains
MultiCultiDataMeanSmall71BA127R <- MultiCultiDataMeanSmall71 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall71BA48R <- MultiCultiDataMeanSmall71 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall71BA56G <- MultiCultiDataMeanSmall71 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall71BA77G <- MultiCultiDataMeanSmall71 %>%
  filter(Strain == "BA77G") 

```

MultiCulti Import run74
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220607_PICO_MC257_RUN74_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData74 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean74 <- MultiCultiData74 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall74 <- MultiCultiDataMean74 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#90UE, 180uE, 4 strains
MultiCultiDataMeanSmall74BA127R <- MultiCultiDataMeanSmall74 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall74BA48R <- MultiCultiDataMeanSmall74 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall74BA56G <- MultiCultiDataMeanSmall74 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall74BA77G <- MultiCultiDataMeanSmall74 %>%
  filter(Strain == "BA77G") 

```

MultiCulti Import run77
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220615_PICO_MC257_RUN77_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData77 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean77 <- MultiCultiData77 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall77 <- MultiCultiDataMean77 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#600UE, 900uE, 4 strains
MultiCultiDataMeanSmall77BA127R <- MultiCultiDataMeanSmall77 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall77BA48R <- MultiCultiDataMeanSmall77 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall77BA56G <- MultiCultiDataMeanSmall77 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall77BA77G <- MultiCultiDataMeanSmall77 %>%
  filter(Strain == "BA77G") 

```
MultiCulti Import run50
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20220206_PICO_MC257_RUN50_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData50 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean50 <- MultiCultiData50 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall50 <- MultiCultiDataMean50 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

#600uE, 4strains
MultiCultiDataMeanSmall50BA127R <- MultiCultiDataMeanSmall50 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall50BA48R <- MultiCultiDataMeanSmall50 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall50BA56G <- MultiCultiDataMeanSmall50 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall50BA77G <- MultiCultiDataMeanSmall50 %>%
  filter(Strain == "BA77G")

```


MultiCulti Import run121
```{r warning = FALSE}
MultiCultiFile <- "../ImportedData/MultiCultiImportSySl/20230816_PICO_MC257_RUN121_TargetDataMetaFilter.Rds"
MultiCultiFileName <- str_split(string = MultiCultiFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds") 
MultiCultiData <- readRDS(MultiCultiFile)  %>%
  ungroup()

MultiCultiData121 <- MultiCultiData %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate) %>% 
mutate(Actinic_par = Actinic_par/1000) %>% 
mutate(timeRound = round(time, 0))

MultiCultiDataMean121 <- MultiCultiData121 %>% 
group_by(ID, timeRound) %>% 
summarize(time, Filename, CDateTime, Tube, abs_time, ToD, Day, ExpDate, Actinic_par, OD680, OD720, Run, ID, Strain, InnocDate, ExpDate, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, timeRound, meanActinic_par = mean(Actinic_par), meanOD680 = mean(OD680), meanOD720 = mean(OD720)) %>%
ungroup()

MultiCultiDataMeanSmall121 <- MultiCultiDataMean121 %>%
  select(-c(time, abs_time, ToD, Actinic_par, OD680, OD720, CDateTime, InnocDate)) %>% 
  unique()

# 600 and 900uE, 8strains
MultiCultiDataMeanSmall121BA127R <- MultiCultiDataMeanSmall121 %>%
  filter(Strain == "BA127R") 

MultiCultiDataMeanSmall121BA48R <- MultiCultiDataMeanSmall121 %>%
  filter(Strain == "BA48R") 

MultiCultiDataMeanSmall121BA56G <- MultiCultiDataMeanSmall121 %>%
  filter(Strain == "BA56G") 

MultiCultiDataMeanSmall121BA77G <- MultiCultiDataMeanSmall121 %>%
  filter(Strain == "BA77G")

```








```{r}

MultiCultiDataAllBA127R <- rbind(MultiCultiDataMeanSmall39BA127R, MultiCultiDataMeanSmall40BA127R, MultiCultiDataMeanSmall43BA127R, MultiCultiDataMeanSmall60BA127R, MultiCultiDataMeanSmall62BA127R, MultiCultiDataMeanSmall65BA127R, MultiCultiDataMeanSmall71BA127R, MultiCultiDataMeanSmall74BA127R, MultiCultiDataMeanSmall77BA127R, MultiCultiDataMeanSmall50BA127R, MultiCultiDataMeanSmall121BA127R)


MultiCultiDataAllBA48R <- rbind(MultiCultiDataMeanSmall39BA48R, MultiCultiDataMeanSmall40BA48R, MultiCultiDataMeanSmall43BA48R, MultiCultiDataMeanSmall60BA48R, MultiCultiDataMeanSmall62BA48R, MultiCultiDataMeanSmall65BA48R, MultiCultiDataMeanSmall71BA48R, MultiCultiDataMeanSmall74BA48R, MultiCultiDataMeanSmall77BA48R, MultiCultiDataMeanSmall50BA48R, MultiCultiDataMeanSmall121BA48R)


MultiCultiDataAllBA56G <- rbind(MultiCultiDataMeanSmall44BA56G, MultiCultiDataMeanSmall45BA56G, MultiCultiDataMeanSmall46BA56G, MultiCultiDataMeanSmall60BA56G, MultiCultiDataMeanSmall62BA56G, MultiCultiDataMeanSmall65BA56G, MultiCultiDataMeanSmall71BA56G, MultiCultiDataMeanSmall74BA56G, MultiCultiDataMeanSmall77BA56G, MultiCultiDataMeanSmall50BA56G, MultiCultiDataMeanSmall121BA56G)


MultiCultiDataAllBA77G <- rbind(MultiCultiDataMeanSmall44BA77G, MultiCultiDataMeanSmall45BA77G, MultiCultiDataMeanSmall46BA77G, MultiCultiDataMeanSmall60BA77G, MultiCultiDataMeanSmall62BA77G, MultiCultiDataMeanSmall65BA77G, MultiCultiDataMeanSmall71BA77G, MultiCultiDataMeanSmall74BA77G, MultiCultiDataMeanSmall77BA77G, MultiCultiDataMeanSmall50BA77G, MultiCultiDataMeanSmall121BA77G)



rm(MultiCultiDataMeanSmall39BA127R, MultiCultiDataMeanSmall40BA127R, MultiCultiDataMeanSmall43BA127R, MultiCultiDataMeanSmall60BA127R, MultiCultiDataMeanSmall62BA127R, MultiCultiDataMeanSmall65BA127R, MultiCultiDataMeanSmall71BA127R, MultiCultiDataMeanSmall74BA127R, MultiCultiDataMeanSmall77BA127R, MultiCultiDataMeanSmall39BA48R, MultiCultiDataMeanSmall40BA48R, MultiCultiDataMeanSmall43BA48R, MultiCultiDataMeanSmall60BA48R, MultiCultiDataMeanSmall62BA48R, MultiCultiDataMeanSmall65BA48R, MultiCultiDataMeanSmall71BA48R, MultiCultiDataMeanSmall74BA48R, MultiCultiDataMeanSmall77BA48R, MultiCultiDataMeanSmall44BA56G, MultiCultiDataMeanSmall45BA56G, MultiCultiDataMeanSmall46BA56G, MultiCultiDataMeanSmall60BA56G, MultiCultiDataMeanSmall62BA56G, MultiCultiDataMeanSmall65BA56G, MultiCultiDataMeanSmall71BA56G, MultiCultiDataMeanSmall74BA56G, MultiCultiDataMeanSmall77BA56G, MultiCultiDataMeanSmall44BA77G, MultiCultiDataMeanSmall45BA77G, MultiCultiDataMeanSmall46BA77G, MultiCultiDataMeanSmall60BA77G, MultiCultiDataMeanSmall62BA77G, MultiCultiDataMeanSmall65BA77G, MultiCultiDataMeanSmall71BA77G, MultiCultiDataMeanSmall74BA77G, MultiCultiDataMeanSmall77BA77G)

rm(MultiCultiDataMeanSmall39, MultiCultiDataMeanSmall40, MultiCultiDataMeanSmall43, MultiCultiDataMeanSmall44, MultiCultiDataMeanSmall45, MultiCultiDataMeanSmall46, MultiCultiDataMeanSmall60, MultiCultiDataMeanSmall62, MultiCultiDataMeanSmall65, MultiCultiDataMeanSmall71, MultiCultiDataMeanSmall74, MultiCultiDataMeanSmall77) 

```



```{r}

MultiCultiDataAllStrains <- rbind(MultiCultiDataAllBA127R, MultiCultiDataAllBA48R, MultiCultiDataAllBA56G, MultiCultiDataAllBA77G)

MultiCultiDataAllStrains81216 <- MultiCultiDataAllStrains %>% 
filter(Photoperiod !="24")

MultiCultiDataAllStrains24 <- MultiCultiDataAllStrains %>% 
filter(Photoperiod =="24")


```



```{r}

MultiCultiDataAllStrainsCut <- MultiCultiDataAllStrains %>% 
filter(Par_ue == 900) 
#filter(timeRound <= 110)

MultiCultiDataAllStrainsRest <- MultiCultiDataAllStrains %>% 
filter(Par_ue != 900) 

MultiCultiDataAllStrainsok <- rbind(MultiCultiDataAllStrainsCut, MultiCultiDataAllStrainsRest)
```





```{r}
MultiCultiDataAllStrainsok2 <- MultiCultiDataAllStrainsok %>% 
  group_by(ID, timeRound) %>% 
  mutate(DeltaOD = meanOD680-meanOD720) %>% 
ungroup()

```



od720 from Multiculti - mean from day
```{r}
# colnames(MultiCultiDataAllStrainsok)
#group_by(ID, Strain, Par_ue, Day, Run, ExpDate, Photoperiod, Tube) %>% 
MultiCultiOD750 <- MultiCultiDataAllStrainsok %>% 

group_by(ID, Day, ExpDate) %>% 
summarize(ID, timeRound, Filename, Tube, Day, ExpDate, Run,  Strain, Par_ue, Photoperiod, O2, WL, LightShape, ExpEndDate, meanActinic_par, meanOD680, meanOD720, meanActinic_parDay = mean(meanActinic_par), meanOD680Day = mean(meanOD680),  meanOD720Day = mean(meanOD720)) %>%
ungroup()

MultiCultiOD750Small <- MultiCultiOD750 %>%
  select(-c(timeRound, meanActinic_par, meanOD680, meanOD720)) %>% 
  unique()
```







Load previos Growth curve 
```{r read ProcessFile}

#data necessary for plot growth curve (round time) for all runs - contained od750, od680 and Actinic Par data
GrowthCurveFile <- "../ImportedData/SySlmanuscriptWWPhotoperiod/PicoBaltic_MultiCultiDataAllStrainsokAll.Rds"
GrowthCurveFileName <- str_split(string = GrowthCurveFile, "/")[[1]][3] %>%
  str_remove(pattern = ".Rds")
GrowthCurve <- readRDS(GrowthCurveFile)  %>%
  ungroup()

```

Only for nice plot - lines for tmaxAG 
#I will fix this - take data from existed df!
```{r}

data_vline1 <- data.frame(Par_ue= c(30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900),Photoperiod= c(8,8,8,8,8,12,12,12,12,12,16,16,16,16,16,24,24,24,24,24),facetsPar_ue= c("PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})"),facetsPhotoperiod= c("Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)"), value = c(347,321.02,240.90,187.92,168,347,245.39,189.48,162.62,168,347,168.39,113.76,111.56,110,154.64,114.68,93.32,93.78,110))

data_vline2 <- data.frame(Par_ue= c(30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900),Photoperiod= c(8,8,8,8,8,12,12,12,12,12,16,16,16,16,16,24,24,24,24,24),facetsPar_ue= c("PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})"),facetsPhotoperiod= c("Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)"), value = c(346,319.92,240.81,214.41,168,346,216.33,163.44,136.03,168,299.38,166.28,137.32,111.28,109.45,119.35,103.77,100.38,79.20,94.23))

data_vline3 <- data.frame(Par_ue= c(30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900),Photoperiod= c(8,8,8,8,8,12,12,12,12,12,16,16,16,16,16,24,24,24,24,24),facetsPar_ue= c("PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})"),facetsPhotoperiod= c("Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)"), value = c(345,347,266.84,240.72,168,345,296.45,217.80,191.03,168,345,191.49,114.95,112.75,108,157.85,120.27,110.28,95.79,79.66))

data_vline4 <- data.frame(Par_ue= c(30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900,30, 90, 180, 300, 900),Photoperiod= c(8,8,8,8,8,12,12,12,12,12,16,16,16,16,16,24,24,24,24,24),facetsPar_ue= c("PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})","PAR~(µmol~photons~m^{-2}~s^{-1})"),facetsPhotoperiod= c("Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)","Photoperiod~(h)"), value = c(344, 345, 266.93, 215.42, 168,344, 244.38,190.39,163.62,168,299.57, 168.85, 137.50, 112.29, 107,138.78, 120.18, 108.08, 98.36, 107))

```


Choose growth curve, remove unused stuff, add facets and change strain name for nice plot
```{r}

GrowthCurveSmall <- GrowthCurve %>% 
  group_by(ID, timeRound) %>% 
  mutate(DeltaOD = meanOD680-meanOD720) %>% 
  ungroup()

GrowthCurveSmall <- GrowthCurveSmall %>%
  filter(Par_ue != 600) 

MultiCultiData1 <- GrowthCurveSmall %>%
  filter(Par_ue==900 & Photoperiod == 24) %>%
  filter(Run == 121)

MultiCultiData2 <- GrowthCurveSmall %>%
  filter(Par_ue==900 & Photoperiod == 8 | Photoperiod == 12| Photoperiod == 16) 

MultiCultiData3 <- GrowthCurveSmall %>%
  filter(Photoperiod==24 & Par_ue == 30 | Par_ue == 90 | Par_ue == 180 | Par_ue == 300) 

MultiCultiData4 <- GrowthCurveSmall %>% 
  filter(Photoperiod!=24) %>% 
  filter(Par_ue!=900)

GrowthCurveAll<- rbind(MultiCultiData1, MultiCultiData2, MultiCultiData3, MultiCultiData4)

rm(MultiCultiData1, MultiCultiData2, MultiCultiData3, MultiCultiData4, GrowthCurveSmall, GrowthCurve)


GrowthCurveAll$facetsPar_ue = factor(GrowthCurveAll$O2, labels = c("PAR~(µmol~photons~m^{-2}~s^{-1})"))

GrowthCurveAll$facetsPhotoperiod = factor(GrowthCurveAll$WL, labels = c("Photoperiod~(h)"))

GrowthCurveAll <- GrowthCurveAll %>% 
    mutate(Strain=case_when(Strain=="BA127R"~"PE-rich_127",
         Strain=="BA48R"~"PE-rich_048",
        Strain=="BA56G"~"PC-rich_056",
         Strain=="BA77G"~"PC-rich_077")) 

```


GrowthCurveAll - contained Growth curve - per strain combine with max growth
Growth curve plot
```{r fig.height = 8, fig.width = 8, warning = FALSE}


Plot <- GrowthCurveAll %>%
  #filter(timeRound <= 110) %>%
  ggplot() +
  geom_area(aes(x = timeRound, y = meanActinic_par), size = 0.1, fill = "tan1", alpha = 0.6) +
  geom_line(aes(x = timeRound, y = meanOD680, colour = as.factor(Strain)), size = 0.7, show.legend = T) +

  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="") +
  labs(y = "Optical density ("~OD[680]~")", x = "Elapsed time (h)") +

    # ggh4x::facet_nested(rows = vars(WL, Photoperiod), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs), scale="free_x") +
  
  ggh4x::facet_nested(cols = vars(facetsPhotoperiod, Photoperiod), rows = vars(facetsPar_ue, Par_ue), labeller = label_parsed, scale="free_x") +

  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.085,0.96),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.x = unit(0.01, 'cm'),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.text = element_text(size=10))

Plot




Plot <- GrowthCurveAll %>%
  #filter(timeRound <= 110) %>%
  ggplot() +
  geom_area(aes(x = timeRound, y = meanActinic_par), size = 0.1, fill = "tan1", alpha = 0.6) +
  geom_line(aes(x = timeRound, y = meanOD680, colour = as.factor(Strain)), size = 0.7, show.legend = T) +

  geom_vline(data = data_vline1, aes(xintercept = value), linetype="dotdash", colour = "brown4") +
  geom_vline(data = data_vline2, aes(xintercept = value), linetype="dotdash", colour = "brown1") +
  geom_vline(data = data_vline3, aes(xintercept = value), linetype="dotdash", colour = "seagreen4") +
  geom_vline(data = data_vline4, aes(xintercept = value), linetype="dotdash", colour = "palegreen3") +

  scale_colour_discrete(type=c("seagreen4", "palegreen3", "brown1", "brown4"), name="") +
  labs(y = "Optical density ("~OD[680]~")", x = "Elapsed time (h)") +

    # ggh4x::facet_nested(rows = vars(WL, Photoperiod), cols = vars(O2, Par_ue), labeller = labeller(Photoperiod = Photoperiod.labs,  Strain = label_value, Par_ue = Par_ue.labs, WL = WL.labs, O2 = O2.labs), scale="free_x") +
  
  ggh4x::facet_nested(cols = vars(facetsPhotoperiod, Photoperiod), rows = vars(facetsPar_ue, Par_ue), labeller = label_parsed) +

  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.text = element_text(size=12),
        axis.title = element_text(size=16),
        strip.background = element_rect(fill="white"),
        strip.text = element_text(size=12),
        axis.title.y = element_text(margin=margin(r=10)),
        axis.title.x = element_text(margin=margin(t=10)),
        legend.background = element_rect(fill="transparent"),
        legend.position = c(0.085,0.96),
        legend.key.height= unit(0.005, 'cm'),
        legend.spacing.x = unit(0.01, 'cm'),
        #plot.background = element_rect(colour = "dodgerblue4", size = 3),
        legend.text = element_text(size=10))

Plot
```





